!function(i){var t;window.UIkit2&&(t=i(UIkit2)),"function"==typeof define&&define.amd&&define("uikit-slideshow",["uikit"],function(){return t||i(UIkit2)})}(function(l){"use strict";var u,p=0;l.component("slideshow",{defaults:{animation:"fade",duration:500,height:"auto",start:0,autoplay:!1,autoplayInterval:7e3,videoautoplay:!0,videomute:!0,slices:15,pauseOnHover:!0,kenburns:!1,kenburnsanimations:["uk-animation-middle-left","uk-animation-top-right","uk-animation-bottom-left","uk-animation-top-center","","uk-animation-bottom-right"]},current:!1,interval:null,hovering:!1,boot:function(){l.ready(function(i){l.$("[data-uk-slideshow]",i).each(function(){var i=l.$(this);i.data("slideshow")||l.slideshow(i,l.Utils.options(i.attr("data-uk-slideshow")))})})},init:function(){var s=this;this.container=this.element.hasClass("uk-slideshow")?this.element:l.$(this.find(".uk-slideshow:first")),this.current=this.options.start,this.animating=!1,this.fixFullscreen=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)&&this.container.hasClass("uk-slideshow-fullscreen"),this.options.kenburns&&(this.kbanimduration=!0===this.options.kenburns?"15s":this.options.kenburns,String(this.kbanimduration).match(/(ms|s)$/)||(this.kbanimduration+="ms"),"string"==typeof this.options.kenburnsanimations&&(this.options.kenburnsanimations=this.options.kenburnsanimations.split(","))),this.update(),this.on("click.uk.slideshow","[data-uk-slideshow-item]",function(i){i.preventDefault();var t=l.$(this).attr("data-uk-slideshow-item");if(s.current!=t){switch(t){case"next":case"previous":s["next"==t?"next":"previous"]();break;default:s.show(parseInt(t,10))}s.stop()}}),l.$win.on("resize load",l.Utils.debounce(function(){s.resize(),s.fixFullscreen&&(s.container.css("height",window.innerHeight),s.slides.css("height",window.innerHeight))},100)),setTimeout(function(){s.resize()},80),this.options.autoplay&&this.start(),this.options.videoautoplay&&this.slides.eq(this.current).data("media")&&this.playmedia(this.slides.eq(this.current).data("media")),this.options.kenburns&&this.applyKenBurns(this.slides.eq(this.current)),this.container.on({mouseenter:function(){s.options.pauseOnHover&&(s.hovering=!0)},mouseleave:function(){s.hovering=!1}}),this.on("swipeRight swipeLeft",function(i){s["swipeLeft"==i.type?"next":"previous"]()}),this.on("display.uk.check",function(){s.element.is(":visible")&&(s.resize(),s.fixFullscreen&&(s.container.css("height",window.innerHeight),s.slides.css("height",window.innerHeight)))}),l.domObserve(this.element,function(i){s.container.children(":not([data-slideshow-slide])").not(".uk-slideshow-ghost").length&&s.update(!0)})},update:function(i){var u,h=this,c=0;this.slides=this.container.children(),this.slidesCount=this.slides.length,this.slides.eq(this.current).length||(this.current=0),this.slides.each(function(s){var i=l.$(this);if(!i.data("processed")){var e=i.children("img,video,iframe").eq(0),t="html";if(i.data("media",e),i.data("sizer",e),e.length){var a;switch(t=e[0].nodeName.toLowerCase(),e[0].nodeName){case"IMG":var n=l.$('<div class="uk-cover-background uk-position-cover"></div>').css({"background-image":"url("+e.attr("src")+")"});e.attr("width")&&e.attr("height")&&(a=l.$("<canvas></canvas>").attr({width:e.attr("width"),height:e.attr("height")}),e.replaceWith(a),e=a,a=void 0),e.css({width:"100%",height:"auto",opacity:0}),i.prepend(n).data("cover",n);break;case"IFRAME":var o=e[0].src,r="sw-"+ ++p;e.attr("src","").on("load",function(){if((s!==h.current||s==h.current&&!h.options.videoautoplay)&&h.pausemedia(e),h.options.videomute){h.mutemedia(e);var i=setInterval((t=0,function(){h.mutemedia(e),4<=++t&&clearInterval(i)}),250)}var t}).data("slideshow",h).attr("data-player-id",r).attr("src",[o,-1<o.indexOf("?")?"&":"?","enablejsapi=1&api=1&player_id="+r].join("")).addClass("uk-position-absolute"),l.support.touch||e.css("pointer-events","none"),a=!0,l.cover&&(l.cover(e),e.attr("data-uk-cover","{}"));break;case"VIDEO":e.addClass("uk-cover-object uk-position-absolute"),a=!0,h.options.videomute&&h.mutemedia(e)}if(a){u=l.$("<canvas></canvas>").attr({width:e[0].width,height:e[0].height});var d=l.$('<img style="width:100%;height:auto;">').attr("src",u[0].toDataURL());i.prepend(d),i.data("sizer",d)}}else i.data("sizer",i);h.hasKenBurns(i)&&i.data("cover").css({"-webkit-animation-duration":h.kbanimduration,"animation-duration":h.kbanimduration}),i.data("processed",++c),i.attr("data-slideshow-slide",t)}}),c&&(this.triggers=this.find("[data-uk-slideshow-item]"),this.slides.attr("aria-hidden","true").removeClass("uk-active").eq(this.current).addClass("uk-active").attr("aria-hidden","false"),this.triggers.filter('[data-uk-slideshow-item="'+this.current+'"]').addClass("uk-active")),i&&c&&this.resize()},resize:function(){if(!this.container.hasClass("uk-slideshow-fullscreen")){var i=this.options.height;"auto"===this.options.height&&(i=0,this.slides.css("height","").each(function(){i=Math.max(i,l.$(this).height())})),this.container.css("height",i),this.slides.css("height",i)}},show:function(i,t){if(!this.animating&&this.current!=i){this.animating=!0;var s=this,e=this.slides.eq(this.current),a=this.slides.eq(i),n=t||(this.current<i?1:-1),o=e.data("media"),r=u[this.options.animation]?this.options.animation:"fade",d=a.data("media");s.applyKenBurns(a),l.support.animation||(r="none"),e=l.$(e),a=l.$(a),s.trigger("beforeshow.uk.slideshow",[a,e,s]),u[r].apply(this,[e,a,n]).then(function(){s.animating&&(o&&o.is("video,iframe")&&s.pausemedia(o),d&&d.is("video,iframe")&&s.playmedia(d),a.addClass("uk-active").attr("aria-hidden","false"),e.removeClass("uk-active").attr("aria-hidden","true"),s.animating=!1,s.current=i,l.Utils.checkDisplay(a,'[class*="uk-animation-"]:not(.uk-cover-background.uk-position-cover)'),s.trigger("show.uk.slideshow",[a,e,s]))}),s.triggers.removeClass("uk-active"),s.triggers.filter('[data-uk-slideshow-item="'+i+'"]').addClass("uk-active")}},applyKenBurns:function(i){if(this.hasKenBurns(i)){var t=this.options.kenburnsanimations,s=this.kbindex||0;i.data("cover").attr("class","uk-cover-background uk-position-cover").width(),i.data("cover").addClass(["uk-animation-scale","uk-animation-reverse",t[s].trim()].join(" ")),this.kbindex=t[s+1]?s+1:0}},hasKenBurns:function(i){return this.options.kenburns&&i.data("cover")},next:function(){this.show(this.slides[this.current+1]?this.current+1:0,1)},previous:function(){this.show(this.slides[this.current-1]?this.current-1:this.slides.length-1,-1)},start:function(){this.stop();var i=this;this.interval=setInterval(function(){i.hovering||i.next()},this.options.autoplayInterval)},stop:function(){this.interval&&clearInterval(this.interval)},playmedia:function(i){if(i&&i[0])switch(i[0].nodeName){case"VIDEO":this.options.videomute||(i[0].muted=!1),i[0].play();break;case"IFRAME":this.options.videomute||i[0].contentWindow.postMessage('{ "event": "command", "func": "unmute", "method":"setVolume", "value":1}',"*"),i[0].contentWindow.postMessage('{ "event": "command", "func": "playVideo", "method":"play"}',"*")}},pausemedia:function(i){switch(i[0].nodeName){case"VIDEO":i[0].pause();break;case"IFRAME":i[0].contentWindow.postMessage('{ "event": "command", "func": "pauseVideo", "method":"pause"}',"*")}},mutemedia:function(i){switch(i[0].nodeName){case"VIDEO":i[0].muted=!0;break;case"IFRAME":i[0].contentWindow.postMessage('{ "event": "command", "func": "mute", "method":"setVolume", "value":0}',"*")}}}),u={none:function(){var i=l.$.Deferred();return i.resolve(),i.promise()},scroll:function(i,t,s){var e=l.$.Deferred();return i.css("animation-duration",this.options.duration+"ms"),t.css("animation-duration",this.options.duration+"ms"),t.css("opacity",1).one(l.support.animation.end,function(){i.css("opacity",0).removeClass(-1==s?"uk-slideshow-scroll-backward-out":"uk-slideshow-scroll-forward-out"),t.removeClass(-1==s?"uk-slideshow-scroll-backward-in":"uk-slideshow-scroll-forward-in"),e.resolve()}.bind(this)),i.addClass(-1==s?"uk-slideshow-scroll-backward-out":"uk-slideshow-scroll-forward-out"),t.addClass(-1==s?"uk-slideshow-scroll-backward-in":"uk-slideshow-scroll-forward-in"),t.width(),e.promise()},swipe:function(i,t,s){var e=l.$.Deferred();return i.css("animation-duration",this.options.duration+"ms"),t.css("animation-duration",this.options.duration+"ms"),t.css("opacity",1).one(l.support.animation.end,function(){i.css("opacity",0).removeClass(-1===s?"uk-slideshow-swipe-backward-out":"uk-slideshow-swipe-forward-out"),t.removeClass(-1===s?"uk-slideshow-swipe-backward-in":"uk-slideshow-swipe-forward-in"),e.resolve()}.bind(this)),i.addClass(-1==s?"uk-slideshow-swipe-backward-out":"uk-slideshow-swipe-forward-out"),t.addClass(-1==s?"uk-slideshow-swipe-backward-in":"uk-slideshow-swipe-forward-in"),t.width(),e.promise()},scale:function(i,t,s){var e=l.$.Deferred();return i.css("animation-duration",this.options.duration+"ms"),t.css("animation-duration",this.options.duration+"ms"),t.css("opacity",1),i.one(l.support.animation.end,function(){i.css("opacity",0).removeClass("uk-slideshow-scale-out"),e.resolve()}.bind(this)),i.addClass("uk-slideshow-scale-out"),i.width(),e.promise()},fade:function(i,t,s){var e=l.$.Deferred();return i.css("animation-duration",this.options.duration+"ms"),t.css("animation-duration",this.options.duration+"ms"),t.css("opacity",1),t.data("cover")||t.data("placeholder")||t.css("opacity",1).one(l.support.animation.end,function(){t.removeClass("uk-slideshow-fade-in")}).addClass("uk-slideshow-fade-in"),i.one(l.support.animation.end,function(){i.css("opacity",0).removeClass("uk-slideshow-fade-out"),e.resolve()}.bind(this)),i.addClass("uk-slideshow-fade-out"),i.width(),e.promise()}},l.slideshow.animations=u,window.addEventListener("message",function(i){var t,s=i.data;if("string"==typeof s)try{s=JSON.parse(s)}catch(i){s={}}i.origin&&-1<i.origin.indexOf("vimeo")&&"ready"==s.event&&s.player_id&&(t=l.$('[data-player-id="'+s.player_id+'"]')).length&&t.data("slideshow").mutemedia(t)},!1)});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvc2xpZGVzaG93LmN1c3RvbS5qcyJdLCJuYW1lcyI6WyJhZGRvbiIsImNvbXBvbmVudCIsIndpbmRvdyIsIlVJa2l0MiIsImRlZmluZSIsImFtZCIsIlVJIiwiQW5pbWF0aW9ucyIsInBsYXllcklkIiwiZGVmYXVsdHMiLCJhbmltYXRpb24iLCJkdXJhdGlvbiIsImhlaWdodCIsInN0YXJ0IiwiYXV0b3BsYXkiLCJhdXRvcGxheUludGVydmFsIiwidmlkZW9hdXRvcGxheSIsInZpZGVvbXV0ZSIsInNsaWNlcyIsInBhdXNlT25Ib3ZlciIsImtlbmJ1cm5zIiwia2VuYnVybnNhbmltYXRpb25zIiwiY3VycmVudCIsImludGVydmFsIiwiaG92ZXJpbmciLCJib290IiwicmVhZHkiLCJjb250ZXh0IiwiJCIsImVhY2giLCJzbGlkZXNob3ciLCJ0aGlzIiwiZGF0YSIsIlV0aWxzIiwib3B0aW9ucyIsImF0dHIiLCJpbml0IiwiJHRoaXMiLCJjb250YWluZXIiLCJlbGVtZW50IiwiaGFzQ2xhc3MiLCJmaW5kIiwiYW5pbWF0aW5nIiwiZml4RnVsbHNjcmVlbiIsIm5hdmlnYXRvciIsInVzZXJBZ2VudCIsIm1hdGNoIiwia2JhbmltZHVyYXRpb24iLCJTdHJpbmciLCJzcGxpdCIsInVwZGF0ZSIsIm9uIiwiZSIsInByZXZlbnREZWZhdWx0Iiwic2xpZGUiLCJzaG93IiwicGFyc2VJbnQiLCJzdG9wIiwiJHdpbiIsImRlYm91bmNlIiwicmVzaXplIiwiY3NzIiwiaW5uZXJIZWlnaHQiLCJzbGlkZXMiLCJzZXRUaW1lb3V0IiwiZXEiLCJwbGF5bWVkaWEiLCJhcHBseUtlbkJ1cm5zIiwibW91c2VlbnRlciIsIm1vdXNlbGVhdmUiLCJ0eXBlIiwiaXMiLCJkb21PYnNlcnZlIiwiY2hpbGRyZW4iLCJub3QiLCJsZW5ndGgiLCJjYW52YXMiLCJwcm9jZXNzZWQiLCJzbGlkZXNDb3VudCIsImluZGV4IiwibWVkaWEiLCJwbGFjZWhvbGRlciIsIm5vZGVOYW1lIiwidG9Mb3dlckNhc2UiLCJjb3ZlciIsImJhY2tncm91bmQtaW1hZ2UiLCJ3aWR0aCIsInJlcGxhY2VXaXRoIiwidW5kZWZpbmVkIiwib3BhY2l0eSIsInByZXBlbmQiLCJzcmMiLCJpZnJhbWVJZCIsInBhdXNlbWVkaWEiLCJtdXRlbWVkaWEiLCJpbnYiLCJzZXRJbnRlcnZhbCIsImljIiwiY2xlYXJJbnRlcnZhbCIsImluZGV4T2YiLCJqb2luIiwiYWRkQ2xhc3MiLCJzdXBwb3J0IiwidG91Y2giLCJpbWciLCJ0b0RhdGFVUkwiLCJoYXNLZW5CdXJucyIsIi13ZWJraXQtYW5pbWF0aW9uLWR1cmF0aW9uIiwiYW5pbWF0aW9uLWR1cmF0aW9uIiwidHJpZ2dlcnMiLCJyZW1vdmVDbGFzcyIsImZpbHRlciIsIk1hdGgiLCJtYXgiLCJkaXJlY3Rpb24iLCJuZXh0IiwiZGlyIiwiY3VycmVudG1lZGlhIiwibmV4dG1lZGlhIiwidHJpZ2dlciIsImFwcGx5IiwidGhlbiIsImNoZWNrRGlzcGxheSIsImFuaW1hdGlvbnMiLCJrYmluZGV4IiwidHJpbSIsInByZXZpb3VzIiwibXV0ZWQiLCJwbGF5IiwiY29udGVudFdpbmRvdyIsInBvc3RNZXNzYWdlIiwicGF1c2UiLCJub25lIiwiZCIsIkRlZmVycmVkIiwicmVzb2x2ZSIsInByb21pc2UiLCJzY3JvbGwiLCJvbmUiLCJlbmQiLCJiaW5kIiwic3dpcGUiLCJzY2FsZSIsImZhZGUiLCJhZGRFdmVudExpc3RlbmVyIiwiaWZyYW1lIiwiSlNPTiIsInBhcnNlIiwiZXJyIiwib3JpZ2luIiwiZXZlbnQiLCJwbGF5ZXJfaWQiXSwibWFwcGluZ3MiOiJDQUNBLFNBQVVBLEdBRU4sSUFBSUMsRUFFQUMsT0FBT0MsU0FDUEYsRUFBWUQsRUFBTUcsU0FHRCxtQkFBVkMsUUFBd0JBLE9BQU9DLEtBQ3RDRCxPQUFPLGtCQUFtQixDQUFDLFNBQVUsV0FDakMsT0FBT0gsR0FBYUQsRUFBTUcsVUFWdEMsQ0FjRyxTQUFTRyxHQUVSLGFBRUEsSUFBSUMsRUFBWUMsRUFB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SyxVQUFZbUYsRUFBS25GLEtBQUssZ0JBRWxDbUYsRUFBS3RELElBQUksVUFBVyxHQUFHNkUsSUFBSXBJLEVBQUdnRyxRQUFRNUYsVUFBVWlJLElBQUssV0FDakR4QixFQUFLTCxZQUFZLDBCQUNsQlQsU0FBUyx3QkFHaEIvRSxFQUFRb0gsSUFBSXBJLEVBQUdnRyxRQUFRNUYsVUFBVWlJLElBQUssV0FFbENySCxFQUFRdUMsSUFBSSxVQUFXLEdBQUdpRCxZQUFZLHlCQUN0Q3VCLEVBQUVFLFdBRUpLLEtBQUs3RyxPQUVQVCxFQUFRK0UsU0FBUyx5QkFDakIvRSxFQUFRZ0UsUUFFRCtDLEVBQUVHLFlBSWpCbEksRUFBR3dCLFVBQVU2RixXQUFhcEgsRUFHMUJMLE9BQU84SSxpQkFBaUIsVUFBVyxTQUEyQjVGLEdBRTFELElBQW1CNkYsRUFBZmpILEVBQU9vQixFQUFFcEIsS0FFYixHQUFvQixpQkFBVixFQUVOLElBQ0lBLEVBQU9rSCxLQUFLQyxNQUFNbkgsR0FDcEIsTUFBTW9ILEdBQ0pwSCxFQUFPLEdBSVhvQixFQUFFaUcsU0FBdUMsRUFBN0JqRyxFQUFFaUcsT0FBT2xELFFBQVEsVUFBK0IsU0FBZG5FLEVBQUtzSCxPQUFvQnRILEVBQUt1SCxZQUM1RU4sRUFBUzNJLEVBQUdzQixFQUFFLG9CQUFxQkksRUFBS3VILFVBQVUsT0FFdkM1RSxRQUNQc0UsRUFBT2pILEtBQUssYUFBYThELFVBQVVtRCxLQUc1QyIsImZpbGUiOiJjb21wb25lbnRzL3NsaWRlc2hvdy5jdXN0b20uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiEgVUlraXQgMi4yNy4yIHwgaHR0cDovL3d3dy5nZXR1aWtpdC5jb20gfCAoYykgMjAxNCBZT090aGVtZSB8IE1JVCBMaWNlbnNlICovXHJcbihmdW5jdGlvbihhZGRvbikge1xyXG5cclxuICAgIHZhciBjb21wb25lbnQ7XHJcblxyXG4gICAgaWYgKHdpbmRvdy5VSWtpdDIpIHtcclxuICAgICAgICBjb21wb25lbnQgPSBhZGRvbihVSWtpdDIpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0eXBlb2YgZGVmaW5lID09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xyXG4gICAgICAgIGRlZmluZSgndWlraXQtc2xpZGVzaG93JywgWyd1aWtpdCddLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudCB8fCBhZGRvbihVSWtpdDIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxufSkoZnVuY3Rpb24oVUkpIHtcclxuXHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICB2YXIgQW5pbWF0aW9ucywgcGxheWVySWQgPSAwO1xyXG5cclxuICAgIFVJLmNvbXBvbmVudCgnc2xpZGVzaG93Jywge1xyXG5cclxuICAgICAgICBkZWZhdWx0czoge1xyXG4gICAgICAgICAgICBhbmltYXRpb24gICAgICAgICAgOiAnZmFkZScsXHJcbiAgICAgICAgICAgIGR1cmF0aW9uICAgICAgICAgICA6IDUwMCxcclxuICAgICAgICAgICAgaGVpZ2h0ICAgICAgICAgICAgIDogJ2F1dG8nLFxyXG4gICAgICAgICAgICBzdGFydCAgICAgICAgICAgICAgOiAwLFxyXG4gICAgICAgICAgICBhdXRvcGxheSAgICAgICAgICAgOiBmYWxzZSxcclxuICAgICAgICAgICAgYXV0b3BsYXlJbnRlcnZhbCAgIDogNzAwMCxcclxuICAgICAgICAgICAgdmlkZW9hdXRvcGxheSAgICAgIDogdHJ1ZSxcclxuICAgICAgICAgICAgdmlkZW9tdXRlICAgICAgICAgIDogdHJ1ZSxcclxuICAgICAgICAgICAgc2xpY2VzICAgICAgICAgICAgIDogMTUsXHJcbiAgICAgICAgICAgIHBhdXNlT25Ib3ZlciAgICAgICA6IHRydWUsXHJcbiAgICAgICAgICAgIGtlbmJ1cm5zICAgICAgICAgICA6IGZhbHNlLFxyXG4gICAgICAgICAgICBrZW5idXJuc2FuaW1hdGlvbnMgOiBbXHJcbiAgICAgICAgICAgICAgICAndWstYW5pbWF0aW9uLW1pZGRsZS1sZWZ0JyxcclxuICAgICAgICAgICAgICAgICd1ay1hbmltYXRpb24tdG9wLXJpZ2h0JyxcclxuICAgICAgICAgICAgICAgICd1ay1hbmltYXRpb24tYm90dG9tLWxlZnQnLFxyXG4gICAgICAgICAgICAgICAgJ3VrLWFuaW1hdGlvbi10b3AtY2VudGVyJyxcclxuICAgICAgICAgICAgICAgICcnLCAvLyBtaWRkbGUtY2VudGVyXHJcbiAgICAgICAgICAgICAgICAndWstYW5pbWF0aW9uLWJvdHRvbS1yaWdodCdcclxuICAgICAgICAgICAgXVxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGN1cnJlbnQgIDogZmFsc2UsXHJcbiAgICAgICAgaW50ZXJ2YWwgOiBudWxsLFxyXG4gICAgICAgIGhvdmVyaW5nIDogZmFsc2UsXHJcblxyXG4gICAgICAgIGJvb3Q6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgLy8gaW5pdCBjb2RlXHJcbiAgICAgICAgICAgIFVJLnJlYWR5KGZ1bmN0aW9uKGNvbnRleHQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBVSS4kKCdbZGF0YS11ay1zbGlkZXNob3ddJywgY29udGV4dCkuZWFjaChmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNsaWRlc2hvdyA9IFVJLiQodGhpcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghc2xpZGVzaG93LmRhdGEoJ3NsaWRlc2hvdycpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFVJLnNsaWRlc2hvdyhzbGlkZXNob3csIFVJLlV0aWxzLm9wdGlvbnMoc2xpZGVzaG93LmF0dHIoJ2RhdGEtdWstc2xpZGVzaG93JykpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgJHRoaXMgPSB0aGlzO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIgICAgID0gdGhpcy5lbGVtZW50Lmhhc0NsYXNzKCd1ay1zbGlkZXNob3cnKSA/IHRoaXMuZWxlbWVudCA6IFVJLiQodGhpcy5maW5kKCcudWstc2xpZGVzaG93OmZpcnN0JykpO1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnQgICAgICAgPSB0aGlzLm9wdGlvbnMuc3RhcnQ7XHJcbiAgICAgICAgICAgIHRoaXMuYW5pbWF0aW5nICAgICA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5maXhGdWxsc2NyZWVuID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvKGlQYWR8aVBob25lfGlQb2QpL2cpICYmIHRoaXMuY29udGFpbmVyLmhhc0NsYXNzKCd1ay1zbGlkZXNob3ctZnVsbHNjcmVlbicpOyAvLyB2aWV3cG9ydCB1bml0IGZpeCBmb3IgaGVpZ2h0OjEwMHZoIC0gc2hvdWxkIGJlIGZpeGVkIGluIGlPUyA4XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmtlbmJ1cm5zKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5rYmFuaW1kdXJhdGlvbiA9IHRoaXMub3B0aW9ucy5rZW5idXJucyA9PT0gdHJ1ZSA/ICcxNXMnOiB0aGlzLm9wdGlvbnMua2VuYnVybnM7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFTdHJpbmcodGhpcy5rYmFuaW1kdXJhdGlvbikubWF0Y2goLyhtc3xzKSQvKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMua2JhbmltZHVyYXRpb24gKz0gJ21zJztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKHRoaXMub3B0aW9ucy5rZW5idXJuc2FuaW1hdGlvbnMpID09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmtlbmJ1cm5zYW5pbWF0aW9ucyA9IHRoaXMub3B0aW9ucy5rZW5idXJuc2FuaW1hdGlvbnMuc3BsaXQoJywnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy51cGRhdGUoKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMub24oJ2NsaWNrLnVrLnNsaWRlc2hvdycsICdbZGF0YS11ay1zbGlkZXNob3ctaXRlbV0nLCBmdW5jdGlvbihlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBzbGlkZSA9IFVJLiQodGhpcykuYXR0cignZGF0YS11ay1zbGlkZXNob3ctaXRlbScpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICgkdGhpcy5jdXJyZW50ID09IHNsaWRlKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICAgICAgc3dpdGNoKHNsaWRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbmV4dCc6XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncHJldmlvdXMnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkdGhpc1tzbGlkZT09J25leHQnID8gJ25leHQnOidwcmV2aW91cyddKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLnNob3cocGFyc2VJbnQoc2xpZGUsIDEwKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgJHRoaXMuc3RvcCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIFVJLiR3aW4ub24oXCJyZXNpemUgbG9hZFwiLCBVSS5VdGlscy5kZWJvdW5jZShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICR0aGlzLnJlc2l6ZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICgkdGhpcy5maXhGdWxsc2NyZWVuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuY29udGFpbmVyLmNzcygnaGVpZ2h0Jywgd2luZG93LmlubmVySGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICAkdGhpcy5zbGlkZXMuY3NzKCdoZWlnaHQnLCB3aW5kb3cuaW5uZXJIZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCAxMDApKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGNocm9tZSBpbWFnZSBsb2FkIGZpeFxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAkdGhpcy5yZXNpemUoKTtcclxuICAgICAgICAgICAgfSwgODApO1xyXG5cclxuICAgICAgICAgICAgLy8gU2V0IGF1dG9wbGF5XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXV0b3BsYXkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnQoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy52aWRlb2F1dG9wbGF5ICYmIHRoaXMuc2xpZGVzLmVxKHRoaXMuY3VycmVudCkuZGF0YSgnbWVkaWEnKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5bWVkaWEodGhpcy5zbGlkZXMuZXEodGhpcy5jdXJyZW50KS5kYXRhKCdtZWRpYScpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5rZW5idXJucykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hcHBseUtlbkJ1cm5zKHRoaXMuc2xpZGVzLmVxKHRoaXMuY3VycmVudCkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5vbih7XHJcbiAgICAgICAgICAgICAgICBtb3VzZWVudGVyOiBmdW5jdGlvbigpIHsgaWYgKCR0aGlzLm9wdGlvbnMucGF1c2VPbkhvdmVyKSAkdGhpcy5ob3ZlcmluZyA9IHRydWU7ICB9LFxyXG4gICAgICAgICAgICAgICAgbW91c2VsZWF2ZTogZnVuY3Rpb24oKSB7ICR0aGlzLmhvdmVyaW5nID0gZmFsc2U7IH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLm9uKCdzd2lwZVJpZ2h0IHN3aXBlTGVmdCcsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICR0aGlzW2UudHlwZT09J3N3aXBlTGVmdCcgPyAnbmV4dCcgOiAncHJldmlvdXMnXSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMub24oJ2Rpc3BsYXkudWsuY2hlY2snLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgaWYgKCR0aGlzLmVsZW1lbnQuaXMoJzp2aXNpYmxlJykpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMucmVzaXplKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy5maXhGdWxsc2NyZWVuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLmNvbnRhaW5lci5jc3MoJ2hlaWdodCcsIHdpbmRvdy5pbm5lckhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLnNsaWRlcy5jc3MoJ2hlaWdodCcsIHdpbmRvdy5pbm5lckhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIFVJLmRvbU9ic2VydmUodGhpcy5lbGVtZW50LCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHRoaXMuY29udGFpbmVyLmNoaWxkcmVuKCc6bm90KFtkYXRhLXNsaWRlc2hvdy1zbGlkZV0pJykubm90KCcudWstc2xpZGVzaG93LWdob3N0JykubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMudXBkYXRlKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uKHJlc2l6ZSkge1xyXG5cclxuICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpcywgY2FudmFzLCBwcm9jZXNzZWQgPSAwO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5zbGlkZXMgICAgICAgID0gdGhpcy5jb250YWluZXIuY2hpbGRyZW4oKTtcclxuICAgICAgICAgICAgdGhpcy5zbGlkZXNDb3VudCAgID0gdGhpcy5zbGlkZXMubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgaWYgKCF0aGlzLnNsaWRlcy5lcSh0aGlzLmN1cnJlbnQpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50ID0gMDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5zbGlkZXMuZWFjaChmdW5jdGlvbihpbmRleCkge1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBzbGlkZSA9IFVJLiQodGhpcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNsaWRlLmRhdGEoJ3Byb2Nlc3NlZCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBtZWRpYSA9IHNsaWRlLmNoaWxkcmVuKCdpbWcsdmlkZW8saWZyYW1lJykuZXEoMCksIHR5cGUgPSAnaHRtbCc7XHJcblxyXG4gICAgICAgICAgICAgICAgc2xpZGUuZGF0YSgnbWVkaWEnLCBtZWRpYSk7XHJcbiAgICAgICAgICAgICAgICBzbGlkZS5kYXRhKCdzaXplcicsIG1lZGlhKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAobWVkaWEubGVuZ3RoKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwbGFjZWhvbGRlcjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IG1lZGlhWzBdLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaChtZWRpYVswXS5ub2RlTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdJTUcnOlxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb3ZlciA9IFVJLiQoJzxkaXYgY2xhc3M9XCJ1ay1jb3Zlci1iYWNrZ3JvdW5kIHVrLXBvc2l0aW9uLWNvdmVyXCI+PC9kaXY+JykuY3NzKHsnYmFja2dyb3VuZC1pbWFnZSc6J3VybCgnKyBtZWRpYS5hdHRyKCdzcmMnKSArICcpJ30pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtZWRpYS5hdHRyKCd3aWR0aCcpICYmIG1lZGlhLmF0dHIoJ2hlaWdodCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXIgPSBVSS4kKCc8Y2FudmFzPjwvY2FudmFzPicpLmF0dHIoe3dpZHRoOm1lZGlhLmF0dHIoJ3dpZHRoJyksIGhlaWdodDptZWRpYS5hdHRyKCdoZWlnaHQnKX0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lZGlhLnJlcGxhY2VXaXRoKHBsYWNlaG9sZGVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWRpYSA9IHBsYWNlaG9sZGVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lZGlhLmNzcyh7d2lkdGg6ICcxMDAlJyxoZWlnaHQ6ICdhdXRvJywgb3BhY2l0eTowfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbGlkZS5wcmVwZW5kKGNvdmVyKS5kYXRhKCdjb3ZlcicsIGNvdmVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnSUZSQU1FJzpcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3JjID0gbWVkaWFbMF0uc3JjLCBpZnJhbWVJZCA9ICdzdy0nKygrK3BsYXllcklkKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWRpYVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdzcmMnLCAnJykub24oJ2xvYWQnLCBmdW5jdGlvbigpe1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ICE9PSAkdGhpcy5jdXJyZW50IHx8IChpbmRleCA9PSAkdGhpcy5jdXJyZW50ICYmICEkdGhpcy5vcHRpb25zLnZpZGVvYXV0b3BsYXkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5wYXVzZW1lZGlhKG1lZGlhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLm9wdGlvbnMudmlkZW9tdXRlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMubXV0ZW1lZGlhKG1lZGlhKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW52ID0gc2V0SW50ZXJ2YWwoKGZ1bmN0aW9uKGljKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5tdXRlbWVkaWEobWVkaWEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKytpYyA+PSA0KSBjbGVhckludGVydmFsKGludik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkoMCksIDI1MCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZGF0YSgnc2xpZGVzaG93JywgJHRoaXMpICAvLyBhZGQgc2VsZi1yZWZlcmVuY2UgZm9yIHRoZSB2aW1lby1yZWFkeSBsaXN0ZW5lclxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdkYXRhLXBsYXllci1pZCcsIGlmcmFtZUlkKSAgLy8gYWRkIGZyYW1lSWQgZm9yIHRoZSB2aW1lby1yZWFkeSBsaXN0ZW5lclxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdzcmMnLCBbc3JjLCAoc3JjLmluZGV4T2YoJz8nKSA+IC0xID8gJyYnOic/JyksICdlbmFibGVqc2FwaT0xJmFwaT0xJnBsYXllcl9pZD0nK2lmcmFtZUlkXS5qb2luKCcnKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ3VrLXBvc2l0aW9uLWFic29sdXRlJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGlzYWJsZSBwb2ludGVyIGV2ZW50c1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoIVVJLnN1cHBvcnQudG91Y2gpIG1lZGlhLmNzcygncG9pbnRlci1ldmVudHMnLCAnbm9uZScpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoVUkuY292ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVSS5jb3ZlcihtZWRpYSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVkaWEuYXR0cignZGF0YS11ay1jb3ZlcicsICd7fScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnVklERU8nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVkaWEuYWRkQ2xhc3MoJ3VrLWNvdmVyLW9iamVjdCB1ay1wb3NpdGlvbi1hYnNvbHV0ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXIgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy5vcHRpb25zLnZpZGVvbXV0ZSkgJHRoaXMubXV0ZW1lZGlhKG1lZGlhKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwbGFjZWhvbGRlcikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzICA9IFVJLiQoJzxjYW52YXM+PC9jYW52YXM+JykuYXR0cih7J3dpZHRoJzogbWVkaWFbMF0ud2lkdGgsICdoZWlnaHQnOiBtZWRpYVswXS5oZWlnaHR9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGltZyA9IFVJLiQoJzxpbWcgc3R5bGU9XCJ3aWR0aDoxMDAlO2hlaWdodDphdXRvO1wiPicpLmF0dHIoJ3NyYycsIGNhbnZhc1swXS50b0RhdGFVUkwoKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzbGlkZS5wcmVwZW5kKGltZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlLmRhdGEoJ3NpemVyJywgaW1nKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzbGlkZS5kYXRhKCdzaXplcicsIHNsaWRlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoJHRoaXMuaGFzS2VuQnVybnMoc2xpZGUpKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHNsaWRlLmRhdGEoJ2NvdmVyJykuY3NzKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJy13ZWJraXQtYW5pbWF0aW9uLWR1cmF0aW9uJzogJHRoaXMua2JhbmltZHVyYXRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdhbmltYXRpb24tZHVyYXRpb24nOiAkdGhpcy5rYmFuaW1kdXJhdGlvblxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHNsaWRlLmRhdGEoJ3Byb2Nlc3NlZCcsICsrcHJvY2Vzc2VkKTtcclxuICAgICAgICAgICAgICAgIHNsaWRlLmF0dHIoJ2RhdGEtc2xpZGVzaG93LXNsaWRlJywgdHlwZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKHByb2Nlc3NlZCkge1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcnMgPSB0aGlzLmZpbmQoJ1tkYXRhLXVrLXNsaWRlc2hvdy1pdGVtXScpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFNldCBzdGFydCBzbGlkZVxyXG4gICAgICAgICAgICAgICAgdGhpcy5zbGlkZXMuYXR0cignYXJpYS1oaWRkZW4nLCAndHJ1ZScpLnJlbW92ZUNsYXNzKCd1ay1hY3RpdmUnKS5lcSh0aGlzLmN1cnJlbnQpLmFkZENsYXNzKCd1ay1hY3RpdmUnKS5hdHRyKCdhcmlhLWhpZGRlbicsICdmYWxzZScpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2Vycy5maWx0ZXIoJ1tkYXRhLXVrLXNsaWRlc2hvdy1pdGVtPVwiJyt0aGlzLmN1cnJlbnQrJ1wiXScpLmFkZENsYXNzKCd1ay1hY3RpdmUnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHJlc2l6ZSAmJiBwcm9jZXNzZWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVzaXplKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICByZXNpemU6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuY29udGFpbmVyLmhhc0NsYXNzKCd1ay1zbGlkZXNob3ctZnVsbHNjcmVlbicpKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB2YXIgaGVpZ2h0ID0gdGhpcy5vcHRpb25zLmhlaWdodDtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaGVpZ2h0ID09PSAnYXV0bycpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuc2xpZGVzLmNzcygnaGVpZ2h0JywgJycpLmVhY2goZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ID0gTWF0aC5tYXgoaGVpZ2h0LCBVSS4kKHRoaXMpLmhlaWdodCgpKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5jc3MoJ2hlaWdodCcsIGhlaWdodCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2xpZGVzLmNzcygnaGVpZ2h0JywgaGVpZ2h0KTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBzaG93OiBmdW5jdGlvbihpbmRleCwgZGlyZWN0aW9uKSB7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5hbmltYXRpbmcgfHwgdGhpcy5jdXJyZW50ID09IGluZGV4KSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB0aGlzLmFuaW1hdGluZyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICB2YXIgJHRoaXMgICAgICAgID0gdGhpcyxcclxuICAgICAgICAgICAgICAgIGN1cnJlbnQgICAgICA9IHRoaXMuc2xpZGVzLmVxKHRoaXMuY3VycmVudCksXHJcbiAgICAgICAgICAgICAgICBuZXh0ICAgICAgICAgPSB0aGlzLnNsaWRlcy5lcShpbmRleCksXHJcbiAgICAgICAgICAgICAgICBkaXIgICAgICAgICAgPSBkaXJlY3Rpb24gPyBkaXJlY3Rpb24gOiB0aGlzLmN1cnJlbnQgPCBpbmRleCA/IDEgOiAtMSxcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRtZWRpYSA9IGN1cnJlbnQuZGF0YSgnbWVkaWEnKSxcclxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbiAgICA9IEFuaW1hdGlvbnNbdGhpcy5vcHRpb25zLmFuaW1hdGlvbl0gPyB0aGlzLm9wdGlvbnMuYW5pbWF0aW9uIDogJ2ZhZGUnLFxyXG4gICAgICAgICAgICAgICAgbmV4dG1lZGlhICAgID0gbmV4dC5kYXRhKCdtZWRpYScpLFxyXG4gICAgICAgICAgICAgICAgZmluYWxpemUgICAgID0gZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghJHRoaXMuYW5pbWF0aW5nKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50bWVkaWEgJiYgY3VycmVudG1lZGlhLmlzKCd2aWRlbyxpZnJhbWUnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5wYXVzZW1lZGlhKGN1cnJlbnRtZWRpYSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAobmV4dG1lZGlhICYmIG5leHRtZWRpYS5pcygndmlkZW8saWZyYW1lJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMucGxheW1lZGlhKG5leHRtZWRpYSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBuZXh0LmFkZENsYXNzKCd1ay1hY3RpdmUnKS5hdHRyKCdhcmlhLWhpZGRlbicsICdmYWxzZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnQucmVtb3ZlQ2xhc3MoJ3VrLWFjdGl2ZScpLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuYW5pbWF0aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuY3VycmVudCAgID0gaW5kZXg7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIFVJLlV0aWxzLmNoZWNrRGlzcGxheShuZXh0LCAnW2NsYXNzKj1cInVrLWFuaW1hdGlvbi1cIl06bm90KC51ay1jb3Zlci1iYWNrZ3JvdW5kLnVrLXBvc2l0aW9uLWNvdmVyKScpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkdGhpcy50cmlnZ2VyKCdzaG93LnVrLnNsaWRlc2hvdycsIFtuZXh0LCBjdXJyZW50LCAkdGhpc10pO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICR0aGlzLmFwcGx5S2VuQnVybnMobmV4dCk7XHJcblxyXG4gICAgICAgICAgICAvLyBhbmltYXRpb24gZmFsbGJhY2tcclxuICAgICAgICAgICAgaWYgKCFVSS5zdXBwb3J0LmFuaW1hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uID0gJ25vbmUnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjdXJyZW50ID0gVUkuJChjdXJyZW50KTtcclxuICAgICAgICAgICAgbmV4dCAgICA9IFVJLiQobmV4dCk7XHJcblxyXG4gICAgICAgICAgICAkdGhpcy50cmlnZ2VyKCdiZWZvcmVzaG93LnVrLnNsaWRlc2hvdycsIFtuZXh0LCBjdXJyZW50LCAkdGhpc10pO1xyXG5cclxuICAgICAgICAgICAgQW5pbWF0aW9uc1thbmltYXRpb25dLmFwcGx5KHRoaXMsIFtjdXJyZW50LCBuZXh0LCBkaXJdKS50aGVuKGZpbmFsaXplKTtcclxuXHJcbiAgICAgICAgICAgICR0aGlzLnRyaWdnZXJzLnJlbW92ZUNsYXNzKCd1ay1hY3RpdmUnKTtcclxuICAgICAgICAgICAgJHRoaXMudHJpZ2dlcnMuZmlsdGVyKCdbZGF0YS11ay1zbGlkZXNob3ctaXRlbT1cIicraW5kZXgrJ1wiXScpLmFkZENsYXNzKCd1ay1hY3RpdmUnKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBhcHBseUtlbkJ1cm5zOiBmdW5jdGlvbihzbGlkZSkge1xyXG5cclxuICAgICAgICAgICAgaWYgKCF0aGlzLmhhc0tlbkJ1cm5zKHNsaWRlKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgYW5pbWF0aW9ucyA9IHRoaXMub3B0aW9ucy5rZW5idXJuc2FuaW1hdGlvbnMsXHJcbiAgICAgICAgICAgICAgICBpbmRleCAgICAgID0gdGhpcy5rYmluZGV4IHx8IDA7XHJcblxyXG5cclxuICAgICAgICAgICAgc2xpZGUuZGF0YSgnY292ZXInKS5hdHRyKCdjbGFzcycsICd1ay1jb3Zlci1iYWNrZ3JvdW5kIHVrLXBvc2l0aW9uLWNvdmVyJykud2lkdGgoKTtcclxuICAgICAgICAgICAgc2xpZGUuZGF0YSgnY292ZXInKS5hZGRDbGFzcyhbJ3VrLWFuaW1hdGlvbi1zY2FsZScsICd1ay1hbmltYXRpb24tcmV2ZXJzZScsIGFuaW1hdGlvbnNbaW5kZXhdLnRyaW0oKV0uam9pbignICcpKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMua2JpbmRleCA9IGFuaW1hdGlvbnNbaW5kZXggKyAxXSA/IChpbmRleCsxKTowO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGhhc0tlbkJ1cm5zOiBmdW5jdGlvbihzbGlkZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gKHRoaXMub3B0aW9ucy5rZW5idXJucyAmJiBzbGlkZS5kYXRhKCdjb3ZlcicpKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBuZXh0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdGhpcy5zaG93KHRoaXMuc2xpZGVzW3RoaXMuY3VycmVudCArIDFdID8gKHRoaXMuY3VycmVudCArIDEpIDogMCwgMSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgcHJldmlvdXM6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB0aGlzLnNob3codGhpcy5zbGlkZXNbdGhpcy5jdXJyZW50IC0gMV0gPyAodGhpcy5jdXJyZW50IC0gMSkgOiAodGhpcy5zbGlkZXMubGVuZ3RoIC0gMSksIC0xKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBzdGFydDogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnN0b3AoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciAkdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLmhvdmVyaW5nKSAkdGhpcy5uZXh0KCk7XHJcbiAgICAgICAgICAgIH0sIHRoaXMub3B0aW9ucy5hdXRvcGxheUludGVydmFsKTtcclxuXHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgc3RvcDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmludGVydmFsKSBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWwpO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHBsYXltZWRpYTogZnVuY3Rpb24obWVkaWEpIHtcclxuXHJcbiAgICAgICAgICAgIGlmICghKG1lZGlhICYmIG1lZGlhWzBdKSkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgc3dpdGNoKG1lZGlhWzBdLm5vZGVOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdWSURFTyc6XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5vcHRpb25zLnZpZGVvbXV0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZWRpYVswXS5tdXRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbWVkaWFbMF0ucGxheSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnSUZSQU1FJzpcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMudmlkZW9tdXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lZGlhWzBdLmNvbnRlbnRXaW5kb3cucG9zdE1lc3NhZ2UoJ3sgXCJldmVudFwiOiBcImNvbW1hbmRcIiwgXCJmdW5jXCI6IFwidW5tdXRlXCIsIFwibWV0aG9kXCI6XCJzZXRWb2x1bWVcIiwgXCJ2YWx1ZVwiOjF9JywgJyonKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIG1lZGlhWzBdLmNvbnRlbnRXaW5kb3cucG9zdE1lc3NhZ2UoJ3sgXCJldmVudFwiOiBcImNvbW1hbmRcIiwgXCJmdW5jXCI6IFwicGxheVZpZGVvXCIsIFwibWV0aG9kXCI6XCJwbGF5XCJ9JywgJyonKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHBhdXNlbWVkaWE6IGZ1bmN0aW9uKG1lZGlhKSB7XHJcblxyXG4gICAgICAgICAgICBzd2l0Y2gobWVkaWFbMF0ubm9kZU5hbWUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ1ZJREVPJzpcclxuICAgICAgICAgICAgICAgICAgICBtZWRpYVswXS5wYXVzZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnSUZSQU1FJzpcclxuICAgICAgICAgICAgICAgICAgICBtZWRpYVswXS5jb250ZW50V2luZG93LnBvc3RNZXNzYWdlKCd7IFwiZXZlbnRcIjogXCJjb21tYW5kXCIsIFwiZnVuY1wiOiBcInBhdXNlVmlkZW9cIiwgXCJtZXRob2RcIjpcInBhdXNlXCJ9JywgJyonKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIG11dGVtZWRpYTogZnVuY3Rpb24obWVkaWEpIHtcclxuXHJcbiAgICAgICAgICAgIHN3aXRjaChtZWRpYVswXS5ub2RlTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnVklERU8nOlxyXG4gICAgICAgICAgICAgICAgICAgIG1lZGlhWzBdLm11dGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0lGUkFNRSc6XHJcbiAgICAgICAgICAgICAgICAgICAgbWVkaWFbMF0uY29udGVudFdpbmRvdy5wb3N0TWVzc2FnZSgneyBcImV2ZW50XCI6IFwiY29tbWFuZFwiLCBcImZ1bmNcIjogXCJtdXRlXCIsIFwibWV0aG9kXCI6XCJzZXRWb2x1bWVcIiwgXCJ2YWx1ZVwiOjB9JywgJyonKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIEFuaW1hdGlvbnMgPSB7XHJcblxyXG4gICAgICAgICdub25lJzogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgZCA9IFVJLiQuRGVmZXJyZWQoKTtcclxuICAgICAgICAgICAgZC5yZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBkLnByb21pc2UoKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAnc2Nyb2xsJzogZnVuY3Rpb24oY3VycmVudCwgbmV4dCwgZGlyKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgZCA9IFVJLiQuRGVmZXJyZWQoKTtcclxuXHJcbiAgICAgICAgICAgIGN1cnJlbnQuY3NzKCdhbmltYXRpb24tZHVyYXRpb24nLCB0aGlzLm9wdGlvbnMuZHVyYXRpb24rJ21zJyk7XHJcbiAgICAgICAgICAgIG5leHQuY3NzKCdhbmltYXRpb24tZHVyYXRpb24nLCB0aGlzLm9wdGlvbnMuZHVyYXRpb24rJ21zJyk7XHJcblxyXG4gICAgICAgICAgICBuZXh0LmNzcygnb3BhY2l0eScsIDEpLm9uZShVSS5zdXBwb3J0LmFuaW1hdGlvbi5lbmQsIGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgICAgIGN1cnJlbnQuY3NzKCdvcGFjaXR5JywgMCkucmVtb3ZlQ2xhc3MoZGlyID09IC0xID8gJ3VrLXNsaWRlc2hvdy1zY3JvbGwtYmFja3dhcmQtb3V0JyA6ICd1ay1zbGlkZXNob3ctc2Nyb2xsLWZvcndhcmQtb3V0Jyk7XHJcbiAgICAgICAgICAgICAgICBuZXh0LnJlbW92ZUNsYXNzKGRpciA9PSAtMSA/ICd1ay1zbGlkZXNob3ctc2Nyb2xsLWJhY2t3YXJkLWluJyA6ICd1ay1zbGlkZXNob3ctc2Nyb2xsLWZvcndhcmQtaW4nKTtcclxuICAgICAgICAgICAgICAgIGQucmVzb2x2ZSgpO1xyXG5cclxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcclxuXHJcbiAgICAgICAgICAgIGN1cnJlbnQuYWRkQ2xhc3MoZGlyID09IC0xID8gJ3VrLXNsaWRlc2hvdy1zY3JvbGwtYmFja3dhcmQtb3V0JyA6ICd1ay1zbGlkZXNob3ctc2Nyb2xsLWZvcndhcmQtb3V0Jyk7XHJcbiAgICAgICAgICAgIG5leHQuYWRkQ2xhc3MoZGlyID09IC0xID8gJ3VrLXNsaWRlc2hvdy1zY3JvbGwtYmFja3dhcmQtaW4nIDogJ3VrLXNsaWRlc2hvdy1zY3JvbGwtZm9yd2FyZC1pbicpO1xyXG4gICAgICAgICAgICBuZXh0LndpZHRoKCk7IC8vIGZvcmNlIHJlZHJhd1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZSgpO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgICdzd2lwZSc6IGZ1bmN0aW9uKGN1cnJlbnQsIG5leHQsIGRpcikge1xyXG5cclxuICAgICAgICAgICAgdmFyIGQgPSBVSS4kLkRlZmVycmVkKCk7XHJcblxyXG4gICAgICAgICAgICBjdXJyZW50LmNzcygnYW5pbWF0aW9uLWR1cmF0aW9uJywgdGhpcy5vcHRpb25zLmR1cmF0aW9uKydtcycpO1xyXG4gICAgICAgICAgICBuZXh0LmNzcygnYW5pbWF0aW9uLWR1cmF0aW9uJywgdGhpcy5vcHRpb25zLmR1cmF0aW9uKydtcycpO1xyXG5cclxuICAgICAgICAgICAgbmV4dC5jc3MoJ29wYWNpdHknLCAxKS5vbmUoVUkuc3VwcG9ydC5hbmltYXRpb24uZW5kLCBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBjdXJyZW50LmNzcygnb3BhY2l0eScsIDApLnJlbW92ZUNsYXNzKGRpciA9PT0gLTEgPyAndWstc2xpZGVzaG93LXN3aXBlLWJhY2t3YXJkLW91dCcgOiAndWstc2xpZGVzaG93LXN3aXBlLWZvcndhcmQtb3V0Jyk7XHJcbiAgICAgICAgICAgICAgICBuZXh0LnJlbW92ZUNsYXNzKGRpciA9PT0gLTEgPyAndWstc2xpZGVzaG93LXN3aXBlLWJhY2t3YXJkLWluJyA6ICd1ay1zbGlkZXNob3ctc3dpcGUtZm9yd2FyZC1pbicpO1xyXG4gICAgICAgICAgICAgICAgZC5yZXNvbHZlKCk7XHJcblxyXG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xyXG5cclxuICAgICAgICAgICAgY3VycmVudC5hZGRDbGFzcyhkaXIgPT0gLTEgPyAndWstc2xpZGVzaG93LXN3aXBlLWJhY2t3YXJkLW91dCcgOiAndWstc2xpZGVzaG93LXN3aXBlLWZvcndhcmQtb3V0Jyk7XHJcbiAgICAgICAgICAgIG5leHQuYWRkQ2xhc3MoZGlyID09IC0xID8gJ3VrLXNsaWRlc2hvdy1zd2lwZS1iYWNrd2FyZC1pbicgOiAndWstc2xpZGVzaG93LXN3aXBlLWZvcndhcmQtaW4nKTtcclxuICAgICAgICAgICAgbmV4dC53aWR0aCgpOyAvLyBmb3JjZSByZWRyYXdcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkLnByb21pc2UoKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAnc2NhbGUnOiBmdW5jdGlvbihjdXJyZW50LCBuZXh0LCBkaXIpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBkID0gVUkuJC5EZWZlcnJlZCgpO1xyXG5cclxuICAgICAgICAgICAgY3VycmVudC5jc3MoJ2FuaW1hdGlvbi1kdXJhdGlvbicsIHRoaXMub3B0aW9ucy5kdXJhdGlvbisnbXMnKTtcclxuICAgICAgICAgICAgbmV4dC5jc3MoJ2FuaW1hdGlvbi1kdXJhdGlvbicsIHRoaXMub3B0aW9ucy5kdXJhdGlvbisnbXMnKTtcclxuXHJcbiAgICAgICAgICAgIG5leHQuY3NzKCdvcGFjaXR5JywgMSk7XHJcblxyXG4gICAgICAgICAgICBjdXJyZW50Lm9uZShVSS5zdXBwb3J0LmFuaW1hdGlvbi5lbmQsIGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgICAgIGN1cnJlbnQuY3NzKCdvcGFjaXR5JywgMCkucmVtb3ZlQ2xhc3MoJ3VrLXNsaWRlc2hvdy1zY2FsZS1vdXQnKTtcclxuICAgICAgICAgICAgICAgIGQucmVzb2x2ZSgpO1xyXG5cclxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcclxuXHJcbiAgICAgICAgICAgIGN1cnJlbnQuYWRkQ2xhc3MoJ3VrLXNsaWRlc2hvdy1zY2FsZS1vdXQnKTtcclxuICAgICAgICAgICAgY3VycmVudC53aWR0aCgpOyAvLyBmb3JjZSByZWRyYXdcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkLnByb21pc2UoKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAnZmFkZSc6IGZ1bmN0aW9uKGN1cnJlbnQsIG5leHQsIGRpcikge1xyXG5cclxuICAgICAgICAgICAgdmFyIGQgPSBVSS4kLkRlZmVycmVkKCk7XHJcblxyXG4gICAgICAgICAgICBjdXJyZW50LmNzcygnYW5pbWF0aW9uLWR1cmF0aW9uJywgdGhpcy5vcHRpb25zLmR1cmF0aW9uKydtcycpO1xyXG4gICAgICAgICAgICBuZXh0LmNzcygnYW5pbWF0aW9uLWR1cmF0aW9uJywgdGhpcy5vcHRpb25zLmR1cmF0aW9uKydtcycpO1xyXG5cclxuICAgICAgICAgICAgbmV4dC5jc3MoJ29wYWNpdHknLCAxKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGZvciBwbGFpbiB0ZXh0IGNvbnRlbnQgc2xpZGVzIC0gbG9va3Mgc21vb3RoZXJcclxuICAgICAgICAgICAgaWYgKCEobmV4dC5kYXRhKCdjb3ZlcicpIHx8IG5leHQuZGF0YSgncGxhY2Vob2xkZXInKSkpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBuZXh0LmNzcygnb3BhY2l0eScsIDEpLm9uZShVSS5zdXBwb3J0LmFuaW1hdGlvbi5lbmQsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5leHQucmVtb3ZlQ2xhc3MoJ3VrLXNsaWRlc2hvdy1mYWRlLWluJyk7XHJcbiAgICAgICAgICAgICAgICB9KS5hZGRDbGFzcygndWstc2xpZGVzaG93LWZhZGUtaW4nKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY3VycmVudC5vbmUoVUkuc3VwcG9ydC5hbmltYXRpb24uZW5kLCBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBjdXJyZW50LmNzcygnb3BhY2l0eScsIDApLnJlbW92ZUNsYXNzKCd1ay1zbGlkZXNob3ctZmFkZS1vdXQnKTtcclxuICAgICAgICAgICAgICAgIGQucmVzb2x2ZSgpO1xyXG5cclxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcclxuXHJcbiAgICAgICAgICAgIGN1cnJlbnQuYWRkQ2xhc3MoJ3VrLXNsaWRlc2hvdy1mYWRlLW91dCcpO1xyXG4gICAgICAgICAgICBjdXJyZW50LndpZHRoKCk7IC8vIGZvcmNlIHJlZHJhd1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgVUkuc2xpZGVzaG93LmFuaW1hdGlvbnMgPSBBbmltYXRpb25zO1xyXG5cclxuICAgIC8vIExpc3RlbiBmb3IgbWVzc2FnZXMgZnJvbSB0aGUgdmltZW8gcGxheWVyXHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIG9uTWVzc2FnZVJlY2VpdmVkKGUpIHtcclxuXHJcbiAgICAgICAgdmFyIGRhdGEgPSBlLmRhdGEsIGlmcmFtZTtcclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZihkYXRhKSA9PSAnc3RyaW5nJykge1xyXG5cclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGRhdGEgPSBKU09OLnBhcnNlKGRhdGEpO1xyXG4gICAgICAgICAgICB9IGNhdGNoKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGF0YSA9IHt9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZS5vcmlnaW4gJiYgZS5vcmlnaW4uaW5kZXhPZigndmltZW8nKSA+IC0xICYmIGRhdGEuZXZlbnQgPT0gJ3JlYWR5JyAmJiBkYXRhLnBsYXllcl9pZCkge1xyXG4gICAgICAgICAgICBpZnJhbWUgPSBVSS4kKCdbZGF0YS1wbGF5ZXItaWQ9XCInKyBkYXRhLnBsYXllcl9pZCsnXCJdJyk7XHJcblxyXG4gICAgICAgICAgICBpZiAoaWZyYW1lLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgaWZyYW1lLmRhdGEoJ3NsaWRlc2hvdycpLm11dGVtZWRpYShpZnJhbWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSwgZmFsc2UpO1xyXG5cclxufSk7Il19
