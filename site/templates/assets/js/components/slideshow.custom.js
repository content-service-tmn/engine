!function(i){var t;window.UIkit2&&(t=i(UIkit2)),"function"==typeof define&&define.amd&&define("uikit-slideshow",["uikit"],function(){return t||i(UIkit2)})}(function(l){"use strict";var u,p=0;l.component("slideshow",{defaults:{animation:"fade",duration:500,height:"auto",start:0,autoplay:!1,autoplayInterval:7e3,videoautoplay:!0,videomute:!0,slices:15,pauseOnHover:!0,kenburns:!1,kenburnsanimations:["uk-animation-middle-left","uk-animation-top-right","uk-animation-bottom-left","uk-animation-top-center","","uk-animation-bottom-right"]},current:!1,interval:null,hovering:!1,boot:function(){l.ready(function(i){l.$("[data-uk-slideshow]",i).each(function(){var i=l.$(this);i.data("slideshow")||l.slideshow(i,l.Utils.options(i.attr("data-uk-slideshow")))})})},init:function(){var s=this;this.container=this.element.hasClass("uk-slideshow")?this.element:l.$(this.find(".uk-slideshow:first")),this.current=this.options.start,this.animating=!1,this.fixFullscreen=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)&&this.container.hasClass("uk-slideshow-fullscreen"),this.options.kenburns&&(this.kbanimduration=!0===this.options.kenburns?"15s":this.options.kenburns,String(this.kbanimduration).match(/(ms|s)$/)||(this.kbanimduration+="ms"),"string"==typeof this.options.kenburnsanimations&&(this.options.kenburnsanimations=this.options.kenburnsanimations.split(","))),this.update(),this.on("click.uk.slideshow","[data-uk-slideshow-item]",function(i){i.preventDefault();var t=l.$(this).attr("data-uk-slideshow-item");if(s.current!=t){switch(t){case"next":case"previous":s["next"==t?"next":"previous"]();break;default:s.show(parseInt(t,10))}s.stop()}}),l.$win.on("resize load",l.Utils.debounce(function(){s.resize(),s.fixFullscreen&&(s.container.css("height",window.innerHeight),s.slides.css("height",window.innerHeight))},100)),setTimeout(function(){s.resize()},80),this.options.autoplay&&this.start(),this.options.videoautoplay&&this.slides.eq(this.current).data("media")&&this.playmedia(this.slides.eq(this.current).data("media")),this.options.kenburns&&this.applyKenBurns(this.slides.eq(this.current)),this.container.on({mouseenter:function(){s.options.pauseOnHover&&(s.hovering=!0)},mouseleave:function(){s.hovering=!1}}),this.on("swipeRight swipeLeft",function(i){s["swipeLeft"==i.type?"next":"previous"]()}),this.on("display.uk.check",function(){s.element.is(":visible")&&(s.resize(),s.fixFullscreen&&(s.container.css("height",window.innerHeight),s.slides.css("height",window.innerHeight)))}),l.domObserve(this.element,function(i){s.container.children(":not([data-slideshow-slide])").not(".uk-slideshow-ghost").length&&s.update(!0)})},update:function(i){var u,h=this,c=0;this.slides=this.container.children(),this.slidesCount=this.slides.length,this.slides.eq(this.current).length||(this.current=0),this.slides.each(function(s){var i=l.$(this);if(!i.data("processed")){var e=i.children("img,video,iframe").eq(0),t="html";if(i.data("media",e),i.data("sizer",e),e.length){var a;switch(t=e[0].nodeName.toLowerCase(),e[0].nodeName){case"IMG":var n=l.$('<div class="uk-cover-background uk-position-cover"></div>').css({"background-image":"url("+e.attr("src")+")"});e.attr("width")&&e.attr("height")&&(a=l.$("<canvas></canvas>").attr({width:e.attr("width"),height:e.attr("height")}),e.replaceWith(a),e=a,a=void 0),e.css({width:"100%",height:"auto",opacity:0}),i.prepend(n).data("cover",n);break;case"IFRAME":var o=e[0].src,r="sw-"+ ++p;e.attr("src","").on("load",function(){if((s!==h.current||s==h.current&&!h.options.videoautoplay)&&h.pausemedia(e),h.options.videomute){h.mutemedia(e);var i=setInterval((t=0,function(){h.mutemedia(e),4<=++t&&clearInterval(i)}),250)}var t}).data("slideshow",h).attr("data-player-id",r).attr("src",[o,-1<o.indexOf("?")?"&":"?","enablejsapi=1&api=1&player_id="+r].join("")).addClass("uk-position-absolute"),l.support.touch||e.css("pointer-events","none"),a=!0,l.cover&&(l.cover(e),e.attr("data-uk-cover","{}"));break;case"VIDEO":e.addClass("uk-cover-object uk-position-absolute"),a=!0,h.options.videomute&&h.mutemedia(e)}if(a){u=l.$("<canvas></canvas>").attr({width:e[0].width,height:e[0].height});var d=l.$('<img style="width:100%;height:auto;">').attr("src",u[0].toDataURL());i.prepend(d),i.data("sizer",d)}}else i.data("sizer",i);h.hasKenBurns(i)&&i.data("cover").css({"-webkit-animation-duration":h.kbanimduration,"animation-duration":h.kbanimduration}),i.data("processed",++c),i.attr("data-slideshow-slide",t)}}),c&&(this.triggers=this.find("[data-uk-slideshow-item]"),this.slides.attr("aria-hidden","true").removeClass("uk-active").eq(this.current).addClass("uk-active").attr("aria-hidden","false"),this.triggers.filter('[data-uk-slideshow-item="'+this.current+'"]').addClass("uk-active")),i&&c&&this.resize()},resize:function(){if(!this.container.hasClass("uk-slideshow-fullscreen")){var i=this.options.height;"auto"===this.options.height&&(i=0,this.slides.css("height","").each(function(){i=Math.max(i,l.$(this).height())})),this.container.css("height",i),this.slides.css("height",i)}},show:function(i,t){if(!this.animating&&this.current!=i){this.animating=!0;var s=this,e=this.slides.eq(this.current),a=this.slides.eq(i),n=t||(this.current<i?1:-1),o=e.data("media"),r=u[this.options.animation]?this.options.animation:"fade",d=a.data("media");s.applyKenBurns(a),l.support.animation||(r="none"),e=l.$(e),a=l.$(a),s.trigger("beforeshow.uk.slideshow",[a,e,s]),u[r].apply(this,[e,a,n]).then(function(){s.animating&&(o&&o.is("video,iframe")&&s.pausemedia(o),d&&d.is("video,iframe")&&s.playmedia(d),a.addClass("uk-active").attr("aria-hidden","false"),e.removeClass("uk-active").attr("aria-hidden","true"),s.animating=!1,s.current=i,l.Utils.checkDisplay(a,'[class*="uk-animation-"]:not(.uk-cover-background.uk-position-cover)'),s.trigger("show.uk.slideshow",[a,e,s]))}),s.triggers.removeClass("uk-active"),s.triggers.filter('[data-uk-slideshow-item="'+i+'"]').addClass("uk-active")}},applyKenBurns:function(i){if(this.hasKenBurns(i)){var t=this.options.kenburnsanimations,s=this.kbindex||0;i.data("cover").attr("class","uk-cover-background uk-position-cover").width(),i.data("cover").addClass(["uk-animation-scale","uk-animation-reverse",t[s].trim()].join(" ")),this.kbindex=t[s+1]?s+1:0}},hasKenBurns:function(i){return this.options.kenburns&&i.data("cover")},next:function(){this.show(this.slides[this.current+1]?this.current+1:0,1)},previous:function(){this.show(this.slides[this.current-1]?this.current-1:this.slides.length-1,-1)},start:function(){this.stop();var i=this;this.interval=setInterval(function(){i.hovering||i.next()},this.options.autoplayInterval)},stop:function(){this.interval&&clearInterval(this.interval)},playmedia:function(i){if(i&&i[0])switch(i[0].nodeName){case"VIDEO":this.options.videomute||(i[0].muted=!1),i[0].play();break;case"IFRAME":this.options.videomute||i[0].contentWindow.postMessage('{ "event": "command", "func": "unmute", "method":"setVolume", "value":1}',"*"),i[0].contentWindow.postMessage('{ "event": "command", "func": "playVideo", "method":"play"}',"*")}},pausemedia:function(i){switch(i[0].nodeName){case"VIDEO":i[0].pause();break;case"IFRAME":i[0].contentWindow.postMessage('{ "event": "command", "func": "pauseVideo", "method":"pause"}',"*")}},mutemedia:function(i){switch(i[0].nodeName){case"VIDEO":i[0].muted=!0;break;case"IFRAME":i[0].contentWindow.postMessage('{ "event": "command", "func": "mute", "method":"setVolume", "value":0}',"*")}}}),u={none:function(){var i=l.$.Deferred();return i.resolve(),i.promise()},scroll:function(i,t,s){var e=l.$.Deferred();return i.css("animation-duration",this.options.duration+"ms"),t.css("animation-duration",this.options.duration+"ms"),t.css("opacity",1).one(l.support.animation.end,function(){i.css("opacity",0).removeClass(-1==s?"uk-slideshow-scroll-backward-out":"uk-slideshow-scroll-forward-out"),t.removeClass(-1==s?"uk-slideshow-scroll-backward-in":"uk-slideshow-scroll-forward-in"),e.resolve()}.bind(this)),i.addClass(-1==s?"uk-slideshow-scroll-backward-out":"uk-slideshow-scroll-forward-out"),t.addClass(-1==s?"uk-slideshow-scroll-backward-in":"uk-slideshow-scroll-forward-in"),t.width(),e.promise()},swipe:function(i,t,s){var e=l.$.Deferred();return i.css("animation-duration",this.options.duration+"ms"),t.css("animation-duration",this.options.duration+"ms"),t.css("opacity",1).one(l.support.animation.end,function(){i.css("opacity",0).removeClass(-1===s?"uk-slideshow-swipe-backward-out":"uk-slideshow-swipe-forward-out"),t.removeClass(-1===s?"uk-slideshow-swipe-backward-in":"uk-slideshow-swipe-forward-in"),e.resolve()}.bind(this)),i.addClass(-1==s?"uk-slideshow-swipe-backward-out":"uk-slideshow-swipe-forward-out"),t.addClass(-1==s?"uk-slideshow-swipe-backward-in":"uk-slideshow-swipe-forward-in"),t.width(),e.promise()},scale:function(i,t,s){var e=l.$.Deferred();return i.css("animation-duration",this.options.duration+"ms"),t.css("animation-duration",this.options.duration+"ms"),t.css("opacity",1),i.one(l.support.animation.end,function(){i.css("opacity",0).removeClass("uk-slideshow-scale-out"),e.resolve()}.bind(this)),i.addClass("uk-slideshow-scale-out"),i.width(),e.promise()},fade:function(i,t,s){var e=l.$.Deferred();return i.css("animation-duration",this.options.duration+"ms"),t.css("animation-duration",this.options.duration+"ms"),t.css("opacity",1),t.data("cover")||t.data("placeholder")||t.css("opacity",1).one(l.support.animation.end,function(){t.removeClass("uk-slideshow-fade-in")}).addClass("uk-slideshow-fade-in"),i.one(l.support.animation.end,function(){i.css("opacity",0).removeClass("uk-slideshow-fade-out"),e.resolve()}.bind(this)),i.addClass("uk-slideshow-fade-out"),i.width(),e.promise()}},l.slideshow.animations=u,window.addEventListener("message",function(i){var t,s=i.data;if("string"==typeof s)try{s=JSON.parse(s)}catch(i){s={}}i.origin&&-1<i.origin.indexOf("vimeo")&&"ready"==s.event&&s.player_id&&(t=l.$('[data-player-id="'+s.player_id+'"]')).length&&t.data("slideshow").mutemedia(t)},!1)});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvc2xpZGVzaG93LmN1c3RvbS5qcyJdLCJuYW1lcyI6WyJhZGRvbiIsImNvbXBvbmVudCIsIndpbmRvdyIsIlVJa2l0MiIsImRlZmluZSIsImFtZCIsIlVJIiwiQW5pbWF0aW9ucyIsInBsYXllcklkIiwiZGVmYXVsdHMiLCJhbmltYXRpb24iLCJkdXJhdGlvbiIsImhlaWdodCIsInN0YXJ0IiwiYXV0b3BsYXkiLCJhdXRvcGxheUludGVydmFsIiwidmlkZW9hdXRvcGxheSIsInZpZGVvbXV0ZSIsInNsaWNlcyIsInBhdXNlT25Ib3ZlciIsImtlbmJ1cm5zIiwia2VuYnVybnNhbmltYXRpb25zIiwiY3VycmVudCIsImludGVydmFsIiwiaG92ZXJpbmciLCJib290IiwicmVhZHkiLCJjb250ZXh0IiwiJCIsImVhY2giLCJzbGlkZXNob3ciLCJ0aGlzIiwiZGF0YSIsIlV0aWxzIiwib3B0aW9ucyIsImF0dHIiLCJpbml0IiwiJHRoaXMiLCJjb250YWluZXIiLCJlbGVtZW50IiwiaGFzQ2xhc3MiLCJmaW5kIiwiYW5pbWF0aW5nIiwiZml4RnVsbHNjcmVlbiIsIm5hdmlnYXRvciIsInVzZXJBZ2VudCIsIm1hdGNoIiwia2JhbmltZHVyYXRpb24iLCJTdHJpbmciLCJzcGxpdCIsInVwZGF0ZSIsIm9uIiwiZSIsInByZXZlbnREZWZhdWx0Iiwic2xpZGUiLCJzaG93IiwicGFyc2VJbnQiLCJzdG9wIiwiJHdpbiIsImRlYm91bmNlIiwicmVzaXplIiwiY3NzIiwiaW5uZXJIZWlnaHQiLCJzbGlkZXMiLCJzZXRUaW1lb3V0IiwiZXEiLCJwbGF5bWVkaWEiLCJhcHBseUtlbkJ1cm5zIiwibW91c2VlbnRlciIsIm1vdXNlbGVhdmUiLCJ0eXBlIiwiaXMiLCJkb21PYnNlcnZlIiwiY2hpbGRyZW4iLCJub3QiLCJsZW5ndGgiLCJjYW52YXMiLCJwcm9jZXNzZWQiLCJzbGlkZXNDb3VudCIsImluZGV4IiwibWVkaWEiLCJwbGFjZWhvbGRlciIsIm5vZGVOYW1lIiwidG9Mb3dlckNhc2UiLCJjb3ZlciIsImJhY2tncm91bmQtaW1hZ2UiLCJ3aWR0aCIsInJlcGxhY2VXaXRoIiwidW5kZWZpbmVkIiwib3BhY2l0eSIsInByZXBlbmQiLCJzcmMiLCJpZnJhbWVJZCIsInBhdXNlbWVkaWEiLCJtdXRlbWVkaWEiLCJpbnYiLCJzZXRJbnRlcnZhbCIsImljIiwiY2xlYXJJbnRlcnZhbCIsImluZGV4T2YiLCJqb2luIiwiYWRkQ2xhc3MiLCJzdXBwb3J0IiwidG91Y2giLCJpbWciLCJ0b0RhdGFVUkwiLCJoYXNLZW5CdXJucyIsIi13ZWJraXQtYW5pbWF0aW9uLWR1cmF0aW9uIiwiYW5pbWF0aW9uLWR1cmF0aW9uIiwidHJpZ2dlcnMiLCJyZW1vdmVDbGFzcyIsImZpbHRlciIsIk1hdGgiLCJtYXgiLCJkaXJlY3Rpb24iLCJuZXh0IiwiZGlyIiwiY3VycmVudG1lZGlhIiwibmV4dG1lZGlhIiwidHJpZ2dlciIsImFwcGx5IiwidGhlbiIsImNoZWNrRGlzcGxheSIsImFuaW1hdGlvbnMiLCJrYmluZGV4IiwidHJpbSIsInByZXZpb3VzIiwibXV0ZWQiLCJwbGF5IiwiY29udGVudFdpbmRvdyIsInBvc3RNZXNzYWdlIiwicGF1c2UiLCJub25lIiwiZCIsIkRlZmVycmVkIiwicmVzb2x2ZSIsInByb21pc2UiLCJzY3JvbGwiLCJvbmUiLCJlbmQiLCJiaW5kIiwic3dpcGUiLCJzY2FsZSIsImZhZGUiLCJhZGRFdmVudExpc3RlbmVyIiwiaWZyYW1lIiwiSlNPTiIsInBhcnNlIiwiZXJyIiwib3JpZ2luIiwiZXZlbnQiLCJwbGF5ZXJfaWQiXSwibWFwcGluZ3MiOiJDQUNBLFNBQVVBLEdBRU4sSUFBSUMsRUFFQUMsT0FBT0MsU0FDUEYsRUFBWUQsRUFBTUcsU0FHRCxtQkFBVkMsUUFBd0JBLE9BQU9DLEtBQ3RDRCxPQUFPLGtCQUFtQixDQUFDLFNBQVUsV0FDakMsT0FBT0gsR0FBYUQsRUFBTUcsVUFWdEMsQ0FjRyxTQUFTRyxHQUVSLGFBRUEsSUFBSUMsRUFBWUMsRUFBVyxFQUUzQkYsRUFBR0wsVUFBVSxZQUFhLENBRXRCUSxTQUFVLENBQ05DLFVBQXFCLE9BQ3JCQyxTQUFxQixJQUNyQkMsT0FBcUIsT0FDckJDLE1BQXFCLEVBQ3JCQyxVQUFxQixFQUNyQkMsaUJBQXFCLElBQ3JCQyxlQUFxQixFQUNyQkMsV0FBcUIsRUFDckJDLE9BQXFCLEdBQ3JCQyxjQUFxQixFQUNyQkMsVUFBcUIsRUFDckJDLG1CQUFxQixDQUNqQiwyQkFDQSx5QkFDQSwyQkFDQSwwQkFDQSxHQUNBLDhCQUlSQyxTQUFXLEVBQ1hDLFNBQVcsS0FDWEMsVUFBVyxFQUVYQyxLQUFNLFdBR0ZuQixFQUFHb0IsTUFBTSxTQUFTQyxHQUVkckIsRUFBR3NCLEVBQUUsc0JBQXVCRCxHQUFTRSxLQUFLLFdBRXRDLElBQUlDLEVBQVl4QixFQUFHc0IsRUFBRUcsTUFFaEJELEVBQVVFLEtBQUssY0FDaEIxQixFQUFHd0IsVUFBVUEsRUFBV3hCLEVBQUcyQixNQUFNQyxRQUFRSixFQUFVSyxLQUFLLDRCQU14RUMsS0FBTSxXQUVGLElBQUlDLEVBQVFOLEtBRVpBLEtBQUtPLFVBQWdCUCxLQUFLUSxRQUFRQyxTQUFTLGdCQUFrQlQsS0FBS1EsUUFBVWpDLEVBQUdzQixFQUFFRyxLQUFLVSxLQUFLLHdCQUMzRlYsS0FBS1QsUUFBZ0JTLEtBQUtHLFFBQVFyQixNQUNsQ2tCLEtBQUtXLFdBQWdCLEVBRXJCWCxLQUFLWSxjQUFnQkMsVUFBVUMsVUFBVUMsTUFBTSx3QkFBMEJmLEtBQUtPLFVBQVVFLFNBQVMsMkJBRTdGVCxLQUFLRyxRQUFRZCxXQUViVyxLQUFLZ0IsZ0JBQTJDLElBQTFCaEIsS0FBS0csUUFBUWQsU0FBb0IsTUFBT1csS0FBS0csUUFBUWQsU0FFdEU0QixPQUFPakIsS0FBS2dCLGdCQUFnQkQsTUFBTSxhQUNuQ2YsS0FBS2dCLGdCQUFrQixNQUdvQixpQkFBcENoQixLQUFLRyxRQUEwQixxQkFDdENILEtBQUtHLFFBQVFiLG1CQUFxQlUsS0FBS0csUUFBUWIsbUJBQW1CNEIsTUFBTSxPQUloRmxCLEtBQUttQixTQUVMbkIsS0FBS29CLEdBQUcscUJBQXNCLDJCQUE0QixTQUFTQyxHQUUvREEsRUFBRUMsaUJBRUYsSUFBSUMsRUFBUWhELEVBQUdzQixFQUFFRyxNQUFNSSxLQUFLLDBCQUU1QixHQUFJRSxFQUFNZixTQUFXZ0MsRUFBckIsQ0FFQSxPQUFPQSxHQUNILElBQUssT0FDTCxJQUFLLFdBQ0RqQixFQUFhLFFBQVBpQixFQUFnQixPQUFPLGNBQzdCLE1BQ0osUUFDSWpCLEVBQU1rQixLQUFLQyxTQUFTRixFQUFPLEtBR25DakIsRUFBTW9CLFVBR1ZuRCxFQUFHb0QsS0FBS1AsR0FBRyxjQUFlN0MsRUFBRzJCLE1BQU0wQixTQUFTLFdBQ3hDdEIsRUFBTXVCLFNBRUZ2QixFQUFNTSxnQkFDTk4sRUFBTUMsVUFBVXVCLElBQUksU0FBVTNELE9BQU80RCxhQUNyQ3pCLEVBQU0wQixPQUFPRixJQUFJLFNBQVUzRCxPQUFPNEQsZUFFdkMsTUFHSEUsV0FBVyxXQUNQM0IsRUFBTXVCLFVBQ1AsSUFHQzdCLEtBQUtHLFFBQVFwQixVQUNiaUIsS0FBS2xCLFFBR0xrQixLQUFLRyxRQUFRbEIsZUFBaUJlLEtBQUtnQyxPQUFPRSxHQUFHbEMsS0FBS1QsU0FBU1UsS0FBSyxVQUNoRUQsS0FBS21DLFVBQVVuQyxLQUFLZ0MsT0FBT0UsR0FBR2xDLEtBQUtULFNBQVNVLEtBQUssVUFHakRELEtBQUtHLFFBQVFkLFVBQ2JXLEtBQUtvQyxjQUFjcEMsS0FBS2dDLE9BQU9FLEdBQUdsQyxLQUFLVCxVQUczQ1MsS0FBS08sVUFBVWEsR0FBRyxDQUNkaUIsV0FBWSxXQUFpQi9CLEVBQU1ILFFBQVFmLGVBQWNrQixFQUFNYixVQUFXLElBQzFFNkMsV0FBWSxXQUFhaEMsRUFBTWIsVUFBVyxLQUc5Q08sS0FBS29CLEdBQUcsdUJBQXdCLFNBQVNDLEdBQ3JDZixFQUFjLGFBQVJlLEVBQUVrQixLQUFvQixPQUFTLGdCQUd6Q3ZDLEtBQUtvQixHQUFHLG1CQUFvQixXQUNwQmQsRUFBTUUsUUFBUWdDLEdBQUcsY0FFakJsQyxFQUFNdUIsU0FFRnZCLEVBQU1NLGdCQUNOTixFQUFNQyxVQUFVdUIsSUFBSSxTQUFVM0QsT0FBTzRELGFBQ3JDekIsRUFBTTBCLE9BQU9GLElBQUksU0FBVTNELE9BQU80RCxpQkFLOUN4RCxFQUFHa0UsV0FBV3pDLEtBQUtRLFFBQVMsU0FBU2EsR0FDN0JmLEVBQU1DLFVBQVVtQyxTQUFTLGdDQUFnQ0MsSUFBSSx1QkFBdUJDLFFBQ3BGdEMsRUFBTWEsUUFBTyxNQUt6QkEsT0FBUSxTQUFTVSxHQUViLElBQWtCZ0IsRUFBZHZDLEVBQVFOLEtBQWM4QyxFQUFZLEVBRXRDOUMsS0FBS2dDLE9BQWdCaEMsS0FBS08sVUFBVW1DLFdBQ3BDMUMsS0FBSytDLFlBQWdCL0MsS0FBS2dDLE9BQU9ZLE9BRTVCNUMsS0FBS2dDLE9BQU9FLEdBQUdsQyxLQUFLVCxTQUFTcUQsU0FDOUI1QyxLQUFLVCxRQUFVLEdBR25CUyxLQUFLZ0MsT0FBT2xDLEtBQUssU0FBU2tELEdBRXRCLElBQUl6QixFQUFRaEQsRUFBR3NCLEVBQUVHLE1BRWpCLElBQUl1QixFQUFNdEIsS0FBSyxhQUFmLENBSUEsSUFBSWdELEVBQVExQixFQUFNbUIsU0FBUyxvQkFBb0JSLEdBQUcsR0FBSUssRUFBTyxPQUs3RCxHQUhBaEIsRUFBTXRCLEtBQUssUUFBU2dELEdBQ3BCMUIsRUFBTXRCLEtBQUssUUFBU2dELEdBRWhCQSxFQUFNTCxPQUFRLENBRWQsSUFBSU0sRUFJSixPQUZBWCxFQUFPVSxFQUFNLEdBQUdFLFNBQVNDLGNBRWxCSCxFQUFNLEdBQUdFLFVBQ1osSUFBSyxNQUVELElBQUlFLEVBQVE5RSxFQUFHc0IsRUFBRSw2REFBNkRpQyxJQUFJLENBQUN3QixtQkFBbUIsT0FBUUwsRUFBTTdDLEtBQUssT0FBUyxNQUU5SDZDLEVBQU03QyxLQUFLLFVBQVk2QyxFQUFNN0MsS0FBSyxZQUNsQzhDLEVBQWMzRSxFQUFHc0IsRUFBRSxxQkFBcUJPLEtBQUssQ0FBQ21ELE1BQU1OLEVBQU03QyxLQUFLLFNBQVV2QixPQUFPb0UsRUFBTTdDLEtBQUssWUFDM0Y2QyxFQUFNTyxZQUFZTixHQUNsQkQsRUFBUUMsRUFDUkEsT0FBY08sR0FHbEJSLEVBQU1uQixJQUFJLENBQUN5QixNQUFPLE9BQU8xRSxPQUFRLE9BQVE2RSxRQUFRLElBQ2pEbkMsRUFBTW9DLFFBQVFOLEdBQU9wRCxLQUFLLFFBQVNvRCxHQUNuQyxNQUVKLElBQUssU0FFRCxJQUFJTyxFQUFNWCxFQUFNLEdBQUdXLElBQUtDLEVBQVcsU0FBU3BGLEVBRTVDd0UsRUFDSzdDLEtBQUssTUFBTyxJQUFJZ0IsR0FBRyxPQUFRLFdBTXhCLElBSkk0QixJQUFVMUMsRUFBTWYsU0FBWXlELEdBQVMxQyxFQUFNZixVQUFZZSxFQUFNSCxRQUFRbEIsZ0JBQ3JFcUIsRUFBTXdELFdBQVdiLEdBR2pCM0MsRUFBTUgsUUFBUWpCLFVBQVcsQ0FFekJvQixFQUFNeUQsVUFBVWQsR0FFaEIsSUFBSWUsRUFBTUMsYUFBc0JDLEVBSzdCLEVBSlEsV0FDSDVELEVBQU15RCxVQUFVZCxHQUNKLEtBQU5pQixHQUFTQyxjQUFjSCxLQUU5QixLQUxlLElBQVVFLElBU3ZDakUsS0FBSyxZQUFhSyxHQUNsQkYsS0FBSyxpQkFBa0J5RCxHQUN2QnpELEtBQUssTUFBTyxDQUFDd0QsR0FBMEIsRUFBcEJBLEVBQUlRLFFBQVEsS0FBWSxJQUFJLElBQU0saUNBQWlDUCxHQUFVUSxLQUFLLEtBQ3JHQyxTQUFTLHdCQUdWL0YsRUFBR2dHLFFBQVFDLE9BQU92QixFQUFNbkIsSUFBSSxpQkFBa0IsUUFFbERvQixHQUFjLEVBRVYzRSxFQUFHOEUsUUFDSDlFLEVBQUc4RSxNQUFNSixHQUNUQSxFQUFNN0MsS0FBSyxnQkFBaUIsT0FHaEMsTUFFSixJQUFLLFFBQ0Q2QyxFQUFNcUIsU0FBUyx3Q0FDZnBCLEdBQWMsRUFFVjVDLEVBQU1ILFFBQVFqQixXQUFXb0IsRUFBTXlELFVBQVVkLEdBR3JELEdBQUlDLEVBQWEsQ0FFYkwsRUFBVXRFLEVBQUdzQixFQUFFLHFCQUFxQk8sS0FBSyxDQUFDbUQsTUFBU04sRUFBTSxHQUFHTSxNQUFPMUUsT0FBVW9FLEVBQU0sR0FBR3BFLFNBQ3RGLElBQUk0RixFQUFNbEcsRUFBR3NCLEVBQUUseUNBQXlDTyxLQUFLLE1BQU95QyxFQUFPLEdBQUc2QixhQUU5RW5ELEVBQU1vQyxRQUFRYyxHQUNkbEQsRUFBTXRCLEtBQUssUUFBU3dFLFNBSXhCbEQsRUFBTXRCLEtBQUssUUFBU3NCLEdBR3BCakIsRUFBTXFFLFlBQVlwRCxJQUVsQkEsRUFBTXRCLEtBQUssU0FBUzZCLElBQUksQ0FDcEI4Qyw2QkFBOEJ0RSxFQUFNVSxlQUNwQzZELHFCQUFzQnZFLEVBQU1VLGlCQUlwQ08sRUFBTXRCLEtBQUssY0FBZTZDLEdBQzFCdkIsRUFBTW5CLEtBQUssdUJBQXdCbUMsTUFHbkNPLElBRUE5QyxLQUFLOEUsU0FBVzlFLEtBQUtVLEtBQUssNEJBRzFCVixLQUFLZ0MsT0FBTzVCLEtBQUssY0FBZSxRQUFRMkUsWUFBWSxhQUFhN0MsR0FBR2xDLEtBQUtULFNBQVMrRSxTQUFTLGFBQWFsRSxLQUFLLGNBQWUsU0FDNUhKLEtBQUs4RSxTQUFTRSxPQUFPLDRCQUE0QmhGLEtBQUtULFFBQVEsTUFBTStFLFNBQVMsY0FHN0V6QyxHQUFVaUIsR0FDVjlDLEtBQUs2QixVQUliQSxPQUFRLFdBRUosSUFBSTdCLEtBQUtPLFVBQVVFLFNBQVMsMkJBQTVCLENBRUEsSUFBSTVCLEVBQVNtQixLQUFLRyxRQUFRdEIsT0FFRSxTQUF4Qm1CLEtBQUtHLFFBQVF0QixTQUViQSxFQUFTLEVBRVRtQixLQUFLZ0MsT0FBT0YsSUFBSSxTQUFVLElBQUloQyxLQUFLLFdBQy9CakIsRUFBU29HLEtBQUtDLElBQUlyRyxFQUFRTixFQUFHc0IsRUFBRUcsTUFBTW5CLGFBSTdDbUIsS0FBS08sVUFBVXVCLElBQUksU0FBVWpELEdBQzdCbUIsS0FBS2dDLE9BQU9GLElBQUksU0FBVWpELEtBRzlCMkMsS0FBTSxTQUFTd0IsRUFBT21DLEdBRWxCLElBQUluRixLQUFLVyxXQUFhWCxLQUFLVCxTQUFXeUQsRUFBdEMsQ0FFQWhELEtBQUtXLFdBQVksRUFFakIsSUFBSUwsRUFBZU4sS0FDZlQsRUFBZVMsS0FBS2dDLE9BQU9FLEdBQUdsQyxLQUFLVCxTQUNuQzZGLEVBQWVwRixLQUFLZ0MsT0FBT0UsR0FBR2MsR0FDOUJxQyxFQUFlRixJQUF3Qm5GLEtBQUtULFFBQVV5RCxFQUFRLEdBQUssR0FDbkVzQyxFQUFlL0YsRUFBUVUsS0FBSyxTQUM1QnRCLEVBQWVILEVBQVd3QixLQUFLRyxRQUFReEIsV0FBYXFCLEtBQUtHLFFBQVF4QixVQUFZLE9BQzdFNEcsRUFBZUgsRUFBS25GLEtBQUssU0F3QjdCSyxFQUFNOEIsY0FBY2dELEdBR2Y3RyxFQUFHZ0csUUFBUTVGLFlBQ1pBLEVBQVksUUFHaEJZLEVBQVVoQixFQUFHc0IsRUFBRU4sR0FDZjZGLEVBQVU3RyxFQUFHc0IsRUFBRXVGLEdBRWY5RSxFQUFNa0YsUUFBUSwwQkFBMkIsQ0FBQ0osRUFBTTdGLEVBQVNlLElBRXpEOUIsRUFBV0csR0FBVzhHLE1BQU16RixLQUFNLENBQUNULEVBQVM2RixFQUFNQyxJQUFNSyxLQW5DckMsV0FFTnBGLEVBQU1LLFlBRVAyRSxHQUFnQkEsRUFBYTlDLEdBQUcsaUJBQ2hDbEMsRUFBTXdELFdBQVd3QixHQUdqQkMsR0FBYUEsRUFBVS9DLEdBQUcsaUJBQzFCbEMsRUFBTTZCLFVBQVVvRCxHQUdwQkgsRUFBS2QsU0FBUyxhQUFhbEUsS0FBSyxjQUFlLFNBQy9DYixFQUFRd0YsWUFBWSxhQUFhM0UsS0FBSyxjQUFlLFFBRXJERSxFQUFNSyxXQUFZLEVBQ2xCTCxFQUFNZixRQUFZeUQsRUFFbEJ6RSxFQUFHMkIsTUFBTXlGLGFBQWFQLEVBQU0sd0VBRTVCOUUsRUFBTWtGLFFBQVEsb0JBQXFCLENBQUNKLEVBQU03RixFQUFTZSxPQWlCM0RBLEVBQU13RSxTQUFTQyxZQUFZLGFBQzNCekUsRUFBTXdFLFNBQVNFLE9BQU8sNEJBQTRCaEMsRUFBTSxNQUFNc0IsU0FBUyxlQUczRWxDLGNBQWUsU0FBU2IsR0FFcEIsR0FBS3ZCLEtBQUsyRSxZQUFZcEQsR0FBdEIsQ0FJQSxJQUFJcUUsRUFBYTVGLEtBQUtHLFFBQVFiLG1CQUMxQjBELEVBQWFoRCxLQUFLNkYsU0FBVyxFQUdqQ3RFLEVBQU10QixLQUFLLFNBQVNHLEtBQUssUUFBUyx5Q0FBeUNtRCxRQUMzRWhDLEVBQU10QixLQUFLLFNBQVNxRSxTQUFTLENBQUMscUJBQXNCLHVCQUF3QnNCLEVBQVc1QyxHQUFPOEMsUUFBUXpCLEtBQUssTUFFM0dyRSxLQUFLNkYsUUFBVUQsRUFBVzVDLEVBQVEsR0FBTUEsRUFBTSxFQUFHLElBR3JEMkIsWUFBYSxTQUFTcEQsR0FDbEIsT0FBUXZCLEtBQUtHLFFBQVFkLFVBQVlrQyxFQUFNdEIsS0FBSyxVQUdoRG1GLEtBQU0sV0FDRnBGLEtBQUt3QixLQUFLeEIsS0FBS2dDLE9BQU9oQyxLQUFLVCxRQUFVLEdBQU1TLEtBQUtULFFBQVUsRUFBSyxFQUFHLElBR3RFd0csU0FBVSxXQUNOL0YsS0FBS3dCLEtBQUt4QixLQUFLZ0MsT0FBT2hDLEtBQUtULFFBQVUsR0FBTVMsS0FBS1QsUUFBVSxFQUFNUyxLQUFLZ0MsT0FBT1ksT0FBUyxHQUFLLElBRzlGOUQsTUFBTyxXQUVIa0IsS0FBSzBCLE9BRUwsSUFBSXBCLEVBQVFOLEtBRVpBLEtBQUtSLFNBQVd5RSxZQUFZLFdBQ25CM0QsRUFBTWIsVUFBVWEsRUFBTThFLFFBQzVCcEYsS0FBS0csUUFBUW5CLG1CQUlwQjBDLEtBQU0sV0FDRTFCLEtBQUtSLFVBQVUyRSxjQUFjbkUsS0FBS1IsV0FHMUMyQyxVQUFXLFNBQVNjLEdBRWhCLEdBQU1BLEdBQVNBLEVBQU0sR0FFckIsT0FBT0EsRUFBTSxHQUFHRSxVQUNaLElBQUssUUFFSW5ELEtBQUtHLFFBQVFqQixZQUNkK0QsRUFBTSxHQUFHK0MsT0FBUSxHQUdyQi9DLEVBQU0sR0FBR2dELE9BQ1QsTUFDSixJQUFLLFNBRUlqRyxLQUFLRyxRQUFRakIsV0FDZCtELEVBQU0sR0FBR2lELGNBQWNDLFlBQVksMkVBQTRFLEtBR25IbEQsRUFBTSxHQUFHaUQsY0FBY0MsWUFBWSw4REFBK0QsT0FLOUdyQyxXQUFZLFNBQVNiLEdBRWpCLE9BQU9BLEVBQU0sR0FBR0UsVUFDWixJQUFLLFFBQ0RGLEVBQU0sR0FBR21ELFFBQ1QsTUFDSixJQUFLLFNBQ0RuRCxFQUFNLEdBQUdpRCxjQUFjQyxZQUFZLGdFQUFpRSxPQUtoSHBDLFVBQVcsU0FBU2QsR0FFaEIsT0FBT0EsRUFBTSxHQUFHRSxVQUNaLElBQUssUUFDREYsRUFBTSxHQUFHK0MsT0FBUSxFQUNqQixNQUNKLElBQUssU0FDRC9DLEVBQU0sR0FBR2lELGNBQWNDLFlBQVkseUVBQTBFLFNBTTdIM0gsRUFBYSxDQUVUNkgsS0FBUSxXQUVKLElBQUlDLEVBQUkvSCxFQUFHc0IsRUFBRTBHLFdBRWIsT0FEQUQsRUFBRUUsVUFDS0YsRUFBRUcsV0FHYkMsT0FBVSxTQUFTbkgsRUFBUzZGLEVBQU1DLEdBRTlCLElBQUlpQixFQUFJL0gsRUFBR3NCLEVBQUUwRyxXQWlCYixPQWZBaEgsRUFBUXVDLElBQUkscUJBQXNCOUIsS0FBS0csUUFBUXZCLFNBQVMsTUFDeER3RyxFQUFLdEQsSUFBSSxxQkFBc0I5QixLQUFLRyxRQUFRdkIsU0FBUyxNQUVyRHdHLEVBQUt0RCxJQUFJLFVBQVcsR0FBRzZFLElBQUlwSSxFQUFHZ0csUUFBUTVGLFVBQVVpSSxJQUFLLFdBRWpEckgsRUFBUXVDLElBQUksVUFBVyxHQUFHaUQsYUFBb0IsR0FBUk0sRUFBWSxtQ0FBcUMsbUNBQ3ZGRCxFQUFLTCxhQUFvQixHQUFSTSxFQUFZLGtDQUFvQyxrQ0FDakVpQixFQUFFRSxXQUVKSyxLQUFLN0csT0FFUFQsRUFBUStFLFVBQWlCLEdBQVJlLEVBQVksbUNBQXFDLG1DQUNsRUQsRUFBS2QsVUFBaUIsR0FBUmUsRUFBWSxrQ0FBb0Msa0NBQzlERCxFQUFLN0IsUUFFRStDLEVBQUVHLFdBR2JLLE1BQVMsU0FBU3ZILEVBQVM2RixFQUFNQyxHQUU3QixJQUFJaUIsRUFBSS9ILEVBQUdzQixFQUFFMEcsV0FpQmIsT0FmQWhILEVBQVF1QyxJQUFJLHFCQUFzQjlCLEtBQUtHLFFBQVF2QixTQUFTLE1BQ3hEd0csRUFBS3RELElBQUkscUJBQXNCOUIsS0FBS0csUUFBUXZCLFNBQVMsTUFFckR3RyxFQUFLdEQsSUFBSSxVQUFXLEdBQUc2RSxJQUFJcEksRUFBR2dHLFFBQVE1RixVQUFVaUksSUFBSyxXQUVqRHJILEVBQVF1QyxJQUFJLFVBQVcsR0FBR2lELGFBQXFCLElBQVRNLEVBQWEsa0NBQW9DLGtDQUN2RkQsRUFBS0wsYUFBcUIsSUFBVE0sRUFBYSxpQ0FBbUMsaUNBQ2pFaUIsRUFBRUUsV0FFSkssS0FBSzdHLE9BRVBULEVBQVErRSxVQUFpQixHQUFSZSxFQUFZLGtDQUFvQyxrQ0FDakVELEVBQUtkLFVBQWlCLEdBQVJlLEVBQVksaUNBQW1DLGlDQUM3REQsRUFBSzdCLFFBRUUrQyxFQUFFRyxXQUdiTSxNQUFTLFNBQVN4SCxFQUFTNkYsRUFBTUMsR0FFN0IsSUFBSWlCLEVBQUkvSCxFQUFHc0IsRUFBRTBHLFdBaUJiLE9BZkFoSCxFQUFRdUMsSUFBSSxxQkFBc0I5QixLQUFLRyxRQUFRdkIsU0FBUyxNQUN4RHdHLEVBQUt0RCxJQUFJLHFCQUFzQjlCLEtBQUtHLFFBQVF2QixTQUFTLE1BRXJEd0csRUFBS3RELElBQUksVUFBVyxHQUVwQnZDLEVBQVFvSCxJQUFJcEksRUFBR2dHLFFBQVE1RixVQUFVaUksSUFBSyxXQUVsQ3JILEVBQVF1QyxJQUFJLFVBQVcsR0FBR2lELFlBQVksMEJBQ3RDdUIsRUFBRUUsV0FFSkssS0FBSzdHLE9BRVBULEVBQVErRSxTQUFTLDBCQUNqQi9FLEVBQVFnRSxRQUVEK0MsRUFBRUcsV0FHYk8sS0FBUSxTQUFTekgsRUFBUzZGLEVBQU1DLEdBRTVCLElBQUlpQixFQUFJL0gsRUFBR3NCLEVBQUUwRyxXQXlCYixPQXZCQWhILEVBQVF1QyxJQUFJLHFCQUFzQjlCLEtBQUtHLFFBQVF2QixTQUFTLE1BQ3hEd0csRUFBS3RELElBQUkscUJBQXNCOUIsS0FBS0csUUFBUXZCLFNBQVMsTUFFckR3RyxFQUFLdEQsSUFBSSxVQUFXLEdBR2RzRCxFQUFLbkYsS0FBSyxVQUFZbUYsRUFBS25GLEtBQUssZ0JBRWxDbUYsRUFBS3RELElBQUksVUFBVyxHQUFHNkUsSUFBSXBJLEVBQUdnRyxRQUFRNUYsVUFBVWlJLElBQUssV0FDakR4QixFQUFLTCxZQUFZLDBCQUNsQlQsU0FBUyx3QkFHaEIvRSxFQUFRb0gsSUFBSXBJLEVBQUdnRyxRQUFRNUYsVUFBVWlJLElBQUssV0FFbENySCxFQUFRdUMsSUFBSSxVQUFXLEdBQUdpRCxZQUFZLHlCQUN0Q3VCLEVBQUVFLFdBRUpLLEtBQUs3RyxPQUVQVCxFQUFRK0UsU0FBUyx5QkFDakIvRSxFQUFRZ0UsUUFFRCtDLEVBQUVHLFlBSWpCbEksRUFBR3dCLFVBQVU2RixXQUFhcEgsRUFHMUJMLE9BQU84SSxpQkFBaUIsVUFBVyxTQUEyQjVGLEdBRTFELElBQW1CNkYsRUFBZmpILEVBQU9vQixFQUFFcEIsS0FFYixHQUFvQixpQkFBVixFQUVOLElBQ0lBLEVBQU9rSCxLQUFLQyxNQUFNbkgsR0FDcEIsTUFBTW9ILEdBQ0pwSCxFQUFPLEdBSVhvQixFQUFFaUcsU0FBdUMsRUFBN0JqRyxFQUFFaUcsT0FBT2xELFFBQVEsVUFBK0IsU0FBZG5FLEVBQUtzSCxPQUFvQnRILEVBQUt1SCxZQUM1RU4sRUFBUzNJLEVBQUdzQixFQUFFLG9CQUFxQkksRUFBS3VILFVBQVUsT0FFdkM1RSxRQUNQc0UsRUFBT2pILEtBQUssYUFBYThELFVBQVVtRCxLQUc1QyIsImZpbGUiOiJjb21wb25lbnRzL3NsaWRlc2hvdy5jdXN0b20uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiEgVUlraXQgMi4yNy4yIHwgaHR0cDovL3d3dy5nZXR1aWtpdC5jb20gfCAoYykgMjAxNCBZT090aGVtZSB8IE1JVCBMaWNlbnNlICovXG4oZnVuY3Rpb24oYWRkb24pIHtcblxuICAgIHZhciBjb21wb25lbnQ7XG5cbiAgICBpZiAod2luZG93LlVJa2l0Mikge1xuICAgICAgICBjb21wb25lbnQgPSBhZGRvbihVSWtpdDIpO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgZGVmaW5lID09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgICAgICBkZWZpbmUoJ3Vpa2l0LXNsaWRlc2hvdycsIFsndWlraXQnXSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gY29tcG9uZW50IHx8IGFkZG9uKFVJa2l0Mik7XG4gICAgICAgIH0pO1xuICAgIH1cblxufSkoZnVuY3Rpb24oVUkpIHtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgdmFyIEFuaW1hdGlvbnMsIHBsYXllcklkID0gMDtcblxuICAgIFVJLmNvbXBvbmVudCgnc2xpZGVzaG93Jywge1xuXG4gICAgICAgIGRlZmF1bHRzOiB7XG4gICAgICAgICAgICBhbmltYXRpb24gICAgICAgICAgOiAnZmFkZScsXG4gICAgICAgICAgICBkdXJhdGlvbiAgICAgICAgICAgOiA1MDAsXG4gICAgICAgICAgICBoZWlnaHQgICAgICAgICAgICAgOiAnYXV0bycsXG4gICAgICAgICAgICBzdGFydCAgICAgICAgICAgICAgOiAwLFxuICAgICAgICAgICAgYXV0b3BsYXkgICAgICAgICAgIDogZmFsc2UsXG4gICAgICAgICAgICBhdXRvcGxheUludGVydmFsICAgOiA3MDAwLFxuICAgICAgICAgICAgdmlkZW9hdXRvcGxheSAgICAgIDogdHJ1ZSxcbiAgICAgICAgICAgIHZpZGVvbXV0ZSAgICAgICAgICA6IHRydWUsXG4gICAgICAgICAgICBzbGljZXMgICAgICAgICAgICAgOiAxNSxcbiAgICAgICAgICAgIHBhdXNlT25Ib3ZlciAgICAgICA6IHRydWUsXG4gICAgICAgICAgICBrZW5idXJucyAgICAgICAgICAgOiBmYWxzZSxcbiAgICAgICAgICAgIGtlbmJ1cm5zYW5pbWF0aW9ucyA6IFtcbiAgICAgICAgICAgICAgICAndWstYW5pbWF0aW9uLW1pZGRsZS1sZWZ0JyxcbiAgICAgICAgICAgICAgICAndWstYW5pbWF0aW9uLXRvcC1yaWdodCcsXG4gICAgICAgICAgICAgICAgJ3VrLWFuaW1hdGlvbi1ib3R0b20tbGVmdCcsXG4gICAgICAgICAgICAgICAgJ3VrLWFuaW1hdGlvbi10b3AtY2VudGVyJyxcbiAgICAgICAgICAgICAgICAnJywgLy8gbWlkZGxlLWNlbnRlclxuICAgICAgICAgICAgICAgICd1ay1hbmltYXRpb24tYm90dG9tLXJpZ2h0J1xuICAgICAgICAgICAgXVxuICAgICAgICB9LFxuXG4gICAgICAgIGN1cnJlbnQgIDogZmFsc2UsXG4gICAgICAgIGludGVydmFsIDogbnVsbCxcbiAgICAgICAgaG92ZXJpbmcgOiBmYWxzZSxcblxuICAgICAgICBib290OiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgLy8gaW5pdCBjb2RlXG4gICAgICAgICAgICBVSS5yZWFkeShmdW5jdGlvbihjb250ZXh0KSB7XG5cbiAgICAgICAgICAgICAgICBVSS4kKCdbZGF0YS11ay1zbGlkZXNob3ddJywgY29udGV4dCkuZWFjaChmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgc2xpZGVzaG93ID0gVUkuJCh0aGlzKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIXNsaWRlc2hvdy5kYXRhKCdzbGlkZXNob3cnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgVUkuc2xpZGVzaG93KHNsaWRlc2hvdywgVUkuVXRpbHMub3B0aW9ucyhzbGlkZXNob3cuYXR0cignZGF0YS11ay1zbGlkZXNob3cnKSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpcztcblxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIgICAgID0gdGhpcy5lbGVtZW50Lmhhc0NsYXNzKCd1ay1zbGlkZXNob3cnKSA/IHRoaXMuZWxlbWVudCA6IFVJLiQodGhpcy5maW5kKCcudWstc2xpZGVzaG93OmZpcnN0JykpO1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50ICAgICAgID0gdGhpcy5vcHRpb25zLnN0YXJ0O1xuICAgICAgICAgICAgdGhpcy5hbmltYXRpbmcgICAgID0gZmFsc2U7XG5cbiAgICAgICAgICAgIHRoaXMuZml4RnVsbHNjcmVlbiA9IG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goLyhpUGFkfGlQaG9uZXxpUG9kKS9nKSAmJiB0aGlzLmNvbnRhaW5lci5oYXNDbGFzcygndWstc2xpZGVzaG93LWZ1bGxzY3JlZW4nKTsgLy8gdmlld3BvcnQgdW5pdCBmaXggZm9yIGhlaWdodDoxMDB2aCAtIHNob3VsZCBiZSBmaXhlZCBpbiBpT1MgOFxuXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmtlbmJ1cm5zKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmtiYW5pbWR1cmF0aW9uID0gdGhpcy5vcHRpb25zLmtlbmJ1cm5zID09PSB0cnVlID8gJzE1cyc6IHRoaXMub3B0aW9ucy5rZW5idXJucztcblxuICAgICAgICAgICAgICAgIGlmICghU3RyaW5nKHRoaXMua2JhbmltZHVyYXRpb24pLm1hdGNoKC8obXN8cykkLykpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5rYmFuaW1kdXJhdGlvbiArPSAnbXMnO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YodGhpcy5vcHRpb25zLmtlbmJ1cm5zYW5pbWF0aW9ucykgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmtlbmJ1cm5zYW5pbWF0aW9ucyA9IHRoaXMub3B0aW9ucy5rZW5idXJuc2FuaW1hdGlvbnMuc3BsaXQoJywnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMudXBkYXRlKCk7XG5cbiAgICAgICAgICAgIHRoaXMub24oJ2NsaWNrLnVrLnNsaWRlc2hvdycsICdbZGF0YS11ay1zbGlkZXNob3ctaXRlbV0nLCBmdW5jdGlvbihlKSB7XG5cbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgc2xpZGUgPSBVSS4kKHRoaXMpLmF0dHIoJ2RhdGEtdWstc2xpZGVzaG93LWl0ZW0nKTtcblxuICAgICAgICAgICAgICAgIGlmICgkdGhpcy5jdXJyZW50ID09IHNsaWRlKSByZXR1cm47XG5cbiAgICAgICAgICAgICAgICBzd2l0Y2goc2xpZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbmV4dCc6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3ByZXZpb3VzJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzW3NsaWRlPT0nbmV4dCcgPyAnbmV4dCc6J3ByZXZpb3VzJ10oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuc2hvdyhwYXJzZUludChzbGlkZSwgMTApKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkdGhpcy5zdG9wKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgVUkuJHdpbi5vbihcInJlc2l6ZSBsb2FkXCIsIFVJLlV0aWxzLmRlYm91bmNlKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICR0aGlzLnJlc2l6ZSgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCR0aGlzLmZpeEZ1bGxzY3JlZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuY29udGFpbmVyLmNzcygnaGVpZ2h0Jywgd2luZG93LmlubmVySGVpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuc2xpZGVzLmNzcygnaGVpZ2h0Jywgd2luZG93LmlubmVySGVpZ2h0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCAxMDApKTtcblxuICAgICAgICAgICAgLy8gY2hyb21lIGltYWdlIGxvYWQgZml4XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgJHRoaXMucmVzaXplKCk7XG4gICAgICAgICAgICB9LCA4MCk7XG5cbiAgICAgICAgICAgIC8vIFNldCBhdXRvcGxheVxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5hdXRvcGxheSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy52aWRlb2F1dG9wbGF5ICYmIHRoaXMuc2xpZGVzLmVxKHRoaXMuY3VycmVudCkuZGF0YSgnbWVkaWEnKSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGxheW1lZGlhKHRoaXMuc2xpZGVzLmVxKHRoaXMuY3VycmVudCkuZGF0YSgnbWVkaWEnKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMua2VuYnVybnMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFwcGx5S2VuQnVybnModGhpcy5zbGlkZXMuZXEodGhpcy5jdXJyZW50KSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLm9uKHtcbiAgICAgICAgICAgICAgICBtb3VzZWVudGVyOiBmdW5jdGlvbigpIHsgaWYgKCR0aGlzLm9wdGlvbnMucGF1c2VPbkhvdmVyKSAkdGhpcy5ob3ZlcmluZyA9IHRydWU7ICB9LFxuICAgICAgICAgICAgICAgIG1vdXNlbGVhdmU6IGZ1bmN0aW9uKCkgeyAkdGhpcy5ob3ZlcmluZyA9IGZhbHNlOyB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5vbignc3dpcGVSaWdodCBzd2lwZUxlZnQnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgJHRoaXNbZS50eXBlPT0nc3dpcGVMZWZ0JyA/ICduZXh0JyA6ICdwcmV2aW91cyddKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5vbignZGlzcGxheS51ay5jaGVjaycsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKCR0aGlzLmVsZW1lbnQuaXMoJzp2aXNpYmxlJykpIHtcblxuICAgICAgICAgICAgICAgICAgICAkdGhpcy5yZXNpemUoKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMuZml4RnVsbHNjcmVlbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuY29udGFpbmVyLmNzcygnaGVpZ2h0Jywgd2luZG93LmlubmVySGVpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLnNsaWRlcy5jc3MoJ2hlaWdodCcsIHdpbmRvdy5pbm5lckhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgVUkuZG9tT2JzZXJ2ZSh0aGlzLmVsZW1lbnQsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoJHRoaXMuY29udGFpbmVyLmNoaWxkcmVuKCc6bm90KFtkYXRhLXNsaWRlc2hvdy1zbGlkZV0pJykubm90KCcudWstc2xpZGVzaG93LWdob3N0JykubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICR0aGlzLnVwZGF0ZSh0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uKHJlc2l6ZSkge1xuXG4gICAgICAgICAgICB2YXIgJHRoaXMgPSB0aGlzLCBjYW52YXMsIHByb2Nlc3NlZCA9IDA7XG5cbiAgICAgICAgICAgIHRoaXMuc2xpZGVzICAgICAgICA9IHRoaXMuY29udGFpbmVyLmNoaWxkcmVuKCk7XG4gICAgICAgICAgICB0aGlzLnNsaWRlc0NvdW50ICAgPSB0aGlzLnNsaWRlcy5sZW5ndGg7XG5cbiAgICAgICAgICAgIGlmICghdGhpcy5zbGlkZXMuZXEodGhpcy5jdXJyZW50KS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnQgPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnNsaWRlcy5lYWNoKGZ1bmN0aW9uKGluZGV4KSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgc2xpZGUgPSBVSS4kKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHNsaWRlLmRhdGEoJ3Byb2Nlc3NlZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgbWVkaWEgPSBzbGlkZS5jaGlsZHJlbignaW1nLHZpZGVvLGlmcmFtZScpLmVxKDApLCB0eXBlID0gJ2h0bWwnO1xuXG4gICAgICAgICAgICAgICAgc2xpZGUuZGF0YSgnbWVkaWEnLCBtZWRpYSk7XG4gICAgICAgICAgICAgICAgc2xpZGUuZGF0YSgnc2l6ZXInLCBtZWRpYSk7XG5cbiAgICAgICAgICAgICAgICBpZiAobWVkaWEubGVuZ3RoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHBsYWNlaG9sZGVyO1xuXG4gICAgICAgICAgICAgICAgICAgIHR5cGUgPSBtZWRpYVswXS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaChtZWRpYVswXS5ub2RlTmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnSU1HJzpcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb3ZlciA9IFVJLiQoJzxkaXYgY2xhc3M9XCJ1ay1jb3Zlci1iYWNrZ3JvdW5kIHVrLXBvc2l0aW9uLWNvdmVyXCI+PC9kaXY+JykuY3NzKHsnYmFja2dyb3VuZC1pbWFnZSc6J3VybCgnKyBtZWRpYS5hdHRyKCdzcmMnKSArICcpJ30pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1lZGlhLmF0dHIoJ3dpZHRoJykgJiYgbWVkaWEuYXR0cignaGVpZ2h0JykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXIgPSBVSS4kKCc8Y2FudmFzPjwvY2FudmFzPicpLmF0dHIoe3dpZHRoOm1lZGlhLmF0dHIoJ3dpZHRoJyksIGhlaWdodDptZWRpYS5hdHRyKCdoZWlnaHQnKX0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWRpYS5yZXBsYWNlV2l0aChwbGFjZWhvbGRlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lZGlhID0gcGxhY2Vob2xkZXI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lZGlhLmNzcyh7d2lkdGg6ICcxMDAlJyxoZWlnaHQ6ICdhdXRvJywgb3BhY2l0eTowfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2xpZGUucHJlcGVuZChjb3ZlcikuZGF0YSgnY292ZXInLCBjb3Zlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ0lGUkFNRSc6XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3JjID0gbWVkaWFbMF0uc3JjLCBpZnJhbWVJZCA9ICdzdy0nKygrK3BsYXllcklkKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lZGlhXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdzcmMnLCAnJykub24oJ2xvYWQnLCBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggIT09ICR0aGlzLmN1cnJlbnQgfHwgKGluZGV4ID09ICR0aGlzLmN1cnJlbnQgJiYgISR0aGlzLm9wdGlvbnMudmlkZW9hdXRvcGxheSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5wYXVzZW1lZGlhKG1lZGlhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLm9wdGlvbnMudmlkZW9tdXRlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5tdXRlbWVkaWEobWVkaWEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGludiA9IHNldEludGVydmFsKChmdW5jdGlvbihpYykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5tdXRlbWVkaWEobWVkaWEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCsraWMgPj0gNCkgY2xlYXJJbnRlcnZhbChpbnYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkoMCksIDI1MCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoJ3NsaWRlc2hvdycsICR0aGlzKSAgLy8gYWRkIHNlbGYtcmVmZXJlbmNlIGZvciB0aGUgdmltZW8tcmVhZHkgbGlzdGVuZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2RhdGEtcGxheWVyLWlkJywgaWZyYW1lSWQpICAvLyBhZGQgZnJhbWVJZCBmb3IgdGhlIHZpbWVvLXJlYWR5IGxpc3RlbmVyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdzcmMnLCBbc3JjLCAoc3JjLmluZGV4T2YoJz8nKSA+IC0xID8gJyYnOic/JyksICdlbmFibGVqc2FwaT0xJmFwaT0xJnBsYXllcl9pZD0nK2lmcmFtZUlkXS5qb2luKCcnKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKCd1ay1wb3NpdGlvbi1hYnNvbHV0ZScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGlzYWJsZSBwb2ludGVyIGV2ZW50c1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFVSS5zdXBwb3J0LnRvdWNoKSBtZWRpYS5jc3MoJ3BvaW50ZXItZXZlbnRzJywgJ25vbmUnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChVSS5jb3Zlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVSS5jb3ZlcihtZWRpYSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lZGlhLmF0dHIoJ2RhdGEtdWstY292ZXInLCAne30nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnVklERU8nOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lZGlhLmFkZENsYXNzKCd1ay1jb3Zlci1vYmplY3QgdWstcG9zaXRpb24tYWJzb2x1dGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlciA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMub3B0aW9ucy52aWRlb211dGUpICR0aGlzLm11dGVtZWRpYShtZWRpYSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAocGxhY2Vob2xkZXIpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzICA9IFVJLiQoJzxjYW52YXM+PC9jYW52YXM+JykuYXR0cih7J3dpZHRoJzogbWVkaWFbMF0ud2lkdGgsICdoZWlnaHQnOiBtZWRpYVswXS5oZWlnaHR9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbWcgPSBVSS4kKCc8aW1nIHN0eWxlPVwid2lkdGg6MTAwJTtoZWlnaHQ6YXV0bztcIj4nKS5hdHRyKCdzcmMnLCBjYW52YXNbMF0udG9EYXRhVVJMKCkpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzbGlkZS5wcmVwZW5kKGltZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzbGlkZS5kYXRhKCdzaXplcicsIGltZyk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNsaWRlLmRhdGEoJ3NpemVyJywgc2xpZGUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICgkdGhpcy5oYXNLZW5CdXJucyhzbGlkZSkpIHtcblxuICAgICAgICAgICAgICAgICAgICBzbGlkZS5kYXRhKCdjb3ZlcicpLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAnLXdlYmtpdC1hbmltYXRpb24tZHVyYXRpb24nOiAkdGhpcy5rYmFuaW1kdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICdhbmltYXRpb24tZHVyYXRpb24nOiAkdGhpcy5rYmFuaW1kdXJhdGlvblxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzbGlkZS5kYXRhKCdwcm9jZXNzZWQnLCArK3Byb2Nlc3NlZCk7XG4gICAgICAgICAgICAgICAgc2xpZGUuYXR0cignZGF0YS1zbGlkZXNob3ctc2xpZGUnLCB0eXBlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAocHJvY2Vzc2VkKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJzID0gdGhpcy5maW5kKCdbZGF0YS11ay1zbGlkZXNob3ctaXRlbV0nKTtcblxuICAgICAgICAgICAgICAgIC8vIFNldCBzdGFydCBzbGlkZVxuICAgICAgICAgICAgICAgIHRoaXMuc2xpZGVzLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKS5yZW1vdmVDbGFzcygndWstYWN0aXZlJykuZXEodGhpcy5jdXJyZW50KS5hZGRDbGFzcygndWstYWN0aXZlJykuYXR0cignYXJpYS1oaWRkZW4nLCAnZmFsc2UnKTtcbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJzLmZpbHRlcignW2RhdGEtdWstc2xpZGVzaG93LWl0ZW09XCInK3RoaXMuY3VycmVudCsnXCJdJykuYWRkQ2xhc3MoJ3VrLWFjdGl2ZScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocmVzaXplICYmIHByb2Nlc3NlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVzaXplKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVzaXplOiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgaWYgKHRoaXMuY29udGFpbmVyLmhhc0NsYXNzKCd1ay1zbGlkZXNob3ctZnVsbHNjcmVlbicpKSByZXR1cm47XG5cbiAgICAgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLm9wdGlvbnMuaGVpZ2h0O1xuXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmhlaWdodCA9PT0gJ2F1dG8nKSB7XG5cbiAgICAgICAgICAgICAgICBoZWlnaHQgPSAwO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5zbGlkZXMuY3NzKCdoZWlnaHQnLCAnJykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ID0gTWF0aC5tYXgoaGVpZ2h0LCBVSS4kKHRoaXMpLmhlaWdodCgpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIuY3NzKCdoZWlnaHQnLCBoZWlnaHQpO1xuICAgICAgICAgICAgdGhpcy5zbGlkZXMuY3NzKCdoZWlnaHQnLCBoZWlnaHQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNob3c6IGZ1bmN0aW9uKGluZGV4LCBkaXJlY3Rpb24pIHtcblxuICAgICAgICAgICAgaWYgKHRoaXMuYW5pbWF0aW5nIHx8IHRoaXMuY3VycmVudCA9PSBpbmRleCkgcmV0dXJuO1xuXG4gICAgICAgICAgICB0aGlzLmFuaW1hdGluZyA9IHRydWU7XG5cbiAgICAgICAgICAgIHZhciAkdGhpcyAgICAgICAgPSB0aGlzLFxuICAgICAgICAgICAgICAgIGN1cnJlbnQgICAgICA9IHRoaXMuc2xpZGVzLmVxKHRoaXMuY3VycmVudCksXG4gICAgICAgICAgICAgICAgbmV4dCAgICAgICAgID0gdGhpcy5zbGlkZXMuZXEoaW5kZXgpLFxuICAgICAgICAgICAgICAgIGRpciAgICAgICAgICA9IGRpcmVjdGlvbiA/IGRpcmVjdGlvbiA6IHRoaXMuY3VycmVudCA8IGluZGV4ID8gMSA6IC0xLFxuICAgICAgICAgICAgICAgIGN1cnJlbnRtZWRpYSA9IGN1cnJlbnQuZGF0YSgnbWVkaWEnKSxcbiAgICAgICAgICAgICAgICBhbmltYXRpb24gICAgPSBBbmltYXRpb25zW3RoaXMub3B0aW9ucy5hbmltYXRpb25dID8gdGhpcy5vcHRpb25zLmFuaW1hdGlvbiA6ICdmYWRlJyxcbiAgICAgICAgICAgICAgICBuZXh0bWVkaWEgICAgPSBuZXh0LmRhdGEoJ21lZGlhJyksXG4gICAgICAgICAgICAgICAgZmluYWxpemUgICAgID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkdGhpcy5hbmltYXRpbmcpIHJldHVybjtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudG1lZGlhICYmIGN1cnJlbnRtZWRpYS5pcygndmlkZW8saWZyYW1lJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLnBhdXNlbWVkaWEoY3VycmVudG1lZGlhKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXh0bWVkaWEgJiYgbmV4dG1lZGlhLmlzKCd2aWRlbyxpZnJhbWUnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMucGxheW1lZGlhKG5leHRtZWRpYSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBuZXh0LmFkZENsYXNzKCd1ay1hY3RpdmUnKS5hdHRyKCdhcmlhLWhpZGRlbicsICdmYWxzZScpO1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50LnJlbW92ZUNsYXNzKCd1ay1hY3RpdmUnKS5hdHRyKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuYW5pbWF0aW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICR0aGlzLmN1cnJlbnQgICA9IGluZGV4O1xuXG4gICAgICAgICAgICAgICAgICAgIFVJLlV0aWxzLmNoZWNrRGlzcGxheShuZXh0LCAnW2NsYXNzKj1cInVrLWFuaW1hdGlvbi1cIl06bm90KC51ay1jb3Zlci1iYWNrZ3JvdW5kLnVrLXBvc2l0aW9uLWNvdmVyKScpO1xuXG4gICAgICAgICAgICAgICAgICAgICR0aGlzLnRyaWdnZXIoJ3Nob3cudWsuc2xpZGVzaG93JywgW25leHQsIGN1cnJlbnQsICR0aGlzXSk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgJHRoaXMuYXBwbHlLZW5CdXJucyhuZXh0KTtcblxuICAgICAgICAgICAgLy8gYW5pbWF0aW9uIGZhbGxiYWNrXG4gICAgICAgICAgICBpZiAoIVVJLnN1cHBvcnQuYW5pbWF0aW9uKSB7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uID0gJ25vbmUnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjdXJyZW50ID0gVUkuJChjdXJyZW50KTtcbiAgICAgICAgICAgIG5leHQgICAgPSBVSS4kKG5leHQpO1xuXG4gICAgICAgICAgICAkdGhpcy50cmlnZ2VyKCdiZWZvcmVzaG93LnVrLnNsaWRlc2hvdycsIFtuZXh0LCBjdXJyZW50LCAkdGhpc10pO1xuXG4gICAgICAgICAgICBBbmltYXRpb25zW2FuaW1hdGlvbl0uYXBwbHkodGhpcywgW2N1cnJlbnQsIG5leHQsIGRpcl0pLnRoZW4oZmluYWxpemUpO1xuXG4gICAgICAgICAgICAkdGhpcy50cmlnZ2Vycy5yZW1vdmVDbGFzcygndWstYWN0aXZlJyk7XG4gICAgICAgICAgICAkdGhpcy50cmlnZ2Vycy5maWx0ZXIoJ1tkYXRhLXVrLXNsaWRlc2hvdy1pdGVtPVwiJytpbmRleCsnXCJdJykuYWRkQ2xhc3MoJ3VrLWFjdGl2ZScpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGFwcGx5S2VuQnVybnM6IGZ1bmN0aW9uKHNsaWRlKSB7XG5cbiAgICAgICAgICAgIGlmICghdGhpcy5oYXNLZW5CdXJucyhzbGlkZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBhbmltYXRpb25zID0gdGhpcy5vcHRpb25zLmtlbmJ1cm5zYW5pbWF0aW9ucyxcbiAgICAgICAgICAgICAgICBpbmRleCAgICAgID0gdGhpcy5rYmluZGV4IHx8IDA7XG5cblxuICAgICAgICAgICAgc2xpZGUuZGF0YSgnY292ZXInKS5hdHRyKCdjbGFzcycsICd1ay1jb3Zlci1iYWNrZ3JvdW5kIHVrLXBvc2l0aW9uLWNvdmVyJykud2lkdGgoKTtcbiAgICAgICAgICAgIHNsaWRlLmRhdGEoJ2NvdmVyJykuYWRkQ2xhc3MoWyd1ay1hbmltYXRpb24tc2NhbGUnLCAndWstYW5pbWF0aW9uLXJldmVyc2UnLCBhbmltYXRpb25zW2luZGV4XS50cmltKCldLmpvaW4oJyAnKSk7XG5cbiAgICAgICAgICAgIHRoaXMua2JpbmRleCA9IGFuaW1hdGlvbnNbaW5kZXggKyAxXSA/IChpbmRleCsxKTowO1xuICAgICAgICB9LFxuXG4gICAgICAgIGhhc0tlbkJ1cm5zOiBmdW5jdGlvbihzbGlkZSkge1xuICAgICAgICAgICAgcmV0dXJuICh0aGlzLm9wdGlvbnMua2VuYnVybnMgJiYgc2xpZGUuZGF0YSgnY292ZXInKSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbmV4dDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnNob3codGhpcy5zbGlkZXNbdGhpcy5jdXJyZW50ICsgMV0gPyAodGhpcy5jdXJyZW50ICsgMSkgOiAwLCAxKTtcbiAgICAgICAgfSxcblxuICAgICAgICBwcmV2aW91czogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnNob3codGhpcy5zbGlkZXNbdGhpcy5jdXJyZW50IC0gMV0gPyAodGhpcy5jdXJyZW50IC0gMSkgOiAodGhpcy5zbGlkZXMubGVuZ3RoIC0gMSksIC0xKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzdGFydDogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHRoaXMuc3RvcCgpO1xuXG4gICAgICAgICAgICB2YXIgJHRoaXMgPSB0aGlzO1xuXG4gICAgICAgICAgICB0aGlzLmludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEkdGhpcy5ob3ZlcmluZykgJHRoaXMubmV4dCgpO1xuICAgICAgICAgICAgfSwgdGhpcy5vcHRpb25zLmF1dG9wbGF5SW50ZXJ2YWwpO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgc3RvcDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pbnRlcnZhbCkgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKTtcbiAgICAgICAgfSxcblxuICAgICAgICBwbGF5bWVkaWE6IGZ1bmN0aW9uKG1lZGlhKSB7XG5cbiAgICAgICAgICAgIGlmICghKG1lZGlhICYmIG1lZGlhWzBdKSkgcmV0dXJuO1xuXG4gICAgICAgICAgICBzd2l0Y2gobWVkaWFbMF0ubm9kZU5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdWSURFTyc6XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMudmlkZW9tdXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZWRpYVswXS5tdXRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgbWVkaWFbMF0ucGxheSgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdJRlJBTUUnOlxuXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5vcHRpb25zLnZpZGVvbXV0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVkaWFbMF0uY29udGVudFdpbmRvdy5wb3N0TWVzc2FnZSgneyBcImV2ZW50XCI6IFwiY29tbWFuZFwiLCBcImZ1bmNcIjogXCJ1bm11dGVcIiwgXCJtZXRob2RcIjpcInNldFZvbHVtZVwiLCBcInZhbHVlXCI6MX0nLCAnKicpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgbWVkaWFbMF0uY29udGVudFdpbmRvdy5wb3N0TWVzc2FnZSgneyBcImV2ZW50XCI6IFwiY29tbWFuZFwiLCBcImZ1bmNcIjogXCJwbGF5VmlkZW9cIiwgXCJtZXRob2RcIjpcInBsYXlcIn0nLCAnKicpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBwYXVzZW1lZGlhOiBmdW5jdGlvbihtZWRpYSkge1xuXG4gICAgICAgICAgICBzd2l0Y2gobWVkaWFbMF0ubm9kZU5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdWSURFTyc6XG4gICAgICAgICAgICAgICAgICAgIG1lZGlhWzBdLnBhdXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ0lGUkFNRSc6XG4gICAgICAgICAgICAgICAgICAgIG1lZGlhWzBdLmNvbnRlbnRXaW5kb3cucG9zdE1lc3NhZ2UoJ3sgXCJldmVudFwiOiBcImNvbW1hbmRcIiwgXCJmdW5jXCI6IFwicGF1c2VWaWRlb1wiLCBcIm1ldGhvZFwiOlwicGF1c2VcIn0nLCAnKicpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBtdXRlbWVkaWE6IGZ1bmN0aW9uKG1lZGlhKSB7XG5cbiAgICAgICAgICAgIHN3aXRjaChtZWRpYVswXS5ub2RlTmFtZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ1ZJREVPJzpcbiAgICAgICAgICAgICAgICAgICAgbWVkaWFbMF0ubXV0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdJRlJBTUUnOlxuICAgICAgICAgICAgICAgICAgICBtZWRpYVswXS5jb250ZW50V2luZG93LnBvc3RNZXNzYWdlKCd7IFwiZXZlbnRcIjogXCJjb21tYW5kXCIsIFwiZnVuY1wiOiBcIm11dGVcIiwgXCJtZXRob2RcIjpcInNldFZvbHVtZVwiLCBcInZhbHVlXCI6MH0nLCAnKicpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgQW5pbWF0aW9ucyA9IHtcblxuICAgICAgICAnbm9uZSc6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgZCA9IFVJLiQuRGVmZXJyZWQoKTtcbiAgICAgICAgICAgIGQucmVzb2x2ZSgpO1xuICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgICdzY3JvbGwnOiBmdW5jdGlvbihjdXJyZW50LCBuZXh0LCBkaXIpIHtcblxuICAgICAgICAgICAgdmFyIGQgPSBVSS4kLkRlZmVycmVkKCk7XG5cbiAgICAgICAgICAgIGN1cnJlbnQuY3NzKCdhbmltYXRpb24tZHVyYXRpb24nLCB0aGlzLm9wdGlvbnMuZHVyYXRpb24rJ21zJyk7XG4gICAgICAgICAgICBuZXh0LmNzcygnYW5pbWF0aW9uLWR1cmF0aW9uJywgdGhpcy5vcHRpb25zLmR1cmF0aW9uKydtcycpO1xuXG4gICAgICAgICAgICBuZXh0LmNzcygnb3BhY2l0eScsIDEpLm9uZShVSS5zdXBwb3J0LmFuaW1hdGlvbi5lbmQsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgY3VycmVudC5jc3MoJ29wYWNpdHknLCAwKS5yZW1vdmVDbGFzcyhkaXIgPT0gLTEgPyAndWstc2xpZGVzaG93LXNjcm9sbC1iYWNrd2FyZC1vdXQnIDogJ3VrLXNsaWRlc2hvdy1zY3JvbGwtZm9yd2FyZC1vdXQnKTtcbiAgICAgICAgICAgICAgICBuZXh0LnJlbW92ZUNsYXNzKGRpciA9PSAtMSA/ICd1ay1zbGlkZXNob3ctc2Nyb2xsLWJhY2t3YXJkLWluJyA6ICd1ay1zbGlkZXNob3ctc2Nyb2xsLWZvcndhcmQtaW4nKTtcbiAgICAgICAgICAgICAgICBkLnJlc29sdmUoKTtcblxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAgICAgY3VycmVudC5hZGRDbGFzcyhkaXIgPT0gLTEgPyAndWstc2xpZGVzaG93LXNjcm9sbC1iYWNrd2FyZC1vdXQnIDogJ3VrLXNsaWRlc2hvdy1zY3JvbGwtZm9yd2FyZC1vdXQnKTtcbiAgICAgICAgICAgIG5leHQuYWRkQ2xhc3MoZGlyID09IC0xID8gJ3VrLXNsaWRlc2hvdy1zY3JvbGwtYmFja3dhcmQtaW4nIDogJ3VrLXNsaWRlc2hvdy1zY3JvbGwtZm9yd2FyZC1pbicpO1xuICAgICAgICAgICAgbmV4dC53aWR0aCgpOyAvLyBmb3JjZSByZWRyYXdcblxuICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgICdzd2lwZSc6IGZ1bmN0aW9uKGN1cnJlbnQsIG5leHQsIGRpcikge1xuXG4gICAgICAgICAgICB2YXIgZCA9IFVJLiQuRGVmZXJyZWQoKTtcblxuICAgICAgICAgICAgY3VycmVudC5jc3MoJ2FuaW1hdGlvbi1kdXJhdGlvbicsIHRoaXMub3B0aW9ucy5kdXJhdGlvbisnbXMnKTtcbiAgICAgICAgICAgIG5leHQuY3NzKCdhbmltYXRpb24tZHVyYXRpb24nLCB0aGlzLm9wdGlvbnMuZHVyYXRpb24rJ21zJyk7XG5cbiAgICAgICAgICAgIG5leHQuY3NzKCdvcGFjaXR5JywgMSkub25lKFVJLnN1cHBvcnQuYW5pbWF0aW9uLmVuZCwgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBjdXJyZW50LmNzcygnb3BhY2l0eScsIDApLnJlbW92ZUNsYXNzKGRpciA9PT0gLTEgPyAndWstc2xpZGVzaG93LXN3aXBlLWJhY2t3YXJkLW91dCcgOiAndWstc2xpZGVzaG93LXN3aXBlLWZvcndhcmQtb3V0Jyk7XG4gICAgICAgICAgICAgICAgbmV4dC5yZW1vdmVDbGFzcyhkaXIgPT09IC0xID8gJ3VrLXNsaWRlc2hvdy1zd2lwZS1iYWNrd2FyZC1pbicgOiAndWstc2xpZGVzaG93LXN3aXBlLWZvcndhcmQtaW4nKTtcbiAgICAgICAgICAgICAgICBkLnJlc29sdmUoKTtcblxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAgICAgY3VycmVudC5hZGRDbGFzcyhkaXIgPT0gLTEgPyAndWstc2xpZGVzaG93LXN3aXBlLWJhY2t3YXJkLW91dCcgOiAndWstc2xpZGVzaG93LXN3aXBlLWZvcndhcmQtb3V0Jyk7XG4gICAgICAgICAgICBuZXh0LmFkZENsYXNzKGRpciA9PSAtMSA/ICd1ay1zbGlkZXNob3ctc3dpcGUtYmFja3dhcmQtaW4nIDogJ3VrLXNsaWRlc2hvdy1zd2lwZS1mb3J3YXJkLWluJyk7XG4gICAgICAgICAgICBuZXh0LndpZHRoKCk7IC8vIGZvcmNlIHJlZHJhd1xuXG4gICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgJ3NjYWxlJzogZnVuY3Rpb24oY3VycmVudCwgbmV4dCwgZGlyKSB7XG5cbiAgICAgICAgICAgIHZhciBkID0gVUkuJC5EZWZlcnJlZCgpO1xuXG4gICAgICAgICAgICBjdXJyZW50LmNzcygnYW5pbWF0aW9uLWR1cmF0aW9uJywgdGhpcy5vcHRpb25zLmR1cmF0aW9uKydtcycpO1xuICAgICAgICAgICAgbmV4dC5jc3MoJ2FuaW1hdGlvbi1kdXJhdGlvbicsIHRoaXMub3B0aW9ucy5kdXJhdGlvbisnbXMnKTtcblxuICAgICAgICAgICAgbmV4dC5jc3MoJ29wYWNpdHknLCAxKTtcblxuICAgICAgICAgICAgY3VycmVudC5vbmUoVUkuc3VwcG9ydC5hbmltYXRpb24uZW5kLCBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIGN1cnJlbnQuY3NzKCdvcGFjaXR5JywgMCkucmVtb3ZlQ2xhc3MoJ3VrLXNsaWRlc2hvdy1zY2FsZS1vdXQnKTtcbiAgICAgICAgICAgICAgICBkLnJlc29sdmUoKTtcblxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAgICAgY3VycmVudC5hZGRDbGFzcygndWstc2xpZGVzaG93LXNjYWxlLW91dCcpO1xuICAgICAgICAgICAgY3VycmVudC53aWR0aCgpOyAvLyBmb3JjZSByZWRyYXdcblxuICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgICdmYWRlJzogZnVuY3Rpb24oY3VycmVudCwgbmV4dCwgZGlyKSB7XG5cbiAgICAgICAgICAgIHZhciBkID0gVUkuJC5EZWZlcnJlZCgpO1xuXG4gICAgICAgICAgICBjdXJyZW50LmNzcygnYW5pbWF0aW9uLWR1cmF0aW9uJywgdGhpcy5vcHRpb25zLmR1cmF0aW9uKydtcycpO1xuICAgICAgICAgICAgbmV4dC5jc3MoJ2FuaW1hdGlvbi1kdXJhdGlvbicsIHRoaXMub3B0aW9ucy5kdXJhdGlvbisnbXMnKTtcblxuICAgICAgICAgICAgbmV4dC5jc3MoJ29wYWNpdHknLCAxKTtcblxuICAgICAgICAgICAgLy8gZm9yIHBsYWluIHRleHQgY29udGVudCBzbGlkZXMgLSBsb29rcyBzbW9vdGhlclxuICAgICAgICAgICAgaWYgKCEobmV4dC5kYXRhKCdjb3ZlcicpIHx8IG5leHQuZGF0YSgncGxhY2Vob2xkZXInKSkpIHtcblxuICAgICAgICAgICAgICAgIG5leHQuY3NzKCdvcGFjaXR5JywgMSkub25lKFVJLnN1cHBvcnQuYW5pbWF0aW9uLmVuZCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIG5leHQucmVtb3ZlQ2xhc3MoJ3VrLXNsaWRlc2hvdy1mYWRlLWluJyk7XG4gICAgICAgICAgICAgICAgfSkuYWRkQ2xhc3MoJ3VrLXNsaWRlc2hvdy1mYWRlLWluJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGN1cnJlbnQub25lKFVJLnN1cHBvcnQuYW5pbWF0aW9uLmVuZCwgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBjdXJyZW50LmNzcygnb3BhY2l0eScsIDApLnJlbW92ZUNsYXNzKCd1ay1zbGlkZXNob3ctZmFkZS1vdXQnKTtcbiAgICAgICAgICAgICAgICBkLnJlc29sdmUoKTtcblxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAgICAgY3VycmVudC5hZGRDbGFzcygndWstc2xpZGVzaG93LWZhZGUtb3V0Jyk7XG4gICAgICAgICAgICBjdXJyZW50LndpZHRoKCk7IC8vIGZvcmNlIHJlZHJhd1xuXG4gICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgVUkuc2xpZGVzaG93LmFuaW1hdGlvbnMgPSBBbmltYXRpb25zO1xuXG4gICAgLy8gTGlzdGVuIGZvciBtZXNzYWdlcyBmcm9tIHRoZSB2aW1lbyBwbGF5ZXJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIG9uTWVzc2FnZVJlY2VpdmVkKGUpIHtcblxuICAgICAgICB2YXIgZGF0YSA9IGUuZGF0YSwgaWZyYW1lO1xuXG4gICAgICAgIGlmICh0eXBlb2YoZGF0YSkgPT0gJ3N0cmluZycpIHtcblxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgICAgICAgICAgIH0gY2F0Y2goZXJyKSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9IHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGUub3JpZ2luICYmIGUub3JpZ2luLmluZGV4T2YoJ3ZpbWVvJykgPiAtMSAmJiBkYXRhLmV2ZW50ID09ICdyZWFkeScgJiYgZGF0YS5wbGF5ZXJfaWQpIHtcbiAgICAgICAgICAgIGlmcmFtZSA9IFVJLiQoJ1tkYXRhLXBsYXllci1pZD1cIicrIGRhdGEucGxheWVyX2lkKydcIl0nKTtcblxuICAgICAgICAgICAgaWYgKGlmcmFtZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBpZnJhbWUuZGF0YSgnc2xpZGVzaG93JykubXV0ZW1lZGlhKGlmcmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LCBmYWxzZSk7XG5cbn0pOyJdfQ==
