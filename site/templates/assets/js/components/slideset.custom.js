!function(t){var i;window.UIkit2&&(i=t(UIkit2)),"function"==typeof define&&define.amd&&define("uikit-slideset",["uikit"],function(){return i||t(UIkit2)})}(function(d){"use strict";var r;function n(t,i,e,s){var n,a,o,r,l=d.$.Deferred(),h=!1===this.options.delay?Math.floor(this.options.duration/2):this.options.delay,u=this;if(s=s||1,this.element.css("min-height",this.element.height()),e[0]===i[0])return l.resolve(),l.promise();if("object"==typeof t?(n=t[0],a=t[1]||t[0]):a=n=t,d.$body.css("overflow-x","hidden"),o=function(){if(i&&i.length&&i.hide().removeClass(a+" uk-animation-reverse").css({opacity:"","animation-delay":"",animation:""}),e.length){for(r=0;r<e.length;r++)e.eq(1==s?r:e.length-r-1).css("animation-delay",r*h+"ms");var t=function(){e.removeClass(""+n).css({opacity:"",display:"","animation-delay":"",animation:""}),l.resolve(),d.$body.css("overflow-x",""),u.element.css("min-height",""),t=!1};e.addClass(n)[1==s?"last":"first"]().one(d.support.animation.end,function(){t&&t()}).end().css("display",""),setTimeout(function(){t&&t()},e.length*h*2)}else l.resolve()},e.length&&e.css("animation-duration",this.options.duration+"ms"),i&&i.length)for(i.css("animation-duration",this.options.duration+"ms")[1==s?"last":"first"]().one(d.support.animation.end,function(){o()}),r=0;r<i.length;r++)!function(t,i){setTimeout(function(){i.css("display","none").css("display","").css("opacity",0).on(d.support.animation.end,function(){i.removeClass(a)}).addClass(a+" uk-animation-reverse")}.bind(this),r*h)}(0,i.eq(1==s?r:i.length-r-1));else o();return l.promise()}d.component("slideset",{defaults:{default:1,animation:"fade",duration:200,filter:"",delay:!1,controls:!1,autoplay:!1,autoplayInterval:7e3,pauseOnHover:!0},sets:[],boot:function(){d.ready(function(t){d.$("[data-uk-slideset]",t).each(function(){var t=d.$(this);t.data("slideset")||d.slideset(t,d.Utils.options(t.attr("data-uk-slideset")))})})},init:function(){var e=this;this.activeSet=!1,this.list=this.element.find(".uk-slideset"),this.nav=this.element.find(".uk-slideset-nav"),this.controls=this.options.controls?d.$(this.options.controls):this.element,d.$win.on("resize load",d.Utils.debounce(function(){e.update()},100)),e.list.addClass("uk-grid-width-1-"+e.options.default),["xlarge","large","medium","small"].forEach(function(t){e.options[t]&&e.list.addClass("uk-grid-width-"+t+"-1-"+e.options[t])}),this.on("click.uk.slideset","[data-uk-slideset-item]",function(t){if(t.preventDefault(),!e.animating){var i=d.$(this).attr("data-uk-slideset-item");if(e.activeSet!==i)switch(i){case"next":case"previous":e["next"==i?"next":"previous"]();break;default:e.show(parseInt(i,10))}}}),this.controls.on("click.uk.slideset","[data-uk-filter]",function(t){var i=d.$(this);i.parent().hasClass("uk-slideset")||(t.preventDefault(),e.animating||e.currentFilter==i.attr("data-uk-filter")||(e.updateFilter(i.attr("data-uk-filter")),e._hide().then(function(){e.update(!0,!0)})))}),this.on("swipeRight swipeLeft",function(t){e["swipeLeft"==t.type?"next":"previous"]()}),this.updateFilter(this.options.filter),this.update(),this.element.on({mouseenter:function(){e.options.pauseOnHover&&(e.hovering=!0)},mouseleave:function(){e.hovering=!1}}),this.options.autoplay&&this.start(),d.domObserve(this.list,function(t){e.list.children(":visible:not(.uk-active)").length&&e.update(!1,!0)})},update:function(t,i){var e,s=this.visible;if(this.visible=this.getVisibleOnCurrenBreakpoint(),s!=this.visible||i){for(this.children=this.list.children().hide(),this.items=this.getItems(),this.sets=function(t,i){var e,s=0,n=-1,a=t.length||0,o=[];if(i<1)return null;for(;s<a;)(e=s%i)?o[n][e]=t[s]:o[++n]=[t[s]],s++;s=0,a=o.length;for(;s<a;)o[s]=jQuery(o[s]),s++;return o}(this.items,this.visible),e=0;e<this.sets.length;e++)this.sets[e].css({display:"none"});if(this.nav.length&&this.nav.empty()){for(e=0;e<this.sets.length;e++)this.nav.append('<li data-uk-slideset-item="'+e+'"><a></a></li>');this.nav[1==this.nav.children().length?"addClass":"removeClass"]("uk-invisible")}this.activeSet=!1,this.show(0,!t)}},updateFilter:function(t){var i,e=this;this.currentFilter=t,this.controls.find("[data-uk-filter]").each(function(){(i=d.$(this)).parent().hasClass("uk-slideset")||(i.attr("data-uk-filter")==e.currentFilter?i.addClass("uk-active"):i.removeClass("uk-active"))})},getVisibleOnCurrenBreakpoint:function(){var i=null,e=d.$('<div style="position:absolute;height:1px;top:-1000px;width:100px"><div></div></div>').appendTo("body"),s=e.children().eq(0),n=this.options;return["xlarge","large","medium","small"].forEach(function(t){n[t]&&!i&&(e.attr("class","uk-grid-width-"+t+"-1-2").width(),50==s.width()&&(i=t))}),e.remove(),this.options[i]||this.options.default},getItems:function(){var n,a=[];return this.currentFilter?("string"==typeof(n=this.currentFilter||[])&&(n=n.split(/,/).map(function(t){return t.trim()})),this.children.each(function(t){var i=d.$(this),e=i.attr("data-uk-filter"),s=!n.length;e&&(e=e.split(/,/).map(function(t){return t.trim()}),n.forEach(function(t){-1<e.indexOf(t)&&(s=!0)})),s&&a.push(i[0])}),a=d.$(a)):a=this.list.children(),a},show:function(t,i,e){var s=this;if(this.activeSet!==t&&!this.animating){e=e||(t<this.activeSet?-1:1);var n=this.sets[this.activeSet]||[],a=this.sets[t],o=this._getAnimation();!i&&d.support.animation||(o=r.none),this.animating=!0,this.nav.length&&this.nav.children().removeClass("uk-active").eq(t).addClass("uk-active"),o.apply(s,[n,a,e]).then(function(){d.Utils.checkDisplay(a,!0),s.children.hide().removeClass("uk-active"),a.addClass("uk-active").css({display:"",opacity:""}),s.animating=!1,s.activeSet=t,d.Utils.checkDisplay(a,!0),s.trigger("show.uk.slideset",[a])})}},_getAnimation:function(){var t=r[this.options.animation]||r.none;return d.support.animation||(t=r.none),t},_hide:function(){var t=this,i=this.sets[this.activeSet]||[],e=this._getAnimation();return this.animating=!0,e.apply(t,[i,[],1]).then(function(){t.animating=!1})},next:function(){this.show(this.sets[this.activeSet+1]?this.activeSet+1:0,!1,1)},previous:function(){this.show(this.sets[this.activeSet-1]?this.activeSet-1:this.sets.length-1,!1,-1)},start:function(){this.stop();var t=this;this.interval=setInterval(function(){t.hovering||t.animating||t.next()},this.options.autoplayInterval)},stop:function(){this.interval&&clearInterval(this.interval)}}),r={none:function(){var t=d.$.Deferred();return t.resolve(),t.promise()},fade:function(t,i){return n.apply(this,["uk-animation-fade",t,i])},"slide-bottom":function(t,i){return n.apply(this,["uk-animation-slide-bottom",t,i])},"slide-top":function(t,i){return n.apply(this,["uk-animation-slide-top",t,i])},"slide-vertical":function(t,i,e){var s=["uk-animation-slide-top","uk-animation-slide-bottom"];return-1==e&&s.reverse(),n.apply(this,[s,t,i])},"slide-horizontal":function(t,i,e){var s=["uk-animation-slide-right","uk-animation-slide-left"];return-1==e&&s.reverse(),n.apply(this,[s,t,i,e])},scale:function(t,i){return n.apply(this,["uk-animation-scale-up",t,i])}},d.slideset.animations=r});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvc2xpZGVzZXQuY3VzdG9tLmpzIl0sIm5hbWVzIjpbImFkZG9uIiwiY29tcG9uZW50Iiwid2luZG93IiwiVUlraXQyIiwiZGVmaW5lIiwiYW1kIiwiVUkiLCJBbmltYXRpb25zIiwiY29yZUFuaW1hdGlvbiIsImNscyIsImN1cnJlbnQiLCJuZXh0IiwiZGlyIiwiY2xzSW4iLCJjbHNPdXQiLCJyZWxlYXNlIiwiaSIsImQiLCIkIiwiRGVmZXJyZWQiLCJkZWxheSIsInRoaXMiLCJvcHRpb25zIiwiTWF0aCIsImZsb29yIiwiZHVyYXRpb24iLCIkdGhpcyIsImVsZW1lbnQiLCJjc3MiLCJoZWlnaHQiLCJyZXNvbHZlIiwicHJvbWlzZSIsIiRib2R5IiwibGVuZ3RoIiwiaGlkZSIsInJlbW92ZUNsYXNzIiwib3BhY2l0eSIsImFuaW1hdGlvbi1kZWxheSIsImFuaW1hdGlvbiIsImVxIiwiZmluaXNoIiwiZGlzcGxheSIsImFkZENsYXNzIiwib25lIiwic3VwcG9ydCIsImVuZCIsInNldFRpbWVvdXQiLCJpbmRleCIsImVsZSIsIm9uIiwiYmluZCIsImRlZmF1bHRzIiwiZGVmYXVsdCIsImZpbHRlciIsImNvbnRyb2xzIiwiYXV0b3BsYXkiLCJhdXRvcGxheUludGVydmFsIiwicGF1c2VPbkhvdmVyIiwic2V0cyIsImJvb3QiLCJyZWFkeSIsImNvbnRleHQiLCJlYWNoIiwiZGF0YSIsInNsaWRlc2V0IiwiVXRpbHMiLCJhdHRyIiwiaW5pdCIsImFjdGl2ZVNldCIsImxpc3QiLCJmaW5kIiwibmF2IiwiJHdpbiIsImRlYm91bmNlIiwidXBkYXRlIiwiZm9yRWFjaCIsImJwIiwiZSIsInByZXZlbnREZWZhdWx0IiwiYW5pbWF0aW5nIiwic2V0Iiwic2hvdyIsInBhcnNlSW50IiwicGFyZW50IiwiaGFzQ2xhc3MiLCJjdXJyZW50RmlsdGVyIiwidXBkYXRlRmlsdGVyIiwiX2hpZGUiLCJ0aGVuIiwidHlwZSIsIm1vdXNlZW50ZXIiLCJob3ZlcmluZyIsIm1vdXNlbGVhdmUiLCJzdGFydCIsImRvbU9ic2VydmUiLCJjaGlsZHJlbiIsImFuaW1hdGUiLCJmb3JjZSIsInZpc2libGUiLCJnZXRWaXNpYmxlT25DdXJyZW5CcmVha3BvaW50IiwiaXRlbXMiLCJnZXRJdGVtcyIsImlucHV0Iiwic2l6ZSIsIngiLCJjIiwibCIsIm4iLCJqUXVlcnkiLCJhcnJheV9jaHVuayIsImVtcHR5IiwiYXBwZW5kIiwiY3VycmVudGZpbHRlciIsImJyZWFrcG9pbnQiLCJ0bXAiLCJhcHBlbmRUbyIsInRlc3RkaXYiLCJicmVha3BvaW50cyIsIndpZHRoIiwicmVtb3ZlIiwic3BsaXQiLCJtYXAiLCJpdGVtIiwidHJpbSIsImYiLCJpbmZpbHRlciIsImluZGV4T2YiLCJwdXNoIiwic2V0SW5kZXgiLCJub2FuaW1hdGUiLCJfZ2V0QW5pbWF0aW9uIiwibm9uZSIsImFwcGx5IiwiY2hlY2tEaXNwbGF5IiwidHJpZ2dlciIsInByZXZpb3VzIiwic3RvcCIsImludGVydmFsIiwic2V0SW50ZXJ2YWwiLCJjbGVhckludGVydmFsIiwiZmFkZSIsInNsaWRlLWJvdHRvbSIsInNsaWRlLXRvcCIsInNsaWRlLXZlcnRpY2FsIiwiYW5pbSIsInJldmVyc2UiLCJzbGlkZS1ob3Jpem9udGFsIiwic2NhbGUiLCJhbmltYXRpb25zIl0sIm1hcHBpbmdzIjoiQ0FDQSxTQUFVQSxHQUVOLElBQUlDLEVBRUFDLE9BQU9DLFNBQ1BGLEVBQVlELEVBQU1HLFNBR0QsbUJBQVZDLFFBQXdCQSxPQUFPQyxLQUN0Q0QsT0FBTyxpQkFBa0IsQ0FBQyxTQUFVLFdBQ2hDLE9BQU9ILEdBQWFELEVBQU1HLFVBVnRDLENBY0csU0FBU0csR0FFUixhQUVBLElBQUlDLEVBK1hKLFNBQVNDLEVBQWNDLEVBQUtDLEVBQVNDLEVBQU1DLEdBRXZDLElBRWtCQyxFQUFPQyxFQUFRQyxFQUFTQyxFQUZ0Q0MsRUFBUVgsRUFBR1ksRUFBRUMsV0FDYkMsR0FBZ0MsSUFBdkJDLEtBQUtDLFFBQVFGLE1BQW1CRyxLQUFL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bnQiOlsiLyohIFVJa2l0IDIuMjcuMiB8IGh0dHA6Ly93d3cuZ2V0dWlraXQuY29tIHwgKGMpIDIwMTQgWU9PdGhlbWUgfCBNSVQgTGljZW5zZSAqL1xyXG4oZnVuY3Rpb24oYWRkb24pIHtcclxuXHJcbiAgICB2YXIgY29tcG9uZW50O1xyXG5cclxuICAgIGlmICh3aW5kb3cuVUlraXQyKSB7XHJcbiAgICAgICAgY29tcG9uZW50ID0gYWRkb24oVUlraXQyKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodHlwZW9mIGRlZmluZSA9PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcclxuICAgICAgICBkZWZpbmUoJ3Vpa2l0LXNsaWRlc2V0JywgWyd1aWtpdCddLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICByZXR1cm4gY29tcG9uZW50IHx8IGFkZG9uKFVJa2l0Mik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG59KShmdW5jdGlvbihVSSl7XHJcblxyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgdmFyIEFuaW1hdGlvbnM7XHJcblxyXG4gICAgVUkuY29tcG9uZW50KCdzbGlkZXNldCcsIHtcclxuXHJcbiAgICAgICAgZGVmYXVsdHM6IHtcclxuICAgICAgICAgICAgZGVmYXVsdCAgICAgICAgICA6IDEsXHJcbiAgICAgICAgICAgIGFuaW1hdGlvbiAgICAgICAgOiAnZmFkZScsXHJcbiAgICAgICAgICAgIGR1cmF0aW9uICAgICAgICAgOiAyMDAsXHJcbiAgICAgICAgICAgIGZpbHRlciAgICAgICAgICAgOiAnJyxcclxuICAgICAgICAgICAgZGVsYXkgICAgICAgICAgICA6IGZhbHNlLFxyXG4gICAgICAgICAgICBjb250cm9scyAgICAgICAgIDogZmFsc2UsXHJcbiAgICAgICAgICAgIGF1dG9wbGF5ICAgICAgICAgOiBmYWxzZSxcclxuICAgICAgICAgICAgYXV0b3BsYXlJbnRlcnZhbCA6IDcwMDAsXHJcbiAgICAgICAgICAgIHBhdXNlT25Ib3ZlciAgICAgOiB0cnVlXHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgc2V0czogW10sXHJcblxyXG4gICAgICAgIGJvb3Q6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgLy8gYXV0byBpbml0XHJcbiAgICAgICAgICAgIFVJLnJlYWR5KGZ1bmN0aW9uKGNvbnRleHQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBVSS4kKCdbZGF0YS11ay1zbGlkZXNldF0nLCBjb250ZXh0KS5lYWNoKGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlbGUgPSBVSS4kKHRoaXMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZighZWxlLmRhdGEoJ3NsaWRlc2V0JykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVUkuc2xpZGVzZXQoZWxlLCBVSS5VdGlscy5vcHRpb25zKGVsZS5hdHRyKCdkYXRhLXVrLXNsaWRlc2V0JykpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgJHRoaXMgPSB0aGlzO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5hY3RpdmVTZXQgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5saXN0ICAgICAgPSB0aGlzLmVsZW1lbnQuZmluZCgnLnVrLXNsaWRlc2V0Jyk7XHJcbiAgICAgICAgICAgIHRoaXMubmF2ICAgICAgID0gdGhpcy5lbGVtZW50LmZpbmQoJy51ay1zbGlkZXNldC1uYXYnKTtcclxuICAgICAgICAgICAgdGhpcy5jb250cm9scyAgPSB0aGlzLm9wdGlvbnMuY29udHJvbHMgPyBVSS4kKHRoaXMub3B0aW9ucy5jb250cm9scykgOiB0aGlzLmVsZW1lbnQ7XHJcblxyXG4gICAgICAgICAgICBVSS4kd2luLm9uKCdyZXNpemUgbG9hZCcsIFVJLlV0aWxzLmRlYm91bmNlKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgJHRoaXMudXBkYXRlKCk7XHJcbiAgICAgICAgICAgIH0sIDEwMCkpO1xyXG5cclxuICAgICAgICAgICAgJHRoaXMubGlzdC5hZGRDbGFzcygndWstZ3JpZC13aWR0aC0xLScrJHRoaXMub3B0aW9ucy5kZWZhdWx0KTtcclxuXHJcbiAgICAgICAgICAgIFsneGxhcmdlJywgJ2xhcmdlJywgJ21lZGl1bScsICdzbWFsbCddLmZvckVhY2goZnVuY3Rpb24oYnApIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLm9wdGlvbnNbYnBdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICR0aGlzLmxpc3QuYWRkQ2xhc3MoJ3VrLWdyaWQtd2lkdGgtJyticCsnLTEtJyskdGhpcy5vcHRpb25zW2JwXSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5vbignY2xpY2sudWsuc2xpZGVzZXQnLCAnW2RhdGEtdWstc2xpZGVzZXQtaXRlbV0nLCBmdW5jdGlvbihlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICgkdGhpcy5hbmltYXRpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHNldCA9IFVJLiQodGhpcykuYXR0cignZGF0YS11ay1zbGlkZXNldC1pdGVtJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCR0aGlzLmFjdGl2ZVNldCA9PT0gc2V0KSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICAgICAgc3dpdGNoKHNldCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ25leHQnOlxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3ByZXZpb3VzJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXNbc2V0PT0nbmV4dCcgPyAnbmV4dCc6J3ByZXZpb3VzJ10oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuc2hvdyhwYXJzZUludChzZXQsIDEwKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuY29udHJvbHMub24oJ2NsaWNrLnVrLnNsaWRlc2V0JywgJ1tkYXRhLXVrLWZpbHRlcl0nLCBmdW5jdGlvbihlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGVsZSA9IFVJLiQodGhpcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGVsZS5wYXJlbnQoKS5oYXNDbGFzcygndWstc2xpZGVzZXQnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCR0aGlzLmFuaW1hdGluZyB8fCAkdGhpcy5jdXJyZW50RmlsdGVyID09IGVsZS5hdHRyKCdkYXRhLXVrLWZpbHRlcicpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICR0aGlzLnVwZGF0ZUZpbHRlcihlbGUuYXR0cignZGF0YS11ay1maWx0ZXInKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgJHRoaXMuX2hpZGUoKS50aGVuKGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICR0aGlzLnVwZGF0ZSh0cnVlLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMub24oJ3N3aXBlUmlnaHQgc3dpcGVMZWZ0JywgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgJHRoaXNbZS50eXBlPT0nc3dpcGVMZWZ0JyA/ICduZXh0JyA6ICdwcmV2aW91cyddKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy51cGRhdGVGaWx0ZXIodGhpcy5vcHRpb25zLmZpbHRlcik7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlKCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQub24oe1xyXG4gICAgICAgICAgICAgICAgbW91c2VlbnRlcjogZnVuY3Rpb24oKSB7IGlmICgkdGhpcy5vcHRpb25zLnBhdXNlT25Ib3ZlcikgJHRoaXMuaG92ZXJpbmcgPSB0cnVlOyAgfSxcclxuICAgICAgICAgICAgICAgIG1vdXNlbGVhdmU6IGZ1bmN0aW9uKCkgeyAkdGhpcy5ob3ZlcmluZyA9IGZhbHNlOyB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gU2V0IGF1dG9wbGF5XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXV0b3BsYXkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnQoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgVUkuZG9tT2JzZXJ2ZSh0aGlzLmxpc3QsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgIGlmICgkdGhpcy5saXN0LmNoaWxkcmVuKCc6dmlzaWJsZTpub3QoLnVrLWFjdGl2ZSknKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkdGhpcy51cGRhdGUoZmFsc2UsdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHVwZGF0ZTogZnVuY3Rpb24oYW5pbWF0ZSwgZm9yY2UpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciB2aXNpYmxlID0gdGhpcy52aXNpYmxlLCBpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy52aXNpYmxlICA9IHRoaXMuZ2V0VmlzaWJsZU9uQ3VycmVuQnJlYWtwb2ludCgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHZpc2libGUgPT0gdGhpcy52aXNpYmxlICYmICFmb3JjZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNoaWxkcmVuID0gdGhpcy5saXN0LmNoaWxkcmVuKCkuaGlkZSgpO1xyXG4gICAgICAgICAgICB0aGlzLml0ZW1zICAgID0gdGhpcy5nZXRJdGVtcygpO1xyXG4gICAgICAgICAgICB0aGlzLnNldHMgICAgID0gYXJyYXlfY2h1bmsodGhpcy5pdGVtcywgdGhpcy52aXNpYmxlKTtcclxuXHJcbiAgICAgICAgICAgIGZvciAoaT0wO2k8dGhpcy5zZXRzLmxlbmd0aDtpKyspIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0c1tpXS5jc3MoeydkaXNwbGF5JzogJ25vbmUnfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIHVwZGF0ZSBuYXZcclxuICAgICAgICAgICAgaWYgKHRoaXMubmF2Lmxlbmd0aCAmJiB0aGlzLm5hdi5lbXB0eSgpKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yIChpPTA7aTx0aGlzLnNldHMubGVuZ3RoO2krKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmF2LmFwcGVuZCgnPGxpIGRhdGEtdWstc2xpZGVzZXQtaXRlbT1cIicraSsnXCI+PGE+PC9hPjwvbGk+Jyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5uYXZbdGhpcy5uYXYuY2hpbGRyZW4oKS5sZW5ndGg9PTEgPyAnYWRkQ2xhc3MnOidyZW1vdmVDbGFzcyddKCd1ay1pbnZpc2libGUnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5hY3RpdmVTZXQgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5zaG93KDAsICFhbmltYXRlKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICB1cGRhdGVGaWx0ZXI6IGZ1bmN0aW9uKGN1cnJlbnRmaWx0ZXIpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciAkdGhpcyA9IHRoaXMsIGZpbHRlcjtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudEZpbHRlciA9IGN1cnJlbnRmaWx0ZXI7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xzLmZpbmQoJ1tkYXRhLXVrLWZpbHRlcl0nKS5lYWNoKGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgICAgICAgICAgICAgZmlsdGVyID0gVUkuJCh0aGlzKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIWZpbHRlci5wYXJlbnQoKS5oYXNDbGFzcygndWstc2xpZGVzZXQnKSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyLmF0dHIoJ2RhdGEtdWstZmlsdGVyJykgPT0gJHRoaXMuY3VycmVudEZpbHRlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIuYWRkQ2xhc3MoJ3VrLWFjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlci5yZW1vdmVDbGFzcygndWstYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBnZXRWaXNpYmxlT25DdXJyZW5CcmVha3BvaW50OiBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBicmVha3BvaW50ICA9IG51bGwsXHJcbiAgICAgICAgICAgICAgICB0bXAgICAgICAgICA9IFVJLiQoJzxkaXYgc3R5bGU9XCJwb3NpdGlvbjphYnNvbHV0ZTtoZWlnaHQ6MXB4O3RvcDotMTAwMHB4O3dpZHRoOjEwMHB4XCI+PGRpdj48L2Rpdj48L2Rpdj4nKS5hcHBlbmRUbygnYm9keScpLFxyXG4gICAgICAgICAgICAgICAgdGVzdGRpdiAgICAgPSB0bXAuY2hpbGRyZW4oKS5lcSgwKSxcclxuICAgICAgICAgICAgICAgIGJyZWFrcG9pbnRzID0gdGhpcy5vcHRpb25zO1xyXG5cclxuICAgICAgICAgICAgICAgIFsneGxhcmdlJywgJ2xhcmdlJywgJ21lZGl1bScsICdzbWFsbCddLmZvckVhY2goZnVuY3Rpb24oYnApIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFicmVha3BvaW50c1ticF0gfHwgYnJlYWtwb2ludCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB0bXAuYXR0cignY2xhc3MnLCAndWstZ3JpZC13aWR0aC0nK2JwKyctMS0yJykud2lkdGgoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRlc3RkaXYud2lkdGgoKSA9PSA1MCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVha3BvaW50ID0gYnA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdG1wLnJlbW92ZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnNbYnJlYWtwb2ludF0gfHwgdGhpcy5vcHRpb25zWydkZWZhdWx0J107XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgZ2V0SXRlbXM6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIGl0ZW1zID0gW10sIGZpbHRlcjtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRGaWx0ZXIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBmaWx0ZXIgPSB0aGlzLmN1cnJlbnRGaWx0ZXIgfHwgW107XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZihmaWx0ZXIpID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlciA9IGZpbHRlci5zcGxpdCgvLC8pLm1hcChmdW5jdGlvbihpdGVtKXsgcmV0dXJuIGl0ZW0udHJpbSgpOyB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoaWxkcmVuLmVhY2goZnVuY3Rpb24oaW5kZXgpe1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgZWxlID0gVUkuJCh0aGlzKSwgZiA9IGVsZS5hdHRyKCdkYXRhLXVrLWZpbHRlcicpLCBpbmZpbHRlciA9IGZpbHRlci5sZW5ndGggPyBmYWxzZSA6IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmID0gZi5zcGxpdCgvLC8pLm1hcChmdW5jdGlvbihpdGVtKXsgcmV0dXJuIGl0ZW0udHJpbSgpOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlci5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYuaW5kZXhPZihpdGVtKSA+IC0xKSBpbmZpbHRlciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYoaW5maWx0ZXIpIGl0ZW1zLnB1c2goZWxlWzBdKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGl0ZW1zID0gVUkuJChpdGVtcyk7XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaXRlbXMgPSB0aGlzLmxpc3QuY2hpbGRyZW4oKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW1zO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHNob3c6IGZ1bmN0aW9uKHNldEluZGV4LCBub2FuaW1hdGUsIGRpcikge1xyXG5cclxuICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpcztcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZVNldCA9PT0gc2V0SW5kZXggfHwgdGhpcy5hbmltYXRpbmcpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZGlyID0gZGlyIHx8IChzZXRJbmRleCA8IHRoaXMuYWN0aXZlU2V0ID8gLTE6MSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgY3VycmVudCAgID0gdGhpcy5zZXRzW3RoaXMuYWN0aXZlU2V0XSB8fCBbXSxcclxuICAgICAgICAgICAgICAgIG5leHQgICAgICA9IHRoaXMuc2V0c1tzZXRJbmRleF0sXHJcbiAgICAgICAgICAgICAgICBhbmltYXRpb24gPSB0aGlzLl9nZXRBbmltYXRpb24oKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChub2FuaW1hdGUgfHwgIVVJLnN1cHBvcnQuYW5pbWF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRpb24gPSBBbmltYXRpb25zLm5vbmU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuYW5pbWF0aW5nID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLm5hdi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubmF2LmNoaWxkcmVuKCkucmVtb3ZlQ2xhc3MoJ3VrLWFjdGl2ZScpLmVxKHNldEluZGV4KS5hZGRDbGFzcygndWstYWN0aXZlJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGFuaW1hdGlvbi5hcHBseSgkdGhpcywgW2N1cnJlbnQsIG5leHQsIGRpcl0pLnRoZW4oZnVuY3Rpb24oKXtcclxuXHJcbiAgICAgICAgICAgICAgICBVSS5VdGlscy5jaGVja0Rpc3BsYXkobmV4dCwgdHJ1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgJHRoaXMuY2hpbGRyZW4uaGlkZSgpLnJlbW92ZUNsYXNzKCd1ay1hY3RpdmUnKTtcclxuICAgICAgICAgICAgICAgIG5leHQuYWRkQ2xhc3MoJ3VrLWFjdGl2ZScpLmNzcyh7J2Rpc3BsYXknOiAnJywgJ29wYWNpdHknOicnfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgJHRoaXMuYW5pbWF0aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkdGhpcy5hY3RpdmVTZXQgPSBzZXRJbmRleDtcclxuXHJcbiAgICAgICAgICAgICAgICBVSS5VdGlscy5jaGVja0Rpc3BsYXkobmV4dCwgdHJ1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgJHRoaXMudHJpZ2dlcignc2hvdy51ay5zbGlkZXNldCcsIFtuZXh0XSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBfZ2V0QW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBhbmltYXRpb24gPSBBbmltYXRpb25zW3RoaXMub3B0aW9ucy5hbmltYXRpb25dIHx8IEFuaW1hdGlvbnMubm9uZTtcclxuXHJcbiAgICAgICAgICAgIGlmICghVUkuc3VwcG9ydC5hbmltYXRpb24pIHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbiA9IEFuaW1hdGlvbnMubm9uZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGFuaW1hdGlvbjtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBfaGlkZTogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgJHRoaXMgICAgID0gdGhpcyxcclxuICAgICAgICAgICAgICAgIGN1cnJlbnQgICA9IHRoaXMuc2V0c1t0aGlzLmFjdGl2ZVNldF0gfHwgW10sXHJcbiAgICAgICAgICAgICAgICBhbmltYXRpb24gPSB0aGlzLl9nZXRBbmltYXRpb24oKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuYW5pbWF0aW5nID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBhbmltYXRpb24uYXBwbHkoJHRoaXMsIFtjdXJyZW50LCBbXSwgMV0pLnRoZW4oZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICR0aGlzLmFuaW1hdGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBuZXh0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdGhpcy5zaG93KHRoaXMuc2V0c1t0aGlzLmFjdGl2ZVNldCArIDFdID8gKHRoaXMuYWN0aXZlU2V0ICsgMSkgOiAwLCBmYWxzZSwgMSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgcHJldmlvdXM6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB0aGlzLnNob3codGhpcy5zZXRzW3RoaXMuYWN0aXZlU2V0IC0gMV0gPyAodGhpcy5hY3RpdmVTZXQgLSAxKSA6ICh0aGlzLnNldHMubGVuZ3RoIC0gMSksIGZhbHNlLCAtMSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgc3RhcnQ6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgdGhpcy5zdG9wKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgJHRoaXMgPSB0aGlzO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5pbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCEkdGhpcy5ob3ZlcmluZyAmJiAhJHRoaXMuYW5pbWF0aW5nKSAkdGhpcy5uZXh0KCk7XHJcbiAgICAgICAgICAgIH0sIHRoaXMub3B0aW9ucy5hdXRvcGxheUludGVydmFsKTtcclxuXHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgc3RvcDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmludGVydmFsKSBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWwpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIEFuaW1hdGlvbnMgPSB7XHJcblxyXG4gICAgICAgICdub25lJzogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBkID0gVUkuJC5EZWZlcnJlZCgpO1xyXG4gICAgICAgICAgICBkLnJlc29sdmUoKTtcclxuICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZSgpO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgICdmYWRlJzogZnVuY3Rpb24oY3VycmVudCwgbmV4dCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY29yZUFuaW1hdGlvbi5hcHBseSh0aGlzLCBbJ3VrLWFuaW1hdGlvbi1mYWRlJywgY3VycmVudCwgbmV4dF0pO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgICdzbGlkZS1ib3R0b20nOiBmdW5jdGlvbihjdXJyZW50LCBuZXh0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb3JlQW5pbWF0aW9uLmFwcGx5KHRoaXMsIFsndWstYW5pbWF0aW9uLXNsaWRlLWJvdHRvbScsIGN1cnJlbnQsIG5leHRdKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAnc2xpZGUtdG9wJzogZnVuY3Rpb24oY3VycmVudCwgbmV4dCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY29yZUFuaW1hdGlvbi5hcHBseSh0aGlzLCBbJ3VrLWFuaW1hdGlvbi1zbGlkZS10b3AnLCBjdXJyZW50LCBuZXh0XSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgJ3NsaWRlLXZlcnRpY2FsJzogZnVuY3Rpb24oY3VycmVudCwgbmV4dCwgZGlyKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgYW5pbSA9IFsndWstYW5pbWF0aW9uLXNsaWRlLXRvcCcsICd1ay1hbmltYXRpb24tc2xpZGUtYm90dG9tJ107XHJcblxyXG4gICAgICAgICAgICBpZiAoZGlyID09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICBhbmltLnJldmVyc2UoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvcmVBbmltYXRpb24uYXBwbHkodGhpcywgW2FuaW0sIGN1cnJlbnQsIG5leHRdKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAnc2xpZGUtaG9yaXpvbnRhbCc6IGZ1bmN0aW9uKGN1cnJlbnQsIG5leHQsIGRpcikge1xyXG5cclxuICAgICAgICAgICAgdmFyIGFuaW0gPSBbJ3VrLWFuaW1hdGlvbi1zbGlkZS1yaWdodCcsICd1ay1hbmltYXRpb24tc2xpZGUtbGVmdCddO1xyXG5cclxuICAgICAgICAgICAgaWYgKGRpciA9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgYW5pbS5yZXZlcnNlKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBjb3JlQW5pbWF0aW9uLmFwcGx5KHRoaXMsIFthbmltLCBjdXJyZW50LCBuZXh0LCBkaXJdKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAnc2NhbGUnOiBmdW5jdGlvbihjdXJyZW50LCBuZXh0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb3JlQW5pbWF0aW9uLmFwcGx5KHRoaXMsIFsndWstYW5pbWF0aW9uLXNjYWxlLXVwJywgY3VycmVudCwgbmV4dF0pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgVUkuc2xpZGVzZXQuYW5pbWF0aW9ucyA9IEFuaW1hdGlvbnM7XHJcblxyXG4gICAgLy8gaGVscGVyc1xyXG5cclxuICAgIGZ1bmN0aW9uIGNvcmVBbmltYXRpb24oY2xzLCBjdXJyZW50LCBuZXh0LCBkaXIpIHtcclxuXHJcbiAgICAgICAgdmFyIGQgICAgID0gVUkuJC5EZWZlcnJlZCgpLFxyXG4gICAgICAgICAgICBkZWxheSA9ICh0aGlzLm9wdGlvbnMuZGVsYXkgPT09IGZhbHNlKSA/IE1hdGguZmxvb3IodGhpcy5vcHRpb25zLmR1cmF0aW9uLzIpIDogdGhpcy5vcHRpb25zLmRlbGF5LFxyXG4gICAgICAgICAgICAkdGhpcyA9IHRoaXMsIGNsc0luLCBjbHNPdXQsIHJlbGVhc2UsIGk7XHJcblxyXG4gICAgICAgIGRpciA9IGRpciB8fCAxO1xyXG5cclxuICAgICAgICB0aGlzLmVsZW1lbnQuY3NzKCdtaW4taGVpZ2h0JywgdGhpcy5lbGVtZW50LmhlaWdodCgpKTtcclxuXHJcbiAgICAgICAgaWYgKG5leHRbMF09PT1jdXJyZW50WzBdKSB7XHJcbiAgICAgICAgICAgIGQucmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodHlwZW9mKGNscykgPT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgY2xzSW4gID0gY2xzWzBdO1xyXG4gICAgICAgICAgICBjbHNPdXQgPSBjbHNbMV0gfHwgY2xzWzBdO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNsc0luICA9IGNscztcclxuICAgICAgICAgICAgY2xzT3V0ID0gY2xzSW47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBVSS4kYm9keS5jc3MoJ292ZXJmbG93LXgnLCAnaGlkZGVuJyk7IC8vIHByZXZlbnQgaG9yaXpvbnRhbCBzY3JvbGxiYXIgb24gYW5pbWF0aW9uXHJcblxyXG4gICAgICAgIHJlbGVhc2UgPSBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50ICYmIGN1cnJlbnQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50LmhpZGUoKS5yZW1vdmVDbGFzcyhjbHNPdXQrJyB1ay1hbmltYXRpb24tcmV2ZXJzZScpLmNzcyh7J29wYWNpdHknOicnLCAnYW5pbWF0aW9uLWRlbGF5JzogJycsICdhbmltYXRpb24nOicnfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICghbmV4dC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGQucmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmb3IgKGk9MDtpPG5leHQubGVuZ3RoO2krKykge1xyXG4gICAgICAgICAgICAgICAgbmV4dC5lcShkaXIgPT0gMSA/IGk6KG5leHQubGVuZ3RoIC0gaSktMSkuY3NzKCdhbmltYXRpb24tZGVsYXknLCAoaSpkZWxheSkrJ21zJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBmaW5pc2ggPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIG5leHQucmVtb3ZlQ2xhc3MoJycrY2xzSW4rJycpLmNzcyh7b3BhY2l0eTonJywgZGlzcGxheTonJywgJ2FuaW1hdGlvbi1kZWxheSc6JycsICdhbmltYXRpb24nOicnfSk7XHJcbiAgICAgICAgICAgICAgICBkLnJlc29sdmUoKTtcclxuICAgICAgICAgICAgICAgIFVJLiRib2R5LmNzcygnb3ZlcmZsb3cteCcsICcnKTtcclxuICAgICAgICAgICAgICAgICR0aGlzLmVsZW1lbnQuY3NzKCdtaW4taGVpZ2h0JywgJycpO1xyXG4gICAgICAgICAgICAgICAgZmluaXNoID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBuZXh0LmFkZENsYXNzKGNsc0luKVtkaXI9PTEgPyAnbGFzdCc6J2ZpcnN0J10oKS5vbmUoVUkuc3VwcG9ydC5hbmltYXRpb24uZW5kLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgaWYoZmluaXNoKSBmaW5pc2goKTtcclxuICAgICAgICAgICAgfSkuZW5kKCkuY3NzKCdkaXNwbGF5JywgJycpO1xyXG5cclxuICAgICAgICAgICAgLy8gbWFrZSBzdXJlIGV2ZXJ5dGhpbmcgcmVzb2x2ZXMgcmVhbGx5XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBpZihmaW5pc2gpIGZpbmlzaCgpO1xyXG4gICAgICAgICAgICB9LCAgbmV4dC5sZW5ndGggKiBkZWxheSAqIDIpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmIChuZXh0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICBuZXh0LmNzcygnYW5pbWF0aW9uLWR1cmF0aW9uJywgdGhpcy5vcHRpb25zLmR1cmF0aW9uKydtcycpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGN1cnJlbnQgJiYgY3VycmVudC5sZW5ndGgpIHtcclxuXHJcbiAgICAgICAgICAgIGN1cnJlbnQuY3NzKCdhbmltYXRpb24tZHVyYXRpb24nLCB0aGlzLm9wdGlvbnMuZHVyYXRpb24rJ21zJylbZGlyPT0xID8gJ2xhc3QnOidmaXJzdCddKCkub25lKFVJLnN1cHBvcnQuYW5pbWF0aW9uLmVuZCwgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZWxlYXNlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZm9yIChpPTA7aTxjdXJyZW50Lmxlbmd0aDtpKyspIHtcclxuXHJcbiAgICAgICAgICAgICAgICAoZnVuY3Rpb24gKGluZGV4LCBlbGUpe1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGUuY3NzKCdkaXNwbGF5JywgJ25vbmUnKS5jc3MoJ2Rpc3BsYXknLCAnJykuY3NzKCdvcGFjaXR5JywgMCkub24oVUkuc3VwcG9ydC5hbmltYXRpb24uZW5kLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlLnJlbW92ZUNsYXNzKGNsc091dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmFkZENsYXNzKGNsc091dCsnIHVrLWFuaW1hdGlvbi1yZXZlcnNlJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSwgaSAqIGRlbGF5KTtcclxuXHJcbiAgICAgICAgICAgICAgICB9KShpLCBjdXJyZW50LmVxKGRpciA9PSAxID8gaTooY3VycmVudC5sZW5ndGggLSBpKS0xKSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVsZWFzZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGQucHJvbWlzZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGFycmF5X2NodW5rKGlucHV0LCBzaXplKSB7XHJcblxyXG4gICAgICAgIHZhciB4LCBpID0gMCwgYyA9IC0xLCBsID0gaW5wdXQubGVuZ3RoIHx8IDAsIG4gPSBbXTtcclxuXHJcbiAgICAgICAgaWYgKHNpemUgPCAxKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgd2hpbGUgKGkgPCBsKSB7XHJcblxyXG4gICAgICAgICAgICB4ID0gaSAlIHNpemU7XHJcblxyXG4gICAgICAgICAgICBpZih4KSB7XHJcbiAgICAgICAgICAgICAgICBuW2NdW3hdID0gaW5wdXRbaV07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBuWysrY10gPSBbaW5wdXRbaV1dO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpKys7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpID0gMDtcclxuICAgICAgICBsID0gbi5sZW5ndGg7XHJcblxyXG4gICAgICAgIHdoaWxlIChpIDwgbCkge1xyXG4gICAgICAgICAgICBuW2ldID0galF1ZXJ5KG5baV0pO1xyXG4gICAgICAgICAgICBpKys7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbjtcclxuICAgIH1cclxuXHJcbn0pOyJdfQ==
