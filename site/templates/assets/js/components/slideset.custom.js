!function(t){var i;window.UIkit2&&(i=t(UIkit2)),"function"==typeof define&&define.amd&&define("uikit-slideset",["uikit"],function(){return i||t(UIkit2)})}(function(d){"use strict";var r;function n(t,i,e,s){var n,a,o,r,l=d.$.Deferred(),h=!1===this.options.delay?Math.floor(this.options.duration/2):this.options.delay,u=this;if(s=s||1,this.element.css("min-height",this.element.height()),e[0]===i[0])return l.resolve(),l.promise();if("object"==typeof t?(n=t[0],a=t[1]||t[0]):a=n=t,d.$body.css("overflow-x","hidden"),o=function(){if(i&&i.length&&i.hide().removeClass(a+" uk-animation-reverse").css({opacity:"","animation-delay":"",animation:""}),e.length){for(r=0;r<e.length;r++)e.eq(1==s?r:e.length-r-1).css("animation-delay",r*h+"ms");var t=function(){e.removeClass(""+n).css({opacity:"",display:"","animation-delay":"",animation:""}),l.resolve(),d.$body.css("overflow-x",""),u.element.css("min-height",""),t=!1};e.addClass(n)[1==s?"last":"first"]().one(d.support.animation.end,function(){t&&t()}).end().css("display",""),setTimeout(function(){t&&t()},e.length*h*2)}else l.resolve()},e.length&&e.css("animation-duration",this.options.duration+"ms"),i&&i.length)for(i.css("animation-duration",this.options.duration+"ms")[1==s?"last":"first"]().one(d.support.animation.end,function(){o()}),r=0;r<i.length;r++)!function(t,i){setTimeout(function(){i.css("display","none").css("display","").css("opacity",0).on(d.support.animation.end,function(){i.removeClass(a)}).addClass(a+" uk-animation-reverse")}.bind(this),r*h)}(0,i.eq(1==s?r:i.length-r-1));else o();return l.promise()}d.component("slideset",{defaults:{default:1,animation:"fade",duration:200,filter:"",delay:!1,controls:!1,autoplay:!1,autoplayInterval:7e3,pauseOnHover:!0},sets:[],boot:function(){d.ready(function(t){d.$("[data-uk-slideset]",t).each(function(){var t=d.$(this);t.data("slideset")||d.slideset(t,d.Utils.options(t.attr("data-uk-slideset")))})})},init:function(){var e=this;this.activeSet=!1,this.list=this.element.find(".uk-slideset"),this.nav=this.element.find(".uk-slideset-nav"),this.controls=this.options.controls?d.$(this.options.controls):this.element,d.$win.on("resize load",d.Utils.debounce(function(){e.update()},100)),e.list.addClass("uk-grid-width-1-"+e.options.default),["xlarge","large","medium","small"].forEach(function(t){e.options[t]&&e.list.addClass("uk-grid-width-"+t+"-1-"+e.options[t])}),this.on("click.uk.slideset","[data-uk-slideset-item]",function(t){if(t.preventDefault(),!e.animating){var i=d.$(this).attr("data-uk-slideset-item");if(e.activeSet!==i)switch(i){case"next":case"previous":e["next"==i?"next":"previous"]();break;default:e.show(parseInt(i,10))}}}),this.controls.on("click.uk.slideset","[data-uk-filter]",function(t){var i=d.$(this);i.parent().hasClass("uk-slideset")||(t.preventDefault(),e.animating||e.currentFilter==i.attr("data-uk-filter")||(e.updateFilter(i.attr("data-uk-filter")),e._hide().then(function(){e.update(!0,!0)})))}),this.on("swipeRight swipeLeft",function(t){e["swipeLeft"==t.type?"next":"previous"]()}),this.updateFilter(this.options.filter),this.update(),this.element.on({mouseenter:function(){e.options.pauseOnHover&&(e.hovering=!0)},mouseleave:function(){e.hovering=!1}}),this.options.autoplay&&this.start(),d.domObserve(this.list,function(t){e.list.children(":visible:not(.uk-active)").length&&e.update(!1,!0)})},update:function(t,i){var e,s=this.visible;if(this.visible=this.getVisibleOnCurrenBreakpoint(),s!=this.visible||i){for(this.children=this.list.children().hide(),this.items=this.getItems(),this.sets=function(t,i){var e,s=0,n=-1,a=t.length||0,o=[];if(i<1)return null;for(;s<a;)(e=s%i)?o[n][e]=t[s]:o[++n]=[t[s]],s++;s=0,a=o.length;for(;s<a;)o[s]=jQuery(o[s]),s++;return o}(this.items,this.visible),e=0;e<this.sets.length;e++)this.sets[e].css({display:"none"});if(this.nav.length&&this.nav.empty()){for(e=0;e<this.sets.length;e++)this.nav.append('<li data-uk-slideset-item="'+e+'"><a></a></li>');this.nav[1==this.nav.children().length?"addClass":"removeClass"]("uk-invisible")}this.activeSet=!1,this.show(0,!t)}},updateFilter:function(t){var i,e=this;this.currentFilter=t,this.controls.find("[data-uk-filter]").each(function(){(i=d.$(this)).parent().hasClass("uk-slideset")||(i.attr("data-uk-filter")==e.currentFilter?i.addClass("uk-active"):i.removeClass("uk-active"))})},getVisibleOnCurrenBreakpoint:function(){var i=null,e=d.$('<div style="position:absolute;height:1px;top:-1000px;width:100px"><div></div></div>').appendTo("body"),s=e.children().eq(0),n=this.options;return["xlarge","large","medium","small"].forEach(function(t){n[t]&&!i&&(e.attr("class","uk-grid-width-"+t+"-1-2").width(),50==s.width()&&(i=t))}),e.remove(),this.options[i]||this.options.default},getItems:function(){var n,a=[];return this.currentFilter?("string"==typeof(n=this.currentFilter||[])&&(n=n.split(/,/).map(function(t){return t.trim()})),this.children.each(function(t){var i=d.$(this),e=i.attr("data-uk-filter"),s=!n.length;e&&(e=e.split(/,/).map(function(t){return t.trim()}),n.forEach(function(t){-1<e.indexOf(t)&&(s=!0)})),s&&a.push(i[0])}),a=d.$(a)):a=this.list.children(),a},show:function(t,i,e){var s=this;if(this.activeSet!==t&&!this.animating){e=e||(t<this.activeSet?-1:1);var n=this.sets[this.activeSet]||[],a=this.sets[t],o=this._getAnimation();!i&&d.support.animation||(o=r.none),this.animating=!0,this.nav.length&&this.nav.children().removeClass("uk-active").eq(t).addClass("uk-active"),o.apply(s,[n,a,e]).then(function(){d.Utils.checkDisplay(a,!0),s.children.hide().removeClass("uk-active"),a.addClass("uk-active").css({display:"",opacity:""}),s.animating=!1,s.activeSet=t,d.Utils.checkDisplay(a,!0),s.trigger("show.uk.slideset",[a])})}},_getAnimation:function(){var t=r[this.options.animation]||r.none;return d.support.animation||(t=r.none),t},_hide:function(){var t=this,i=this.sets[this.activeSet]||[],e=this._getAnimation();return this.animating=!0,e.apply(t,[i,[],1]).then(function(){t.animating=!1})},next:function(){this.show(this.sets[this.activeSet+1]?this.activeSet+1:0,!1,1)},previous:function(){this.show(this.sets[this.activeSet-1]?this.activeSet-1:this.sets.length-1,!1,-1)},start:function(){this.stop();var t=this;this.interval=setInterval(function(){t.hovering||t.animating||t.next()},this.options.autoplayInterval)},stop:function(){this.interval&&clearInterval(this.interval)}}),r={none:function(){var t=d.$.Deferred();return t.resolve(),t.promise()},fade:function(t,i){return n.apply(this,["uk-animation-fade",t,i])},"slide-bottom":function(t,i){return n.apply(this,["uk-animation-slide-bottom",t,i])},"slide-top":function(t,i){return n.apply(this,["uk-animation-slide-top",t,i])},"slide-vertical":function(t,i,e){var s=["uk-animation-slide-top","uk-animation-slide-bottom"];return-1==e&&s.reverse(),n.apply(this,[s,t,i])},"slide-horizontal":function(t,i,e){var s=["uk-animation-slide-right","uk-animation-slide-left"];return-1==e&&s.reverse(),n.apply(this,[s,t,i,e])},scale:function(t,i){return n.apply(this,["uk-animation-scale-up",t,i])}},d.slideset.animations=r});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvc2xpZGVzZXQuY3VzdG9tLmpzIl0sIm5hbWVzIjpbImFkZG9uIiwiY29tcG9uZW50Iiwid2luZG93IiwiVUlraXQyIiwiZGVmaW5lIiwiYW1kIiwiVUkiLCJBbmltYXRpb25zIiwiY29yZUFuaW1hdGlvbiIsImNscyIsImN1cnJlbnQiLCJuZXh0IiwiZGlyIiwiY2xzSW4iLCJjbHNPdXQiLCJyZWxlYXNlIiwiaSIsImQiLCIkIiwiRGVmZXJyZWQiLCJkZWxheSIsInRoaXMiLCJvcHRpb25zIiwiTWF0aCIsImZsb29yIiwiZHVyYXRpb24iLCIkdGhpcyIsImVsZW1lbnQiLCJjc3MiLCJoZWlnaHQiLCJyZXNvbHZlIiwicHJvbWlzZSIsIiRib2R5IiwibGVuZ3RoIiwiaGlkZSIsInJlbW92ZUNsYXNzIiwib3BhY2l0eSIsImFuaW1hdGlvbi1kZWxheSIsImFuaW1hdGlvbiIsImVxIiwiZmluaXNoIiwiZGlzcGxheSIsImFkZENsYXNzIiwib25lIiwic3VwcG9ydCIsImVuZCIsInNldFRpbWVvdXQiLCJpbmRleCIsImVsZSIsIm9uIiwiYmluZCIsImRlZmF1bHRzIiwiZGVmYXVsdCIsImZpbHRlciIsImNvbnRyb2xzIiwiYXV0b3BsYXkiLCJhdXRvcGxheUludGVydmFsIiwicGF1c2VPbkhvdmVyIiwic2V0cyIsImJvb3QiLCJyZWFkeSIsImNvbnRleHQiLCJlYWNoIiwiZGF0YSIsInNsaWRlc2V0IiwiVXRpbHMiLCJhdHRyIiwiaW5pdCIsImFjdGl2ZVNldCIsImxpc3QiLCJmaW5kIiwibmF2IiwiJHdpbiIsImRlYm91bmNlIiwidXBkYXRlIiwiZm9yRWFjaCIsImJwIiwiZSIsInByZXZlbnREZWZhdWx0IiwiYW5pbWF0aW5nIiwic2V0Iiwic2hvdyIsInBhcnNlSW50IiwicGFyZW50IiwiaGFzQ2xhc3MiLCJjdXJyZW50RmlsdGVyIiwidXBkYXRlRmlsdGVyIiwiX2hpZGUiLCJ0aGVuIiwidHlwZSIsIm1vdXNlZW50ZXIiLCJob3ZlcmluZyIsIm1vdXNlbGVhdmUiLCJzdGFydCIsImRvbU9ic2VydmUiLCJjaGlsZHJlbiIsImFuaW1hdGUiLCJmb3JjZSIsInZpc2libGUiLCJnZXRWaXNpYmxlT25DdXJyZW5CcmVha3BvaW50IiwiaXRlbXMiLCJnZXRJdGVtcyIsImlucHV0Iiwic2l6ZSIsIngiLCJjIiwibCIsIm4iLCJqUXVlcnkiLCJhcnJheV9jaHVuayIsImVtcHR5IiwiYXBwZW5kIiwiY3VycmVudGZpbHRlciIsImJyZWFrcG9pbnQiLCJ0bXAiLCJhcHBlbmRUbyIsInRlc3RkaXYiLCJicmVha3BvaW50cyIsIndpZHRoIiwicmVtb3ZlIiwic3BsaXQiLCJtYXAiLCJpdGVtIiwidHJpbSIsImYiLCJpbmZpbHRlciIsImluZGV4T2YiLCJwdXNoIiwic2V0SW5kZXgiLCJub2FuaW1hdGUiLCJfZ2V0QW5pbWF0aW9uIiwibm9uZSIsImFwcGx5IiwiY2hlY2tEaXNwbGF5IiwidHJpZ2dlciIsInByZXZpb3VzIiwic3RvcCIsImludGVydmFsIiwic2V0SW50ZXJ2YWwiLCJjbGVhckludGVydmFsIiwiZmFkZSIsInNsaWRlLWJvdHRvbSIsInNsaWRlLXRvcCIsInNsaWRlLXZlcnRpY2FsIiwiYW5pbSIsInJldmVyc2UiLCJzbGlkZS1ob3Jpem9udGFsIiwic2NhbGUiLCJhbmltYXRpb25zIl0sIm1hcHBpbmdzIjoiQ0FDQSxTQUFVQSxHQUVOLElBQUlDLEVBRUFDLE9BQU9DLFNBQ1BGLEVBQVlELEVBQU1HLFNBR0QsbUJBQVZDLFFBQXdCQSxPQUFPQyxLQUN0Q0QsT0FBTyxpQkFBa0IsQ0FBQyxTQUFVLFdBQ2hDLE9BQU9ILEdBQWFELEVBQU1HLFVBVnRDLENBY0csU0FBU0csR0FFUixhQUVBLElBQUlDLEVBK1hKLFNBQVNDLEVBQWNDLEVBQUtDLEVBQVNDLEVBQU1DLEdBRXZDLElBRWtCQyxFQUFPQyxFQUFRQyxFQUFTQyxFQUZ0Q0MsRUFBUVgsRUFBR1ksRUFBRUMsV0FDYkMsR0FBZ0MsSUFBdkJDLEtBQUtDLFFBQVFGLE1BQW1CRyxLQUFL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bnQiOlsiLyohIFVJa2l0IDIuMjcuMiB8IGh0dHA6Ly93d3cuZ2V0dWlraXQuY29tIHwgKGMpIDIwMTQgWU9PdGhlbWUgfCBNSVQgTGljZW5zZSAqL1xuKGZ1bmN0aW9uKGFkZG9uKSB7XG5cbiAgICB2YXIgY29tcG9uZW50O1xuXG4gICAgaWYgKHdpbmRvdy5VSWtpdDIpIHtcbiAgICAgICAgY29tcG9uZW50ID0gYWRkb24oVUlraXQyKTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIGRlZmluZSA9PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcbiAgICAgICAgZGVmaW5lKCd1aWtpdC1zbGlkZXNldCcsIFsndWlraXQnXSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQgfHwgYWRkb24oVUlraXQyKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG59KShmdW5jdGlvbihVSSl7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIHZhciBBbmltYXRpb25zO1xuXG4gICAgVUkuY29tcG9uZW50KCdzbGlkZXNldCcsIHtcblxuICAgICAgICBkZWZhdWx0czoge1xuICAgICAgICAgICAgZGVmYXVsdCAgICAgICAgICA6IDEsXG4gICAgICAgICAgICBhbmltYXRpb24gICAgICAgIDogJ2ZhZGUnLFxuICAgICAgICAgICAgZHVyYXRpb24gICAgICAgICA6IDIwMCxcbiAgICAgICAgICAgIGZpbHRlciAgICAgICAgICAgOiAnJyxcbiAgICAgICAgICAgIGRlbGF5ICAgICAgICAgICAgOiBmYWxzZSxcbiAgICAgICAgICAgIGNvbnRyb2xzICAgICAgICAgOiBmYWxzZSxcbiAgICAgICAgICAgIGF1dG9wbGF5ICAgICAgICAgOiBmYWxzZSxcbiAgICAgICAgICAgIGF1dG9wbGF5SW50ZXJ2YWwgOiA3MDAwLFxuICAgICAgICAgICAgcGF1c2VPbkhvdmVyICAgICA6IHRydWVcbiAgICAgICAgfSxcblxuICAgICAgICBzZXRzOiBbXSxcblxuICAgICAgICBib290OiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgLy8gYXV0byBpbml0XG4gICAgICAgICAgICBVSS5yZWFkeShmdW5jdGlvbihjb250ZXh0KSB7XG5cbiAgICAgICAgICAgICAgICBVSS4kKCdbZGF0YS11ay1zbGlkZXNldF0nLCBjb250ZXh0KS5lYWNoKGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGVsZSA9IFVJLiQodGhpcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYoIWVsZS5kYXRhKCdzbGlkZXNldCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBVSS5zbGlkZXNldChlbGUsIFVJLlV0aWxzLm9wdGlvbnMoZWxlLmF0dHIoJ2RhdGEtdWstc2xpZGVzZXQnKSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpcztcblxuICAgICAgICAgICAgdGhpcy5hY3RpdmVTZXQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMubGlzdCAgICAgID0gdGhpcy5lbGVtZW50LmZpbmQoJy51ay1zbGlkZXNldCcpO1xuICAgICAgICAgICAgdGhpcy5uYXYgICAgICAgPSB0aGlzLmVsZW1lbnQuZmluZCgnLnVrLXNsaWRlc2V0LW5hdicpO1xuICAgICAgICAgICAgdGhpcy5jb250cm9scyAgPSB0aGlzLm9wdGlvbnMuY29udHJvbHMgPyBVSS4kKHRoaXMub3B0aW9ucy5jb250cm9scykgOiB0aGlzLmVsZW1lbnQ7XG5cbiAgICAgICAgICAgIFVJLiR3aW4ub24oJ3Jlc2l6ZSBsb2FkJywgVUkuVXRpbHMuZGVib3VuY2UoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJHRoaXMudXBkYXRlKCk7XG4gICAgICAgICAgICB9LCAxMDApKTtcblxuICAgICAgICAgICAgJHRoaXMubGlzdC5hZGRDbGFzcygndWstZ3JpZC13aWR0aC0xLScrJHRoaXMub3B0aW9ucy5kZWZhdWx0KTtcblxuICAgICAgICAgICAgWyd4bGFyZ2UnLCAnbGFyZ2UnLCAnbWVkaXVtJywgJ3NtYWxsJ10uZm9yRWFjaChmdW5jdGlvbihicCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKCEkdGhpcy5vcHRpb25zW2JwXSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgJHRoaXMubGlzdC5hZGRDbGFzcygndWstZ3JpZC13aWR0aC0nK2JwKyctMS0nKyR0aGlzLm9wdGlvbnNbYnBdKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLm9uKCdjbGljay51ay5zbGlkZXNldCcsICdbZGF0YS11ay1zbGlkZXNldC1pdGVtXScsIGZ1bmN0aW9uKGUpIHtcblxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgIGlmICgkdGhpcy5hbmltYXRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBzZXQgPSBVSS4kKHRoaXMpLmF0dHIoJ2RhdGEtdWstc2xpZGVzZXQtaXRlbScpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCR0aGlzLmFjdGl2ZVNldCA9PT0gc2V0KSByZXR1cm47XG5cbiAgICAgICAgICAgICAgICBzd2l0Y2goc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ25leHQnOlxuICAgICAgICAgICAgICAgICAgICBjYXNlICdwcmV2aW91cyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAkdGhpc1tzZXQ9PSduZXh0JyA/ICduZXh0JzoncHJldmlvdXMnXSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5zaG93KHBhcnNlSW50KHNldCwgMTApKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xzLm9uKCdjbGljay51ay5zbGlkZXNldCcsICdbZGF0YS11ay1maWx0ZXJdJywgZnVuY3Rpb24oZSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGVsZSA9IFVJLiQodGhpcyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoZWxlLnBhcmVudCgpLmhhc0NsYXNzKCd1ay1zbGlkZXNldCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoJHRoaXMuYW5pbWF0aW5nIHx8ICR0aGlzLmN1cnJlbnRGaWx0ZXIgPT0gZWxlLmF0dHIoJ2RhdGEtdWstZmlsdGVyJykpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICR0aGlzLnVwZGF0ZUZpbHRlcihlbGUuYXR0cignZGF0YS11ay1maWx0ZXInKSk7XG5cbiAgICAgICAgICAgICAgICAkdGhpcy5faGlkZSgpLnRoZW4oZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgICAgICAgICAkdGhpcy51cGRhdGUodHJ1ZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5vbignc3dpcGVSaWdodCBzd2lwZUxlZnQnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgJHRoaXNbZS50eXBlPT0nc3dpcGVMZWZ0JyA/ICduZXh0JyA6ICdwcmV2aW91cyddKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy51cGRhdGVGaWx0ZXIodGhpcy5vcHRpb25zLmZpbHRlcik7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQub24oe1xuICAgICAgICAgICAgICAgIG1vdXNlZW50ZXI6IGZ1bmN0aW9uKCkgeyBpZiAoJHRoaXMub3B0aW9ucy5wYXVzZU9uSG92ZXIpICR0aGlzLmhvdmVyaW5nID0gdHJ1ZTsgIH0sXG4gICAgICAgICAgICAgICAgbW91c2VsZWF2ZTogZnVuY3Rpb24oKSB7ICR0aGlzLmhvdmVyaW5nID0gZmFsc2U7IH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBTZXQgYXV0b3BsYXlcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXV0b3BsYXkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIFVJLmRvbU9ic2VydmUodGhpcy5saXN0LCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCR0aGlzLmxpc3QuY2hpbGRyZW4oJzp2aXNpYmxlOm5vdCgudWstYWN0aXZlKScpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAkdGhpcy51cGRhdGUoZmFsc2UsdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdXBkYXRlOiBmdW5jdGlvbihhbmltYXRlLCBmb3JjZSkge1xuXG4gICAgICAgICAgICB2YXIgdmlzaWJsZSA9IHRoaXMudmlzaWJsZSwgaTtcblxuICAgICAgICAgICAgdGhpcy52aXNpYmxlICA9IHRoaXMuZ2V0VmlzaWJsZU9uQ3VycmVuQnJlYWtwb2ludCgpO1xuXG4gICAgICAgICAgICBpZiAodmlzaWJsZSA9PSB0aGlzLnZpc2libGUgJiYgIWZvcmNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmNoaWxkcmVuID0gdGhpcy5saXN0LmNoaWxkcmVuKCkuaGlkZSgpO1xuICAgICAgICAgICAgdGhpcy5pdGVtcyAgICA9IHRoaXMuZ2V0SXRlbXMoKTtcbiAgICAgICAgICAgIHRoaXMuc2V0cyAgICAgPSBhcnJheV9jaHVuayh0aGlzLml0ZW1zLCB0aGlzLnZpc2libGUpO1xuXG4gICAgICAgICAgICBmb3IgKGk9MDtpPHRoaXMuc2V0cy5sZW5ndGg7aSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRzW2ldLmNzcyh7J2Rpc3BsYXknOiAnbm9uZSd9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gdXBkYXRlIG5hdlxuICAgICAgICAgICAgaWYgKHRoaXMubmF2Lmxlbmd0aCAmJiB0aGlzLm5hdi5lbXB0eSgpKSB7XG5cbiAgICAgICAgICAgICAgICBmb3IgKGk9MDtpPHRoaXMuc2V0cy5sZW5ndGg7aSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmF2LmFwcGVuZCgnPGxpIGRhdGEtdWstc2xpZGVzZXQtaXRlbT1cIicraSsnXCI+PGE+PC9hPjwvbGk+Jyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5uYXZbdGhpcy5uYXYuY2hpbGRyZW4oKS5sZW5ndGg9PTEgPyAnYWRkQ2xhc3MnOidyZW1vdmVDbGFzcyddKCd1ay1pbnZpc2libGUnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5hY3RpdmVTZXQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuc2hvdygwLCAhYW5pbWF0ZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdXBkYXRlRmlsdGVyOiBmdW5jdGlvbihjdXJyZW50ZmlsdGVyKSB7XG5cbiAgICAgICAgICAgIHZhciAkdGhpcyA9IHRoaXMsIGZpbHRlcjtcblxuICAgICAgICAgICAgdGhpcy5jdXJyZW50RmlsdGVyID0gY3VycmVudGZpbHRlcjtcblxuICAgICAgICAgICAgdGhpcy5jb250cm9scy5maW5kKCdbZGF0YS11ay1maWx0ZXJdJykuZWFjaChmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgZmlsdGVyID0gVUkuJCh0aGlzKTtcblxuICAgICAgICAgICAgICAgIGlmICghZmlsdGVyLnBhcmVudCgpLmhhc0NsYXNzKCd1ay1zbGlkZXNldCcpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlci5hdHRyKCdkYXRhLXVrLWZpbHRlcicpID09ICR0aGlzLmN1cnJlbnRGaWx0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlci5hZGRDbGFzcygndWstYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIucmVtb3ZlQ2xhc3MoJ3VrLWFjdGl2ZScpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0VmlzaWJsZU9uQ3VycmVuQnJlYWtwb2ludDogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciBicmVha3BvaW50ICA9IG51bGwsXG4gICAgICAgICAgICAgICAgdG1wICAgICAgICAgPSBVSS4kKCc8ZGl2IHN0eWxlPVwicG9zaXRpb246YWJzb2x1dGU7aGVpZ2h0OjFweDt0b3A6LTEwMDBweDt3aWR0aDoxMDBweFwiPjxkaXY+PC9kaXY+PC9kaXY+JykuYXBwZW5kVG8oJ2JvZHknKSxcbiAgICAgICAgICAgICAgICB0ZXN0ZGl2ICAgICA9IHRtcC5jaGlsZHJlbigpLmVxKDApLFxuICAgICAgICAgICAgICAgIGJyZWFrcG9pbnRzID0gdGhpcy5vcHRpb25zO1xuXG4gICAgICAgICAgICAgICAgWyd4bGFyZ2UnLCAnbGFyZ2UnLCAnbWVkaXVtJywgJ3NtYWxsJ10uZm9yRWFjaChmdW5jdGlvbihicCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghYnJlYWtwb2ludHNbYnBdIHx8IGJyZWFrcG9pbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRtcC5hdHRyKCdjbGFzcycsICd1ay1ncmlkLXdpZHRoLScrYnArJy0xLTInKS53aWR0aCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ZXN0ZGl2LndpZHRoKCkgPT0gNTApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrcG9pbnQgPSBicDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdG1wLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9uc1ticmVha3BvaW50XSB8fCB0aGlzLm9wdGlvbnNbJ2RlZmF1bHQnXTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRJdGVtczogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciBpdGVtcyA9IFtdLCBmaWx0ZXI7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRGaWx0ZXIpIHtcblxuICAgICAgICAgICAgICAgIGZpbHRlciA9IHRoaXMuY3VycmVudEZpbHRlciB8fCBbXTtcblxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YoZmlsdGVyKSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyID0gZmlsdGVyLnNwbGl0KC8sLykubWFwKGZ1bmN0aW9uKGl0ZW0peyByZXR1cm4gaXRlbS50cmltKCk7IH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMuY2hpbGRyZW4uZWFjaChmdW5jdGlvbihpbmRleCl7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGVsZSA9IFVJLiQodGhpcyksIGYgPSBlbGUuYXR0cignZGF0YS11ay1maWx0ZXInKSwgaW5maWx0ZXIgPSBmaWx0ZXIubGVuZ3RoID8gZmFsc2UgOiB0cnVlO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChmKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBmLnNwbGl0KC8sLykubWFwKGZ1bmN0aW9uKGl0ZW0peyByZXR1cm4gaXRlbS50cmltKCk7IH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIuZm9yRWFjaChmdW5jdGlvbihpdGVtKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZi5pbmRleE9mKGl0ZW0pID4gLTEpIGluZmlsdGVyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYoaW5maWx0ZXIpIGl0ZW1zLnB1c2goZWxlWzBdKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGl0ZW1zID0gVUkuJChpdGVtcyk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaXRlbXMgPSB0aGlzLmxpc3QuY2hpbGRyZW4oKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGl0ZW1zO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNob3c6IGZ1bmN0aW9uKHNldEluZGV4LCBub2FuaW1hdGUsIGRpcikge1xuXG4gICAgICAgICAgICB2YXIgJHRoaXMgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVTZXQgPT09IHNldEluZGV4IHx8IHRoaXMuYW5pbWF0aW5nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkaXIgPSBkaXIgfHwgKHNldEluZGV4IDwgdGhpcy5hY3RpdmVTZXQgPyAtMToxKTtcblxuICAgICAgICAgICAgdmFyIGN1cnJlbnQgICA9IHRoaXMuc2V0c1t0aGlzLmFjdGl2ZVNldF0gfHwgW10sXG4gICAgICAgICAgICAgICAgbmV4dCAgICAgID0gdGhpcy5zZXRzW3NldEluZGV4XSxcbiAgICAgICAgICAgICAgICBhbmltYXRpb24gPSB0aGlzLl9nZXRBbmltYXRpb24oKTtcblxuICAgICAgICAgICAgaWYgKG5vYW5pbWF0ZSB8fCAhVUkuc3VwcG9ydC5hbmltYXRpb24pIHtcbiAgICAgICAgICAgICAgICBhbmltYXRpb24gPSBBbmltYXRpb25zLm5vbmU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuYW5pbWF0aW5nID0gdHJ1ZTtcblxuICAgICAgICAgICAgaWYgKHRoaXMubmF2Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRoaXMubmF2LmNoaWxkcmVuKCkucmVtb3ZlQ2xhc3MoJ3VrLWFjdGl2ZScpLmVxKHNldEluZGV4KS5hZGRDbGFzcygndWstYWN0aXZlJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGFuaW1hdGlvbi5hcHBseSgkdGhpcywgW2N1cnJlbnQsIG5leHQsIGRpcl0pLnRoZW4oZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgICAgIFVJLlV0aWxzLmNoZWNrRGlzcGxheShuZXh0LCB0cnVlKTtcblxuICAgICAgICAgICAgICAgICR0aGlzLmNoaWxkcmVuLmhpZGUoKS5yZW1vdmVDbGFzcygndWstYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgbmV4dC5hZGRDbGFzcygndWstYWN0aXZlJykuY3NzKHsnZGlzcGxheSc6ICcnLCAnb3BhY2l0eSc6Jyd9KTtcblxuICAgICAgICAgICAgICAgICR0aGlzLmFuaW1hdGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICR0aGlzLmFjdGl2ZVNldCA9IHNldEluZGV4O1xuXG4gICAgICAgICAgICAgICAgVUkuVXRpbHMuY2hlY2tEaXNwbGF5KG5leHQsIHRydWUpO1xuXG4gICAgICAgICAgICAgICAgJHRoaXMudHJpZ2dlcignc2hvdy51ay5zbGlkZXNldCcsIFtuZXh0XSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9LFxuXG4gICAgICAgIF9nZXRBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgYW5pbWF0aW9uID0gQW5pbWF0aW9uc1t0aGlzLm9wdGlvbnMuYW5pbWF0aW9uXSB8fCBBbmltYXRpb25zLm5vbmU7XG5cbiAgICAgICAgICAgIGlmICghVUkuc3VwcG9ydC5hbmltYXRpb24pIHtcbiAgICAgICAgICAgICAgICBhbmltYXRpb24gPSBBbmltYXRpb25zLm5vbmU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBhbmltYXRpb247XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2hpZGU6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgJHRoaXMgICAgID0gdGhpcyxcbiAgICAgICAgICAgICAgICBjdXJyZW50ICAgPSB0aGlzLnNldHNbdGhpcy5hY3RpdmVTZXRdIHx8IFtdLFxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbiA9IHRoaXMuX2dldEFuaW1hdGlvbigpO1xuXG4gICAgICAgICAgICB0aGlzLmFuaW1hdGluZyA9IHRydWU7XG5cbiAgICAgICAgICAgIHJldHVybiBhbmltYXRpb24uYXBwbHkoJHRoaXMsIFtjdXJyZW50LCBbXSwgMV0pLnRoZW4oZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAkdGhpcy5hbmltYXRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIG5leHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5zaG93KHRoaXMuc2V0c1t0aGlzLmFjdGl2ZVNldCArIDFdID8gKHRoaXMuYWN0aXZlU2V0ICsgMSkgOiAwLCBmYWxzZSwgMSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcHJldmlvdXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5zaG93KHRoaXMuc2V0c1t0aGlzLmFjdGl2ZVNldCAtIDFdID8gKHRoaXMuYWN0aXZlU2V0IC0gMSkgOiAodGhpcy5zZXRzLmxlbmd0aCAtIDEpLCBmYWxzZSwgLTEpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHN0YXJ0OiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgdGhpcy5zdG9wKCk7XG5cbiAgICAgICAgICAgIHZhciAkdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgICAgIHRoaXMuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLmhvdmVyaW5nICYmICEkdGhpcy5hbmltYXRpbmcpICR0aGlzLm5leHQoKTtcbiAgICAgICAgICAgIH0sIHRoaXMub3B0aW9ucy5hdXRvcGxheUludGVydmFsKTtcblxuICAgICAgICB9LFxuXG4gICAgICAgIHN0b3A6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuaW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbCk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIEFuaW1hdGlvbnMgPSB7XG5cbiAgICAgICAgJ25vbmUnOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBkID0gVUkuJC5EZWZlcnJlZCgpO1xuICAgICAgICAgICAgZC5yZXNvbHZlKCk7XG4gICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgJ2ZhZGUnOiBmdW5jdGlvbihjdXJyZW50LCBuZXh0KSB7XG4gICAgICAgICAgICByZXR1cm4gY29yZUFuaW1hdGlvbi5hcHBseSh0aGlzLCBbJ3VrLWFuaW1hdGlvbi1mYWRlJywgY3VycmVudCwgbmV4dF0pO1xuICAgICAgICB9LFxuXG4gICAgICAgICdzbGlkZS1ib3R0b20nOiBmdW5jdGlvbihjdXJyZW50LCBuZXh0KSB7XG4gICAgICAgICAgICByZXR1cm4gY29yZUFuaW1hdGlvbi5hcHBseSh0aGlzLCBbJ3VrLWFuaW1hdGlvbi1zbGlkZS1ib3R0b20nLCBjdXJyZW50LCBuZXh0XSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgJ3NsaWRlLXRvcCc6IGZ1bmN0aW9uKGN1cnJlbnQsIG5leHQpIHtcbiAgICAgICAgICAgIHJldHVybiBjb3JlQW5pbWF0aW9uLmFwcGx5KHRoaXMsIFsndWstYW5pbWF0aW9uLXNsaWRlLXRvcCcsIGN1cnJlbnQsIG5leHRdKTtcbiAgICAgICAgfSxcblxuICAgICAgICAnc2xpZGUtdmVydGljYWwnOiBmdW5jdGlvbihjdXJyZW50LCBuZXh0LCBkaXIpIHtcblxuICAgICAgICAgICAgdmFyIGFuaW0gPSBbJ3VrLWFuaW1hdGlvbi1zbGlkZS10b3AnLCAndWstYW5pbWF0aW9uLXNsaWRlLWJvdHRvbSddO1xuXG4gICAgICAgICAgICBpZiAoZGlyID09IC0xKSB7XG4gICAgICAgICAgICAgICAgYW5pbS5yZXZlcnNlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBjb3JlQW5pbWF0aW9uLmFwcGx5KHRoaXMsIFthbmltLCBjdXJyZW50LCBuZXh0XSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgJ3NsaWRlLWhvcml6b250YWwnOiBmdW5jdGlvbihjdXJyZW50LCBuZXh0LCBkaXIpIHtcblxuICAgICAgICAgICAgdmFyIGFuaW0gPSBbJ3VrLWFuaW1hdGlvbi1zbGlkZS1yaWdodCcsICd1ay1hbmltYXRpb24tc2xpZGUtbGVmdCddO1xuXG4gICAgICAgICAgICBpZiAoZGlyID09IC0xKSB7XG4gICAgICAgICAgICAgICAgYW5pbS5yZXZlcnNlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBjb3JlQW5pbWF0aW9uLmFwcGx5KHRoaXMsIFthbmltLCBjdXJyZW50LCBuZXh0LCBkaXJdKTtcbiAgICAgICAgfSxcblxuICAgICAgICAnc2NhbGUnOiBmdW5jdGlvbihjdXJyZW50LCBuZXh0KSB7XG4gICAgICAgICAgICByZXR1cm4gY29yZUFuaW1hdGlvbi5hcHBseSh0aGlzLCBbJ3VrLWFuaW1hdGlvbi1zY2FsZS11cCcsIGN1cnJlbnQsIG5leHRdKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBVSS5zbGlkZXNldC5hbmltYXRpb25zID0gQW5pbWF0aW9ucztcblxuICAgIC8vIGhlbHBlcnNcblxuICAgIGZ1bmN0aW9uIGNvcmVBbmltYXRpb24oY2xzLCBjdXJyZW50LCBuZXh0LCBkaXIpIHtcblxuICAgICAgICB2YXIgZCAgICAgPSBVSS4kLkRlZmVycmVkKCksXG4gICAgICAgICAgICBkZWxheSA9ICh0aGlzLm9wdGlvbnMuZGVsYXkgPT09IGZhbHNlKSA/IE1hdGguZmxvb3IodGhpcy5vcHRpb25zLmR1cmF0aW9uLzIpIDogdGhpcy5vcHRpb25zLmRlbGF5LFxuICAgICAgICAgICAgJHRoaXMgPSB0aGlzLCBjbHNJbiwgY2xzT3V0LCByZWxlYXNlLCBpO1xuXG4gICAgICAgIGRpciA9IGRpciB8fCAxO1xuXG4gICAgICAgIHRoaXMuZWxlbWVudC5jc3MoJ21pbi1oZWlnaHQnLCB0aGlzLmVsZW1lbnQuaGVpZ2h0KCkpO1xuXG4gICAgICAgIGlmIChuZXh0WzBdPT09Y3VycmVudFswXSkge1xuICAgICAgICAgICAgZC5yZXNvbHZlKCk7XG4gICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mKGNscykgPT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIGNsc0luICA9IGNsc1swXTtcbiAgICAgICAgICAgIGNsc091dCA9IGNsc1sxXSB8fCBjbHNbMF07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjbHNJbiAgPSBjbHM7XG4gICAgICAgICAgICBjbHNPdXQgPSBjbHNJbjtcbiAgICAgICAgfVxuXG4gICAgICAgIFVJLiRib2R5LmNzcygnb3ZlcmZsb3cteCcsICdoaWRkZW4nKTsgLy8gcHJldmVudCBob3Jpem9udGFsIHNjcm9sbGJhciBvbiBhbmltYXRpb25cblxuICAgICAgICByZWxlYXNlID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIGlmIChjdXJyZW50ICYmIGN1cnJlbnQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudC5oaWRlKCkucmVtb3ZlQ2xhc3MoY2xzT3V0KycgdWstYW5pbWF0aW9uLXJldmVyc2UnKS5jc3MoeydvcGFjaXR5JzonJywgJ2FuaW1hdGlvbi1kZWxheSc6ICcnLCAnYW5pbWF0aW9uJzonJ30pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIW5leHQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgZC5yZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3IgKGk9MDtpPG5leHQubGVuZ3RoO2krKykge1xuICAgICAgICAgICAgICAgIG5leHQuZXEoZGlyID09IDEgPyBpOihuZXh0Lmxlbmd0aCAtIGkpLTEpLmNzcygnYW5pbWF0aW9uLWRlbGF5JywgKGkqZGVsYXkpKydtcycpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgZmluaXNoID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgbmV4dC5yZW1vdmVDbGFzcygnJytjbHNJbisnJykuY3NzKHtvcGFjaXR5OicnLCBkaXNwbGF5OicnLCAnYW5pbWF0aW9uLWRlbGF5JzonJywgJ2FuaW1hdGlvbic6Jyd9KTtcbiAgICAgICAgICAgICAgICBkLnJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICBVSS4kYm9keS5jc3MoJ292ZXJmbG93LXgnLCAnJyk7XG4gICAgICAgICAgICAgICAgJHRoaXMuZWxlbWVudC5jc3MoJ21pbi1oZWlnaHQnLCAnJyk7XG4gICAgICAgICAgICAgICAgZmluaXNoID0gZmFsc2U7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBuZXh0LmFkZENsYXNzKGNsc0luKVtkaXI9PTEgPyAnbGFzdCc6J2ZpcnN0J10oKS5vbmUoVUkuc3VwcG9ydC5hbmltYXRpb24uZW5kLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmKGZpbmlzaCkgZmluaXNoKCk7XG4gICAgICAgICAgICB9KS5lbmQoKS5jc3MoJ2Rpc3BsYXknLCAnJyk7XG5cbiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBldmVyeXRoaW5nIHJlc29sdmVzIHJlYWxseVxuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZihmaW5pc2gpIGZpbmlzaCgpO1xuICAgICAgICAgICAgfSwgIG5leHQubGVuZ3RoICogZGVsYXkgKiAyKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAobmV4dC5sZW5ndGgpIHtcbiAgICAgICAgICAgIG5leHQuY3NzKCdhbmltYXRpb24tZHVyYXRpb24nLCB0aGlzLm9wdGlvbnMuZHVyYXRpb24rJ21zJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY3VycmVudCAmJiBjdXJyZW50Lmxlbmd0aCkge1xuXG4gICAgICAgICAgICBjdXJyZW50LmNzcygnYW5pbWF0aW9uLWR1cmF0aW9uJywgdGhpcy5vcHRpb25zLmR1cmF0aW9uKydtcycpW2Rpcj09MSA/ICdsYXN0JzonZmlyc3QnXSgpLm9uZShVSS5zdXBwb3J0LmFuaW1hdGlvbi5lbmQsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJlbGVhc2UoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBmb3IgKGk9MDtpPGN1cnJlbnQubGVuZ3RoO2krKykge1xuXG4gICAgICAgICAgICAgICAgKGZ1bmN0aW9uIChpbmRleCwgZWxlKXtcblxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZS5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpLmNzcygnZGlzcGxheScsICcnKS5jc3MoJ29wYWNpdHknLCAwKS5vbihVSS5zdXBwb3J0LmFuaW1hdGlvbi5lbmQsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlLnJlbW92ZUNsYXNzKGNsc091dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5hZGRDbGFzcyhjbHNPdXQrJyB1ay1hbmltYXRpb24tcmV2ZXJzZScpO1xuXG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSwgaSAqIGRlbGF5KTtcblxuICAgICAgICAgICAgICAgIH0pKGksIGN1cnJlbnQuZXEoZGlyID09IDEgPyBpOihjdXJyZW50Lmxlbmd0aCAtIGkpLTEpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVsZWFzZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGQucHJvbWlzZSgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFycmF5X2NodW5rKGlucHV0LCBzaXplKSB7XG5cbiAgICAgICAgdmFyIHgsIGkgPSAwLCBjID0gLTEsIGwgPSBpbnB1dC5sZW5ndGggfHwgMCwgbiA9IFtdO1xuXG4gICAgICAgIGlmIChzaXplIDwgMSkgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgd2hpbGUgKGkgPCBsKSB7XG5cbiAgICAgICAgICAgIHggPSBpICUgc2l6ZTtcblxuICAgICAgICAgICAgaWYoeCkge1xuICAgICAgICAgICAgICAgIG5bY11beF0gPSBpbnB1dFtpXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgblsrK2NdID0gW2lucHV0W2ldXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaSsrO1xuICAgICAgICB9XG5cbiAgICAgICAgaSA9IDA7XG4gICAgICAgIGwgPSBuLmxlbmd0aDtcblxuICAgICAgICB3aGlsZSAoaSA8IGwpIHtcbiAgICAgICAgICAgIG5baV0gPSBqUXVlcnkobltpXSk7XG4gICAgICAgICAgICBpKys7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbjtcbiAgICB9XG5cbn0pOyJdfQ==
